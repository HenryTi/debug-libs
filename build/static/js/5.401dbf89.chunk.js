(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{100:function(e,t,i){"use strict";var n=i(7),s=i.n(n),r=i(74),o=i(85),a=i(0),l=i(8),c=i(2),h=i.n(c),u=i(75),d=i(4),m=i(77),f=i(76),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends r.b{constructor(){super(...arguments),this.itemRender=((e,t)=>a.createElement(this.ItemRow,{item:e})),this.ItemRow=Object(l.a)(({item:e})=>{let t,i,n,s,r,o,{tuid:l,box:c,children:d,isLeaf:v,keyIndex:p,values:y}=e,g=this.controller.keyUIs[p],{content:w,valuesContent:b,none:x}=g;if(!1===this.isFrom&&(t=a.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.addClick(e)},a.createElement(u.FA,{name:"plus"})),i=a.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.removeClick(e)},a.createElement(u.FA,{className:"text-info",name:"trash"}))),!1===v?n=0===p?t:a.createElement(a.Fragment,null,i," \xa0 ",t):p>0&&(n=i),!0===v)s=void 0,y&&(o=(b||f.b)(y,this.x));else{r="border-bottom";let e=x&&x(this.x);s=a.createElement(u.List,{className:"ml-4",items:d,item:{onClick:void 0,render:this.itemRender},none:e})}return a.createElement("div",{className:"d-flex flex-column"},a.createElement(u.LMR,{className:h()("px-3","py-2",r),right:n},a.createElement("div",{className:"py-1"},Object(m.b)(c,w,this.x)),a.createElement("div",{className:"py-1 font-weight-bold"},o)),s)})}showEntry(e){return v(this,void 0,void 0,function*(){this.isFrom=this.controller.isFrom,this.openPage(this.view)})}get view(){return()=>a.createElement(d.Page,{header:this.label},a.createElement(u.List,{items:this.controller.items,item:{className:"my-2",onClick:void 0,render:this.itemRender}}))}}var y=i(1),g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w extends r.b{constructor(){super(...arguments),this.onValuesSubmit=(()=>g(this,void 0,void 0,function*(){this.ceasePage();let e=this.vForm.getValues();this.returnCall(e)})),this.view=(()=>a.createElement(d.Page,null,this.vForm.render()))}showEntry(e){return g(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(a.createElement(this.view,null))})}}var b=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class x{constructor(e,t,i,n){this.children=y.k.array([],{deep:!0}),this.parent=e,this.tuid=t,this.box=i,this.keyIndex=n,this.isLeaf=!1}}class E extends r.a{constructor(){super(...arguments),this.addClick=(e=>b(this,void 0,void 0,function*(){let{keyIndex:t,children:i}=e,n=this.keyFields.length,s=n-1,r=t+1;if(r>=n)return;let a=this.keyFields[r],l=a.name,c=a._tuid,h={},u={};for(let o=e;void 0!==o;o=o.parent){let{keyIndex:e,box:t}=o,i=this.keyFields[e].name;h[i]=u[i]=t.id}let d=yield this.searchOnKey(a,h);if(void 0===d||d<=0)return;c.useId(d);let m=c.boxId(d),f={},v={};if(t+1===s){if(c.useId(d),v[l]=f[l]=m,this.entity.fields.length>0){let e=yield this.vCall(w,u);for(let t in e)v[t]=f[t]=e[t]}}else{v[l]=u[l]=m;for(let t=r+1;t<s;t++)u[this.keyFields[t].name]=0;f[this.keyFields[s].name]=0;let{fields:e}=this.entity;for(let t of e){let{name:e,type:i,null:n}=t;!0!==n&&(f[t.name]=Object(o.b)(i))}}u.arr1=[f],yield this.entity.actions.add.submit(u);let p=i.findIndex(e=>e.box.id===d);if(p<0)i.push(this.createItem(e,c,m,r,v));else{let{fields:e}=this.entity;if(void 0!==e&&e.length>0){let e=i[p];i.splice(p,1),e.values=v,i.splice(p,0,e)}}this.removeCeased()})),this.removeClick=(e=>b(this,void 0,void 0,function*(){let t=this.keyFields[e.keyIndex]._tuid,i=this.cUsq.cTuidMain(t.Main).getLable(t),n=this.res.confirmDelete||s.a.template("do you really want to remove ${label}?");if(!1===confirm(n({label:i})))return;let r=this.entity,o={},a={};(o.arr1=[]).push(a);for(let s=e;void 0!==s;s=s.parent){let e=s.keyIndex;a[this.keyFields[e].name]=s.box.id}let l=this.keyFields.length;for(let s=e.keyIndex+1;s<l;s++){a[this.keyFields[s].name]=-1}yield r.actions.del.submit(o);let c=e.parent.children,h=c.findIndex(t=>t===e);h>=0&&c.splice(h,1)}))}internalStart(){return b(this,void 0,void 0,function*(){let{keys:e,schemaFrom:t}=this.entity;this.isFrom=void 0!==t;let i=this.entity.queries.all,n=(yield i.query({})).ret,r=e.length;this.keyUIs=s.a.clone(this.ui.keys||[]),this.keyFields=[];let o=i.returns[0].fields;for(let s=0;s<r;s++)this.keyFields.push(o[s]),s>=this.keyUIs.length&&this.keyUIs.push({content:f.b});this.items=Object(y.k)([]);let a=void 0;for(let s of n){let e=this.addItem(a,s);void 0!==e&&(this.items.push(e),a=e)}yield this.showVPage(this.VMapMain)})}createItem(e,t,i,n,s){let r=new x(e,t,i,n);return n===this.keyFields.length-1&&(r.isLeaf=!0,r.values=s),r}addItem(e,t){let i=void 0,n=this.keyFields.length,s=e;for(let r=0;r<n;r++){let e=this.keyFields[r],{name:n}=e,o=e._tuid,a=t[n];if(void 0===a)break;let{id:l}=a;if(0===r){if(0===l)continue;void 0!==s&&s.box.id===l||(i=s=this.createItem(void 0,o,a,r,t));continue}let{children:c,box:h}=s,u=c.length;if(u>0){let e=c[u-1];if(e.box.id===l){s=e;continue}}l>0&&c.push(s=this.createItem(s,o,a,r,t))}return i}searchOnKey(e,t){return b(this,void 0,void 0,function*(){let{_tuid:i,_ownerField:n}=e,s=this.cUsq.cTuidSelect(i),r=t;void 0!==n&&"object"===typeof(r=t[n.name])&&(r=r.id);let o=yield s.call(r);return i.getIdFromObj(o)})}get VMapMain(){return p}}i.d(t,"a",function(){return E})},101:function(e,t,i){"use strict";var n=i(74),s=i(0),r=i(4),o=i(77),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>a(this,void 0,void 0,function*(){let e=this.vForm.getValues();this.returns=yield this.controller.submit(e),this.closePage(),this.openPage(this.resultPage)})),this.mainPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e},this.vForm.render("mx-3 my-2"))}),this.resultPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e,back:"close"},"\u5b8c\u6210\uff01",s.createElement("pre",null,Object(o.a)(this.returns)))})}showEntry(e){return a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage)})}}var c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class h extends n.a{internalStart(){return c(this,void 0,void 0,function*(){yield this.showVPage(this.VActionMain)})}get VActionMain(){return l}submit(e){return c(this,void 0,void 0,function*(){return this.entity.submit(e)})}}i.d(t,"a",function(){return h})},102:function(e,t,i){"use strict";var n=i(74),s=i(0),r=i(4),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"pending"))}showEntry(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.showVPage(this.VPendingMain)})}get VPendingMain(){return a}}i.d(t,"a",function(){return c})},103:function(e,t,i){"use strict";var n=i(74),s=i(0),r=i(4),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"History"))}showEntry(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.showVPage(this.VHistoryMain)})}get VHistoryMain(){return a}}i.d(t,"a",function(){return c})},116:function(e,t,i){"use strict";i(0),i(92)},117:function(e,t){},151:function(e,t,i){"use strict";i(0);var n=i(82);i(85);i.o(n,"CApp")&&i.d(t,"CApp",function(){return n.CApp});i(95),i(77)},152:function(e,t,i){(function(e,n){var s=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(a(arguments[i]));return t.join(" ")}i=1;for(var n=arguments,r=n.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(i>=r)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return e}}),l=n[i];i<r;l=n[++i])v(l)||!b(l)?o+=" "+l:o+=" "+a(l);return o},t.deprecate=function(i,s){if(g(e.process))return function(){return t.deprecate(i,s).apply(this,arguments)};if(!0===n.noDeprecation)return i;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(s);n.traceDeprecation?console.trace(s):console.error(s),r=!0}return i.apply(this,arguments)}};var r,o={};function a(e,i){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(i)?n.showHidden=i:i&&t._extend(n,i),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),h(n,e,n.depth)}function l(e,t){var i=a.styles[t];return i?"\x1b["+a.colors[i][0]+"m"+e+"\x1b["+a.colors[i][1]+"m":e}function c(e,t){return e}function h(e,i,n){if(e.customInspect&&i&&S(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var s=i.inspect(n,e);return y(s)||(s=h(e,s,n)),s}var r=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(y(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}if(p(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,i);if(r)return r;var o=Object.keys(i),a=function(e){var t={};return e.forEach(function(e,i){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(i)),E(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return u(i);if(0===o.length){if(S(i)){var l=i.name?": "+i.name:"";return e.stylize("[Function"+l+"]","special")}if(w(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return e.stylize(Date.prototype.toString.call(i),"date");if(E(i))return u(i)}var c,b="",k=!1,F=["{","}"];(m(i)&&(k=!0,F=["[","]"]),S(i))&&(b=" [Function"+(i.name?": "+i.name:"")+"]");return w(i)&&(b=" "+RegExp.prototype.toString.call(i)),x(i)&&(b=" "+Date.prototype.toUTCString.call(i)),E(i)&&(b=" "+u(i)),0!==o.length||k&&0!=i.length?n<0?w(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),c=k?function(e,t,i,n,s){for(var r=[],o=0,a=t.length;o<a;++o)P(t,String(o))?r.push(d(e,t,i,n,String(o),!0)):r.push("");return s.forEach(function(s){s.match(/^\d+$/)||r.push(d(e,t,i,n,s,!0))}),r}(e,i,n,a,o):o.map(function(t){return d(e,i,n,a,t,k)}),e.seen.pop(),function(e,t,i){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1];return i[0]+t+" "+e.join(", ")+" "+i[1]}(c,b,F)):F[0]+b+F[1]}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,i,n,s,r){var o,a,l;if((l=Object.getOwnPropertyDescriptor(t,s)||{value:t[s]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),P(n,s)||(o="["+s+"]"),a||(e.seen.indexOf(l.value)<0?(a=v(i)?h(e,l.value,null):h(e,l.value,i-1)).indexOf("\n")>-1&&(a=r?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),g(o)){if(r&&s.match(/^\d+$/))return a;(o=JSON.stringify(""+s)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function m(e){return Array.isArray(e)}function f(e){return"boolean"===typeof e}function v(e){return null===e}function p(e){return"number"===typeof e}function y(e){return"string"===typeof e}function g(e){return void 0===e}function w(e){return b(e)&&"[object RegExp]"===k(e)}function b(e){return"object"===typeof e&&null!==e}function x(e){return b(e)&&"[object Date]"===k(e)}function E(e){return b(e)&&("[object Error]"===k(e)||e instanceof Error)}function S(e){return"function"===typeof e}function k(e){return Object.prototype.toString.call(e)}function F(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(g(r)&&(r=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56"}).NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(r)){var i=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,i,n)}}else o[e]=function(){};return o[e]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=m,t.isBoolean=f,t.isNull=v,t.isNullOrUndefined=function(e){return null==e},t.isNumber=p,t.isString=y,t.isSymbol=function(e){return"symbol"===typeof e},t.isUndefined=g,t.isRegExp=w,t.isObject=b,t.isDate=x,t.isError=E,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"===typeof e||"number"===typeof e||"string"===typeof e||"symbol"===typeof e||"undefined"===typeof e},t.isBuffer=i(153);var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,i;console.log("%s - %s",(e=new Date,i=[F(e.getHours()),F(e.getMinutes()),F(e.getSeconds())].join(":"),[e.getDate(),C[e.getMonth()],i].join(" ")),t.format.apply(t,arguments))},t.inherits=i(154),t._extend=function(e,t){if(!t||!b(t))return e;for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}).call(this,i(23),i(48))},153:function(e,t){e.exports=function(e){return e&&"object"===typeof e&&"function"===typeof e.copy&&"function"===typeof e.fill&&"function"===typeof e.readUInt8}},154:function(e,t){"function"===typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},157:function(e,t,i){"use strict";i.r(t),i.d(t,"TabController",function(){return u});var n=i(0),s=i(151),r=i(1),o=i(8),a=i(75),l=i(4),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const h="JKDev/jkOrder";class u{constructor(){this.renderProductRow=((e,t)=>{let{id:i,discription:s}=e;return n.createElement("div",null,i,": ",s)}),this.renderContent=(()=>n.createElement("div",null,"product loaded",this.items.length,n.createElement(a.List,{items:this.items,item:{render:this.renderProductRow,key:e=>e.id}}))),this.render=Object(o.a)(()=>void 0===this.items?n.createElement(l.Loading,null):this.renderContent())}start(){return c(this,void 0,void 0,function*(){this.cApp=new s.CApp(h),yield this.cApp.load(),this.cUsq=this.cApp.getCUsq("JKDev/jkOrder"),this.tuidProduct=this.cUsq.tuid("product");let e=yield this.tuidProduct.search("",0,100);this.items=e})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([r.k],u.prototype,"items",void 0)},74:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var n=i(4),s=i(84),r=i(93),o=i(94),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends o.a{constructor(e,t,i,n){super(e,n),Object.setPrototypeOf(this.x,e.x);let{name:s,typeName:o}=t;this.entity=t,this.ui=i,this.label=this.res.label||s,this.icon=r.a[o]}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return a(this,void 0,void 0,function*(){return!1!==(yield e.beforeStart.call(this))&&(yield this.entity.loadSchema(),!0)})}createForm(e,t,i){let n=this.buildFormOptions(i),r=new s.b(n,e);return r.setValues(t),r}buildFormOptions(e){let t,i,n,r,o,{fields:a,arrFields:l}=this.entity;void 0!==this.res&&(t=this.res.none,i=this.res.submit,n=this.res.arrNew,r=this.res.arrEdit,o=this.res.arrTitleNewButton),void 0===t&&(t=this.cUsq.res.none||"none"),void 0===i&&(i=this.cUsq.res.submit||"Submit"),void 0===n&&(n=this.cUsq.res.arrNew||"New"),void 0===r&&(r=this.cUsq.res.arrEdit||"Edit"),void 0===o&&(o=this.cUsq.res.arrTitleNewButton),void 0===e&&(e=s.a.new);let c=this.ui.form;return{fields:a,arrs:l,ui:c,res:this.res||{},inputs:this.buildInputs(c),none:t,submitCaption:i,arrNewCaption:n,arrEditCaption:r,arrTitleNewButton:o,mode:e}}buildInputs(e){let{fields:t,arrFields:i}=this.entity,n={};if(this.buildFieldsInputs(n,t,void 0,e),void 0!==i)for(let s of i){let{name:t,fields:i}=s,r=e&&e.items;this.buildFieldsInputs(n,i,t,r&&r[t])}return n}buildFieldsInputs(e,t,i,n){if(void 0!==i){let t=e[i];void 0===t&&(e[i]=t={},e=t)}for(let s of t){let{name:t,_tuid:r}=s;if(void 0===r)continue;let o=n&&n.items&&n.items[t];e[t]={select:this.buildSelect(s,i,o),content:this.buildContent(s,i),placeHolder:this.cUsq.getTuidPlaceHolder(r)}}}buildSelect(e,t,i){return(e,t,n)=>a(this,void 0,void 0,function*(){let{_tuid:n,_ownerField:s}=t,r=yield n.cSelectFrom(),o=void 0;void 0!==s&&(o=e.getValue(s.name)),i&&!0===i.autoList&&(console.log("select search set param=empty string"),o="");let a=yield r.call(o);if(r.removeCeased(),void 0===a)return;let l=r.idFromItem(a);return n.useId(l),l})}buildContent(e,t){}cQuerySelect(e){return this.cUsq.cQuerySelect(e)}}class c extends n.VPage{constructor(e){super(e),this.entity=e.entity,this.ui=e.ui}get label(){return this.controller.label}createForm(e,t,i){return this.controller.createForm(e,t,i)}}},76:function(e,t,i){"use strict";i.d(t,"d",function(){return o}),i.d(t,"b",function(){return a}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c});var n=i(0),s=i(8),r=i(77);class o{render(e){return void 0===this.view?n.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):n.createElement(this.view,{vm:this,className:e})}}const a=(e,t)=>n.createElement(n.Fragment,null,"content: ",Object(r.a)(e)),l=Object(s.a)(a),c=e=>n.createElement("div",{className:"px-3 py-2"},Object(r.a)(e))},77:function(e,t,i){"use strict";function n(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function s(e){return JSON.stringify(e,n," ")}var r=i(0),o=i(8),a=i(82);const l=Object(o.a)(({tuidValue:e,ui:t,x:i,nullUI:n})=>{let s=typeof e;switch(s){default:return void 0===t?r.createElement(r.Fragment,null,s,"-",e):t(e,i);case"undefined":return void 0===n?r.createElement(r.Fragment,null,"null"):n();case"object":return null===e?void 0===n?r.createElement(r.Fragment,null,"null"):n():function(e,t,i){let{id:n,_$tuid:s,_$com:o}=e,l=s;if(void 0===l)return void 0!==t?t(e,i):Object(a.PureJSONContent)(e,i);let c=t||o;void 0===c&&(c=e._$com=l.getTuidContent());let h=l.valueFromId(n);return"number"===typeof h&&(h={id:h}),void 0!==t?t(h,i):r.createElement(c,h)}(e,t,i);case"number":return r.createElement(r.Fragment,null,"id...",e)}}),c=(e,t,i,n)=>r.createElement(l,{tuidValue:e,ui:t,x:i,nullUI:n});i.d(t,"a",function(){return s}),i.d(t,"b",function(){return c})},82:function(e,t,i){"use strict";var n=i(92);i.d(t,"CApp",function(){return n.a});i(116),i(98),i(101),i(97),i(96),i(99),i(100),i(103),i(102);var s=i(76);i.d(t,"PureJSONContent",function(){return s.b});i(84),i(117),i(94),i(74),i(86),i(93)},84:function(e,t,i){"use strict";var n=i(0),s=i.n(n),r=i(8);class o{constructor(e){this.view=(()=>n.createElement("div",null)),this.label=e}render(){return n.createElement("div",{key:this.key,className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.label),n.createElement("div",{className:"col-sm-10"},this.renderContent())))}setAddRow(e){}get key(){return this.label}getVFields(){}getVArr(){}getVSubmit(){}renderContent(){return n.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}}class a extends o{constructor(e,t){super(e),this.vField=t}get key(){return this.vField.name}getVFields(){return[this.vField]}renderContent(){return this.vField.render()}}class l extends o{constructor(e,t){super(e),this.vArr=t}setAddRow(e){this.vArr.setAddRow(e)}get key(){return this.vArr.name}getVArr(){return this.vArr}render(){return n.createElement(n.Fragment,{key:this.key},this.vArr&&this.vArr.render())}}class c extends o{constructor(e){super(void 0),this.vSubmit=e}get key(){return"$submit"}getVSubmit(){return this.vSubmit}render(){return n.createElement("div",{key:"$submit",className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}}var h=i(76),u=i(1),d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends h.d{constructor(e){super(),this.onClickSubmit=(()=>m(this,void 0,void 0,function*(){this.vForm.submit()})),this.view=Object(r.a)(()=>{let{isOk:e}=this.vForm;return n.createElement("button",{type:"button",onClick:this.onClickSubmit,className:this.className,disabled:!1===e},this.caption)}),this.vForm=e,this.caption=this.vForm.submitCaption,this.className="btn btn-primary w-25"}}d([u.k],f.prototype,"caption",void 0),d([u.k],f.prototype,"className",void 0);var v=i(2),p=i.n(v),y=i(75);class g{}class w extends g{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}class b extends g{check(e,t){if(void 0===t||null===t)return;NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57")}}class x extends g{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0!==Number.isNaN(i)&&!1!==Number.isInteger(i)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}class E extends b{constructor(e){super(),this.min=e}check(e,t){super.check(e,t),Number(t)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}class S extends b{constructor(e){super(),this.max=e}check(e,t){super.check(e,t),Number(t)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}var k=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class F extends h.d{constructor(e,t,i,n){super(),this.form=e,this.field=t,this.name=t.name,this.fieldUI=i||{},this.fieldRes=n||{},this.init()}init(){this.buildRules()}buildRules(){this.rules=[];let{required:e}=this.fieldUI;(!0===e||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new w)}get checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);return e}get isOk(){if(0===this.rules.length)return!0;return 0===this.checkRules.length}get value(){return this.form.values[this.name]}setValue(e){this.form.values[this.name]=e}get error(){return this.form.errors[this.name]}set error(e){this.form.errors[this.name]=e}parse(e){return e}get readonly(){let{mode:e}=this.form;return e===K.readonly||e===K.edit&&!1===this.fieldUI.editable}}k([u.d],F.prototype,"checkRules",null),k([u.d],F.prototype,"isOk",null),k([u.d],F.prototype,"value",null);class C extends F{constructor(){super(...arguments),this.renderError=(e=>{let{errors:t}=this.form,i=t[this.name];if(void 0!==i)return n.createElement("div",{className:e},n.createElement(y.FA,{name:"exclamation-circle"})," ",i)}),this.ref=(e=>{this.input=e,this.setInputValue()}),this.onFocus=(()=>{this.error=void 0}),this.onBlur=(()=>{let e=this.checkRules;e.length>0&&(this.error=e[0]),this.form.computeFields()}),this.onChange=(e=>{let t=this.parse(e.currentTarget.value);null!==t&&this.setValue(t)}),this.view=Object(r.a)(()=>{let e,t,i,{required:s}=this.fieldUI,{placeHolder:r,suffix:o}=this.fieldRes,a=["form-control","form-control-input"];return!0===this.readonly?t=n.createElement("input",{className:p()(a,"bg-light"),ref:this.ref,type:this.inputType,readOnly:!0}):(t=n.createElement("input",{className:p()(a),ref:this.ref,type:this.inputType,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,placeholder:r,readOnly:!1,maxLength:this.maxLength,onKeyPress:this.onKeyPress}),!0!==s&&!1!==this.field.null||(e=n.createElement(P,null))),i=void 0===o?t:n.createElement("div",{className:"input-group"},t,n.createElement("div",{className:"input-group-append"},n.createElement("span",{className:"input-group-text"},o))),n.createElement(n.Fragment,null,e,i,this.renderError("text-danger small mt-1 mx-2"))})}get maxLength(){}setValue(e){super.setValue(e),this.setInputValue()}setInputValue(){if(!this.input)return;let e=this.value;this.input.value=null===e||void 0===e?"":e}}const P=()=>n.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*");class N extends C{constructor(){super(...arguments),this.inputType="text"}get maxLength(){return this.field.size}}const I=45,A=46;class V extends C{constructor(){super(...arguments),this.inputType="number",this.onKeyPress=(e=>{let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case A:this.onKeyDot();break;case I:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()})}init(){if(super.init(),this.extraChars=[],void 0!==this.fieldUI){let{min:e,max:t}=this.fieldUI;void 0!==e?e<0&&this.extraChars.push(I):this.extraChars.push(I)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(A)}}buildRules(){super.buildRules(),this.rules.push(new b);let{min:e,max:t}=this.fieldUI;void 0!==e&&this.rules.push(new E(e)),void 0!==t&&this.rules.push(new S(t))}parse(e){try{if(0===e.trim().length)return;let i=Number(e);return NaN===i?null:i}catch(t){return null}}setInputValue(){if(!this.input)return;let e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}onKeyDot(){let e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}onKeyNeg(){let e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}class q extends V{buildRules(){super.buildRules(),this.rules.push(new x)}}class O extends V{}class R extends N{}class T extends N{}class U extends F{constructor(e,t,i){super(e,t,void 0,i),this.view=Object(r.a)(()=>{let e=this.form.values[this.field.name],{placeHolder:t,suffix:i}=this.fieldRes;null===e&&(e="");let n,r=s.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:t,readOnly:!0,value:e});return n=void 0===i?r:s.a.createElement("div",{className:"input-group"},r,s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},i)))})}}var j=i(7),L=i.n(j),M=i(4),D=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class $ extends h.d{constructor(e,t,i){super(),this.rowPage=(()=>n.createElement(M.Page,{header:this.label,back:"close"},this.vForm.render("py-3"))),this.onSubmit=(()=>D(this,void 0,void 0,function*(){let{valueBoxs:e}=this.vForm;yield this.onRowChanged(e)})),this.onRowChanged=(e=>D(this,void 0,void 0,function*(){void 0===this.rowValues?(e.$owner=this.ownerForm.values,this.list.push(e),void 0===this.onEditRow?this.vForm.reset():yield this.onEditRow(void 0,this.onRowChanged)):(L.a.merge(this.rowValues,e),void 0===this.onEditRow&&M.nav.pop())})),this.renderItem=((e,t)=>void 0===this.rowContent?n.createElement("div",{className:"px-3 py-2"},n.createElement(h.a,Object.assign({},e))):n.createElement(this.rowContent,Object.assign({},e))),this.showRow=(e=>D(this,void 0,void 0,function*(){void 0===this.onEditRow?(this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),M.nav.push(n.createElement(this.rowPage,null))):yield this.onEditRow(e,this.onRowChanged)})),this.editRow=(e=>D(this,void 0,void 0,function*(){this.rowValues=e;let{vSubmit:t}=this.vForm;void 0!==t&&(t.caption=this.editSubmitCaption,t.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,yield this.showRow(e)})),this.internalAddRow=(()=>D(this,void 0,void 0,function*(){this.rowValues=void 0;let{vSubmit:e}=this.vForm;e.caption=this.newSubmitCaption,e.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=K.new,yield this.showRow(void 0)})),this.view=(()=>{let e;void 0===this.addRow&&this.mode===K.readonly||(e=n.createElement("button",{onClick:this.addRow||this.internalAddRow,type:"button",className:"btn btn-link p-0"},this.ownerForm.arrTitleNewButton));let t=this.header||n.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},n.createElement("div",{className:"flex-fill align-self-center"},this.label),e);return n.createElement(y.List,{className:"pb-3",header:t,none:n.createElement(y.Muted,{className:"px-3 py-2"},this.none),items:this.list,item:{render:this.renderItem,onClick:this.editRow}})}),this.ownerForm=e;let{name:s,fields:r}=t;this.name=s;let{ui:o,res:a,mode:l,inputs:c,values:u}=e,d=a.arrs,m=void 0!==d?d[s]:{},{label:f,none:v,newSubmit:p,editSubmit:g}=m;this.none=v||e.none,this.newSubmitCaption=p||e.arrNewCaption,this.editSubmitCaption=g||e.arrEditCaption,this.label=f||s;let w=o&&o.items[s]||{};this.rowContent=w.rowContent,this.mode=l,void 0===this.onEditRow?this.vForm=new W({fields:r,arrs:void 0,ui:w,res:m,inputs:c[s],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:l},l===K.readonly?void 0:this.onSubmit):this.onEditRow=i,this.list=u[s]}reset(){this.vForm.reset(),this.list.clear()}setAddRow(e){this.addRow=e}}var B=i(77),_=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const H={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"};class z extends F{constructor(e,t,i,s){super(e,t,i,s),this.onClick=(()=>_(this,void 0,void 0,function*(){if(!0===this.readonly){if(!this.value)return;return void(yield this.tuid.showInfo(this.value.id))}let e;void 0!==this.input?e=yield this.input.select(this.vForm,this.field,this.vForm.getValues()):(alert("call undefined"),e=0),this.setValue(this.tuid.boxId(e))})),this.view=Object(r.a)(()=>{let e,t,{placeHolder:i}=this.fieldRes,s=!1,{_ownerField:r}=this.field;if(void 0!==r){let{name:e,arr:t}=r;s=null===this.vForm.getValue(e)}if(null===this.value)e=n.createElement(n.Fragment,null,i||this.input.placeHolder);else if("object"===typeof this.value)e=Object(B.b)(this.value);else{let t=this.tuid.boxId(this.value);e=Object(B.b)(t)}if(!0===this.readonly)return n.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:this.onClick},e);let{required:o}=this.fieldUI;return!0!==o&&!1!==this.field.null||(t=n.createElement(P,null)),n.createElement(n.Fragment,null,t,n.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:s,style:H,onClick:this.onClick},e))}),this.tuid=t._tuid,this.vForm=e,this.input=e.inputs[t.name]}}class Q{constructor(e,t,i){this.vForm=e,this.onSubmit=i;let{fields:n,arrs:s,ui:r,res:o}=t;if(this.fields=n,this.arrs=s,void 0!==r){let{items:e,layout:t}=r;this.formItems=e,this.layout=t}this.res=o}build(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}resFromName(e,t){if(void 0===t)return;let{fields:i}=t;return void 0!==i?i[e]||e:void 0}bandsOnFly(){let e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs)for(let t of this.arrs)e.push(this.bandFromArr(t));return void 0!==this.onSubmit&&e.push(new c(new f(this.vForm))),e}bandsFromFields(e,t,i){if(void 0!==t)for(let n of t)e.push(this.bandFromField(n,i))}bandsFromLayout(){return[]}bandFromField(e,t){let i,n,s,r,{name:o}=e,l=this.resFromName(o,t);return"object"===typeof l?(n=l.label,i=l):(n=l,i=void 0),void 0!==this.formItems&&(r=this.formItems[o]),void 0===(s="function"===typeof r?new U(this.vForm,e,i):function(e,t,i,n){let s;switch(t.type){default:return;case"tinyint":case"smallint":case"int":s=q;break;case"bigint":let{_tuid:e}=t;if(void 0!==e)return;s=q;break;case"dec":s=O;break;case"char":s=N;break;case"text":s=R;break;case"datetime":s=T}return new s(e,t,i,n)}(this.vForm,e,r,i))&&(s=new z(this.vForm,e,r,i)),new a(n||o,s)}bandFromArr(e){let{name:t,fields:i}=e,n=new $(this.vForm,e);return new l(t,n)}}var K,J=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},G=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(K||(K={}));class W{constructor(e,t){this.vFields={},this.vArrs={},this.onFormSubmit=(e=>(e.preventDefault(),!1)),this.view=Object(r.a)(({className:e})=>n.createElement("form",{className:e,onSubmit:this.onFormSubmit},this.bands.map(e=>e.render())));let{fields:i,arrs:s,ui:o,res:a,inputs:l,none:c,submitCaption:h,arrNewCaption:u,arrEditCaption:d,arrTitleNewButton:m,mode:f}=e;this.fields=i,this.arrs=s,this.ui=o,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=a,this.inputs=l,this.none=c,this.submitCaption=h,this.arrNewCaption=u,this.arrEditCaption=d,this.arrTitleNewButton=m||n.createElement("small",null,n.createElement(y.FA,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===t?K.readonly:f,this.buildFormValues(),this.buildBands(e,t),this.onSubmit=t}buildBands(e,t){this.bandColl={};let i=new Q(this,e,t);this.bands=i.build();for(let n of this.bands){this.bandColl[n.key]=n;let e=n.getVFields();if(void 0!==e)for(let n of e)this.vFields[n.name]=n;let t=n.getVArr();void 0!==t&&(this.vArrs[t.name]=t);let i=n.getVSubmit();void 0!==i&&(this.vSubmit=i)}}getBand(e){return this.bandColl[e]}computeFields(){if(void 0===this.formItems)return;let e=this.values;for(let t in this.formItems){let i=this.formItems[t];"function"===typeof i&&(e[t]=i.call(e))}}submit(){return G(this,void 0,void 0,function*(){void 0!==this.onSubmit&&(yield this.onSubmit())})}getValues(){let e={},t=this.values;for(let i of this.fields){let{name:n}=i,s=t[n];e[n]=null!==s&&"object"===typeof s?s.id:s}if(void 0!==this.arrs)for(let i of this.arrs){let{name:t,fields:n,id:s,order:r}=i,o=e[t]=[],a=this.vArrs[t].list;for(let e of a){let t={};void 0!==s&&(t[s]=e[s]),void 0!==r&&(t[r]=e[r]);for(let i of n){let{name:n}=i,s=e[n];t[n]=null!==s&&"object"===typeof s?s.id:s}o.push(t)}}return e}get valueBoxs(){let e={},t=this.values;for(let i of this.fields){let{name:n,_tuid:s}=i,r=t[n];e[n]=void 0===s||"object"===typeof r?r:s.boxId(r)}if(void 0===this.arrs)return e;for(let i of this.arrs){let{name:t,fields:n,id:s,order:r}=i,o=e[t]=this.vArrs[t].list.slice();for(let e of o)for(let t of n){let{name:i,_tuid:n}=t,s=e[i];e[i]=void 0===n||"object"===typeof s?s:n.boxId(s)}}return e}setValues(e){if(void 0===e)return void this.reset();let t=this.values,i=this.errors;for(let n of this.fields){let s=n.name;i[s]=void 0;let r=e[s];t[s]=r}for(let n in this.vArrs){let i=e[n];if(void 0===i)continue;let s=t[n];s.clear(),s.push(...i)}}get isOk(){for(let e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}reset(){let e=this.values,t=this.errors;for(let i of this.fields){let n=i.name;e[n]=null,t[n]=void 0}for(let i in this.vFields){let e=this.vFields[i];void 0!==e.name&&e.setValue(null)}for(let i in this.vArrs){this.vArrs[i].reset()}}getValue(e){return this.values[e]}setValue(e,t){this.values[e]=t}setError(e,t){this.errors[e]=t}buildFieldValues(e){let t={valueFromFieldName:function(e){return this[e]}};for(let i of e){t[i.name]=null}return t}buildObservableValues(){let e=this.buildFieldValues(this.fields);if(void 0!==this.arrs)for(let t of this.arrs)e[t.name]=u.k.array([],{deep:!0});return Object(u.k)(e)}buildFormValues(){this.values=this.buildObservableValues(),this.errors=Object(u.k)(this.buildFieldValues(this.fields))}render(e="py-3"){return n.createElement(this.view,{className:e})}}J([u.d],W.prototype,"isOk",null),i.d(t,"a",function(){return K}),i.d(t,"b",function(){return W})},85:function(e,t,i){"use strict";var n=i(1),s=i(7),r=i.n(s),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const a="\t",l="\n";class c{constructor(e,t,i){this.fieldMaps={},this.entities=e,this.name=t,this.typeId=i,this.sys=this.name.indexOf("$")>=0}get sName(){return this.jName||this.name}get tvApi(){return this.entities.usqApi}getApiFrom(){return o(this,void 0,void 0,function*(){return this.entities.usqApi})}fieldMap(e){void 0===e&&(e="$");let t=this.fieldMaps[e];if(void 0===t){let i;if("$"===e)i=this.fields;else if(void 0!==this.arrFields){let t=this.arrFields.find(t=>t.name===e);void 0!==t&&(i=t.fields)}else if(void 0!==this.returns){let t=this.returns.find(t=>t.name===e);void 0!==t&&(i=t.fields)}if(void 0===i)return{};t={};for(let e of i)t[e.name]=e;this.fieldMaps[e]=t}return t}loadSchema(){return o(this,void 0,void 0,function*(){if(void 0!==this.schema)return;let e=yield this.entities.usqApi.schema(this.name);this.setSchema(e)})}setSchema(e){if(void 0===e)return;if(void 0!==this.schema)return;this.schema=e;let{name:t,fields:i,arrs:n,returns:s}=e;t!==this.name&&(this.jName=t),this.entities.buildFieldTuid(this.fields=i),this.entities.buildArrFieldsTuid(this.arrFields=n,i),this.entities.buildArrFieldsTuid(this.returns=s,i)}schemaStringify(){return JSON.stringify(this.schema,(e,t)=>{if("_tuid"!==e)return t},4)}tuidFromField(e){let{_tuid:t,tuid:i}=e;if(void 0!==i)return void 0!==t?t:e._tuid=this.entities.getTuid(i,void 0)}tuidFromName(e,t){if(void 0===this.schema)return;let{fields:i,arrs:n}=this.schema,s=this.entities;function r(e,t){if(void 0===t)return;let i=t.find(t=>t.name===e);return void 0!==i?s.getTuid(i.tuid,void 0):void 0}let o=e.toLowerCase();if(void 0===t)return r(o,i);if(void 0===n)return;let a=t.toLowerCase(),l=n.find(e=>e.name===a);return void 0!==l?r(o,l.fields):void 0}pack(e){let t=[],i=this.fields;void 0!==i&&this.packRow(t,i,e);let n=this.arrFields;if(void 0!==n)for(let s of n)this.packArr(t,s.fields,e[s.name]);return t.join("")}escape(e,t){let i=e[t.name];switch(typeof i){default:return i;case"object":let e=t._tuid;return void 0===e?i.id:e.getIdFromObj(i);case"string":let n=i.length,s="",r=0;for(let t=0;t<n;t++){switch(i.charCodeAt(t)){case 9:s+=i.substring(r,t)+"\\t",r=t+1;break;case 10:s+=i.substring(r,t)+"\\n",r=t+1}}return s+i.substring(r);case"undefined":return""}}packRow(e,t,i){let n=t.length;if(0===n)return;let s="";s+=this.escape(i,t[0]);for(let r=1;r<n;r++){let e=t[r];s+=a+this.escape(i,e)}e.push(s+l)}packArr(e,t,i){if(void 0!==i)for(let n of i)this.packRow(e,t,n);e.push(l)}unpackSheet(e){let t={},i=this.fields,n=0;void 0!==i&&(n=this.unpackRow(t,i,e,n));let s=this.arrFields;if(void 0!==s)for(let r of s)n=this.unpackArr(t,r,e,n);return t}unpackReturns(e){let t={},i=0,n=this.returns;if(void 0!==n)for(let s of n)i=this.unpackArr(t,s,e,i);return t}unpackRow(e,t,i,n){let s=0,r=0,o=n,a=0,l=i.length,c=t.length;for(;n<l;n++)if(s=r,9===(r=i.charCodeAt(n))){let r=t[a];if(8!==s){if(n>o){let t=i.substring(o,n);e[r.name]=this.to(e,t,r)}}else e[r.name]=null;if(o=n+1,++a>=c)break}else if(10===r){let r=t[a];if(8!==s){if(n>o){let t=i.substring(o,n);e[r.name]=this.to(e,t,r)}}else e[r.name]=null;++n,++a;break}return n}to(e,t,i){switch(i.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":let e=Number(t),{_tuid:n}=i;return void 0===n?e:(n.useId(e,!0),n.boxId(e))}}unpackArr(e,t,i,n){let s=[],r=i.length,{name:o,fields:a}=t;for(;n<r;){if(10===i.charCodeAt(n)){++n;break}let e={};s.push(e),n=this.unpackRow(e,a,i,n)}return e[o]=s,n}}var h=i(152),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d=1e3;class m extends c{constructor(e,t,i){super(e,t,i),this.queue=[],this.waitingIds=[],this.cache=n.k.map({},{deep:!1}),this.buildIdBoxer()}get typeName(){return"tuid"}buildIdBoxer(){this.BoxId=function(){};let e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this,writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.toJSON=function(){return this.id}}boxId(e){this.useId(e);let t=new this.BoxId;return t.id=e,t}getTuidContent(){return this.entities.cUsq.getTuidContent(this)}getIdFromObj(e){return e[this.idName]}setSchema(e){super.setSchema(e);let{id:t,unique:i}=e;this.idName=t,this.unique=i,this.schemaFrom=this.schema.from}moveToHead(e){let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.queue.push(e)}valueFromId(e){let t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}let i=this.cache.get(t);return void 0!==this.owner&&"object"===typeof i&&(i.$owner=this.owner.boxId(i.owner)),i}valueFromFieldName(e,t){if(void 0===t)return;let i=this.fields.find(t=>t.name===e);if(void 0===i)return;let n=t[e],{_tuid:s}=i;return void 0===s?n:s.valueFromId(n)}resetCache(e){this.cache.delete(e);let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.useId(e)}useId(e,t){if(void 0!==e&&0!==e&&!1!==Object(h.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(t=>t===e)>=0)this.moveToHead(e);else{if(this.queue.length>=d){let t=this.queue.shift();if(t===e)return void this.queue.push(t);if(!0===this.cache.has(t))this.cache.delete(t);else{let e=this.waitingIds.findIndex(e=>e===t);this.waitingIds.splice(e,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}proxied(e,t){return u(this,void 0,void 0,function*(){this.entities.getTuid(e,void 0).useId(t);let i=yield this.tvApi.proxied(this.name,e,t);return this.cacheValue(i),i})}cacheValue(e){if(void 0===e)return!1;let t=this.getIdFromObj(e);if(void 0===t)return!1;let i=this.waitingIds.findIndex(e=>e===t);return i>=0&&this.waitingIds.splice(i,1),this.cache.set(t,e),!0}afterCacheId(e){for(let t of this.fields){let{_tuid:i}=t;void 0!==i&&i.useId(e[t.name])}}cacheIds(){return u(this,void 0,void 0,function*(){if(0===this.waitingIds.length)return;let e,t;void 0===this.owner?e=this.name:(e=this.owner.name,t=this.name);let i=yield this.getApiFrom(),n=yield i.tuidIds(e,t,this.waitingIds);for(let s of n)!1!==this.cacheValue(s)&&(this.cacheTuidFieldValues(s),this.afterCacheId(s))})}load(e){return u(this,void 0,void 0,function*(){if(void 0===e||0===e)return;let t=yield this.getApiFrom(),i=yield t.tuidGet(this.name,e);return void 0!==i?(i._$tuid=this,this.cacheValue(i),this.cacheTuidFieldValues(i),i):void 0})}getDiv(e){}cacheTuidFieldValues(e){let{fields:t,arrs:i}=this.schema;if(this.cacheFieldsInValue(e,t),void 0!==i)for(let n of i){let{name:t,fields:i}=n,s=e[t];if(void 0===s)continue;let r=this.getDiv(t);for(let e of s)e._$tuid=r,e.$owner=this.boxId(e.owner),this.cacheFieldsInValue(e,i)}}cacheFieldsInValue(e,t){for(let i of t){let{name:t,_tuid:n}=i;if(void 0===n)continue;let s=e[t];e[t]=n.boxId(s)}}save(e,t){return u(this,void 0,void 0,function*(){let i=r.a.clone(t);i.$id=e;let n=yield this.tvApi.tuidSave(this.name,i),{id:s,inId:o}=n;return void 0===s?(i.id=e,this.cacheValue(i)):s>0&&(i.id=s,this.cacheValue(i)),n})}search(e,t,i){return u(this,void 0,void 0,function*(){return yield this.searchArr(void 0,e,t,i)})}searchArr(e,t,i,n){return u(this,void 0,void 0,function*(){let s,r,{fields:o}=this.schema;void 0!==this.owner?(s=this.owner.name,r=this.name):(s=this.name,r=void 0);let a=yield this.getApiFrom(),l=yield a.tuidSearch(s,r,e,t,i,n);for(let e of l)this.cacheFieldsInValue(e,o),void 0!==this.owner&&(e.$owner=this.owner.boxId(e.owner));return l})}loadArr(e,t,i){return u(this,void 0,void 0,function*(){if(void 0===i||0===i)return;let n=yield this.getApiFrom();return yield n.tuidArrGet(this.name,e,t,i)})}saveArr(e,t,i,n){return u(this,void 0,void 0,function*(){let s=r.a.clone(n);return s.$id=i,yield this.tvApi.tuidArrSave(this.name,e,t,s)})}posArr(e,t,i,n){return u(this,void 0,void 0,function*(){return yield this.tvApi.tuidArrPos(this.name,e,t,i,n)})}showInfo(e){return u(this,void 0,void 0,function*(){yield this.entities.cUsq.showTuid(this,e)})}}class f extends m{get Main(){return this}setSchema(e){super.setSchema(e);let{arrs:t}=e;if(void 0!==t){this.divs={};for(let e of t){let{name:t}=e,i=new v(this.entities,t,this.typeId);i.owner=this,this.divs[t]=i,i.setSchema(e)}}}getDiv(e){return this.divs[e]}cacheIds(){const e=Object.create(null,{cacheIds:{get:()=>super.cacheIds}});return u(this,void 0,void 0,function*(){if(yield e.cacheIds.call(this),void 0!==this.divs)for(let e in this.divs)yield this.divs[e].cacheIds()})}cUsqFrom(){return u(this,void 0,void 0,function*(){if(void 0===this.schemaFrom)return this.entities.cUsq;let{owner:e,usq:t}=this.schemaFrom,i=yield this.entities.cUsq,n=i.cApp;if(void 0===n)return i;let s=yield n.getImportUsq(e,t);if(void 0===s)return console.error(`${e}/${t} \u4e0d\u5b58\u5728`),i;let r=yield s.loadSchema();return void 0!==r?(console.error("cUsq.loadSchema: "+r),i):s})}getApiFrom(){return u(this,void 0,void 0,function*(){let e=yield this.from();return void 0!==e?e.entities.usqApi:this.entities.usqApi})}from(){return u(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).tuid(this.name)})}cFrom(){return u(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidMainFromName(this.name)})}cEditFrom(){return u(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidEditFromName(this.name)})}cInfoFrom(){return u(this,void 0,void 0,function*(){return(yield this.cUsqFrom()).cTuidInfoFromName(this.name)})}cSelectFrom(){return u(this,void 0,void 0,function*(){let e=yield this.cUsqFrom();if(void 0!==e)return e.cTuidSelectFromName(this.name)})}afterCacheId(e){if(super.afterCacheId(e),void 0===this.proxies)return;let{type:t,$proxy:i}=e;this.proxies[t].useId(i)}}class v extends m{get Main(){return this.owner}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y extends c{get typeName(){return"action"}submit(e){return p(this,void 0,void 0,function*(){yield this.loadSchema();let t=this.pack(e);return yield this.tvApi.action(this.name,{data:t})})}}var g=i(4),w=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends c{get typeName(){return"sheet"}setSchema(e){super.setSchema(e),this.states=e.states}build(e){this.states=[];for(let t of e.ops)this.states.push({name:t,actions:void 0})}createSheetState(e,t){let i={name:e,actions:[]},n=i.actions;for(let s in t){let e={name:s};n.push(e)}return i}save(e,t){return w(this,void 0,void 0,function*(){let{appId:i}=this.entities,n=this.pack(t);return yield this.tvApi.sheetSave(this.name,{app:i,discription:e,data:n})})}action(e,t,i,n){return w(this,void 0,void 0,function*(){return yield this.tvApi.sheetAction(this.name,{id:e,flow:t,state:i,action:n})})}unpack(e){return w(this,void 0,void 0,function*(){let t=e[0][0];return{brief:t,data:this.unpackSheet(t.data),flows:e[1]}})}getSheet(e){return w(this,void 0,void 0,function*(){let t=yield this.tvApi.getSheet(this.name,e);return 0===t[0].length?yield this.getArchive(e):yield this.unpack(t)})}getArchive(e){return w(this,void 0,void 0,function*(){let t=yield this.tvApi.sheetArchive(this.name,e);return yield this.unpack(t)})}getArchives(e,t){return w(this,void 0,void 0,function*(){return yield this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t})})}getStateSheets(e,t,i){return w(this,void 0,void 0,function*(){return yield this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:i})})}createPageStateItems(){return new x(this)}stateSheetCount(){return w(this,void 0,void 0,function*(){let e=yield this.tvApi.stateSheetCount(this.name);return this.states.map(t=>{let i=t.name,n=0,s=e.find(e=>e.state===i);return void 0!==s&&(n=s.count),{state:i,count:n}})})}}class x extends g.PageItems{constructor(e){super(!0),this.sheet=e,this.pageSize=10}load(e,t,i){return w(this,void 0,void 0,function*(){return yield this.sheet.getStateSheets(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var E=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends c{get typeName(){return"query"}setSchema(e){super.setSchema(e);let{returns:t}=e;this.returns=t,this.isPaged=void 0!==t.find(e=>"$page"===e.name)}resetPage(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}get hasMore(){return this.more}loadPage(){return E(this,void 0,void 0,function*(){if(void 0===this.pageSize)throw"call resetPage(size:number, params:any) first";let e;if(void 0!==this.pageStart)switch(this.startField.type){default:e=this.pageStart;break;case"date":case"time":case"datetime":e=this.pageStart.getTime()}yield this.loadSchema();let t=yield this.tvApi.page(this.name,e,this.pageSize+1,this.params),i=yield this.unpackReturns(t);this.list=n.k.array([],{deep:!1});let s=i.$page;if(void 0!==s){if(s.length>this.pageSize){this.more=!0,s.pop();let e=this.returns.find(e=>"$page"===e.name);this.startField=e.fields[0],this.pageStart=s[s.length-1][this.startField.name]}else this.more=!1;this.list.push(...s)}})}page(e,t,i){return E(this,void 0,void 0,function*(){yield this.loadSchema();let n=yield this.tvApi.page(this.name,t,i+1,e);return(yield this.unpackReturns(n)).$page})}query(e){return E(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.query(this.name,e);return yield this.unpackReturns(t)})}table(e){return E(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return E(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return E(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([n.k],S.prototype,"list",void 0);class k extends S{constructor(){super(...arguments),this.queryApiName="book"}get typeName(){return"book"}}class F extends S{constructor(){super(...arguments),this.queryApiName="history"}get typeName(){return"history"}}var C=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class P extends c{constructor(){super(...arguments),this.actions={},this.queries={}}get typeName(){return"map"}setSchema(e){super.setSchema(e),this.schemaFrom=this.schema.from;let{actions:t,queries:i,keys:n}=e;this.entities.buildFieldTuid(this.keys=n);for(let s in t){let e=t[s],{name:i}=e,n=this.entities.newAction(i,void 0);n.setSchema(e),this.actions[s]=n}for(let s in i){let e=i[s],{name:t}=e,n=this.entities.newQuery(t,void 0);n.setSchema(e),this.queries[s]=n}}add(e){return C(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.add.submit(e)})}del(e){return C(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.del.submit(e)})}all(){return C(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.all.query({})})}page(e,t,i){return C(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.page.page(e,t,i)})}query(e){return C(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.query.query(e)})}table(e){return C(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return C(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return C(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}class N extends S{constructor(){super(...arguments),this.queryApiName="pending"}get typeName(){return"pending"}}var I=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function A(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}class V{constructor(e,t,i){this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=(()=>{this.clearCacheTimer();for(let e in this.tuids){this.tuids[e].cacheIds()}}),this.cUsq=e,this.usqApi=t,this.appId=i}tuid(e){return this.tuids[e.toLowerCase()]}action(e){return this.actions[e.toLowerCase()]}sheet(e){return this.sheets[e.toLowerCase()]}query(e){return this.queries[e.toLowerCase()]}book(e){return this.books[e.toLowerCase()]}map(e){return this.maps[e.toLowerCase()]}history(e){return this.histories[e.toLowerCase()]}pending(e){return this.pendings[e.toLowerCase()]}sheetFromTypeId(e){for(let t in this.sheets){let i=this.sheets[t];if(i.typeId===e)return i}}loadAccess(){return I(this,void 0,void 0,function*(){let e=yield this.usqApi.loadAccess();this.buildEntities(e)})}loadEntities(){return I(this,void 0,void 0,function*(){let e=yield this.usqApi.loadEntities();this.buildEntities(e)})}buildEntities(e){let{access:t,tuids:i}=e;this.buildTuids(i),this.buildAccess(t)}getTuid(e,t,i){let n=this.tuids[e];if(void 0!==n)return void 0===t?n:n.divs[t]}cacheTuids(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}clearCacheTimer(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}buildTuids(e){let t={};for(let i in e){let n=e[i],{name:s,typeId:r,proxies:o}=n;this.newTuid(i,r).sys=!0,void 0!==o&&(t[i]=o)}for(let i in e){let t=e[i],{name:n}=t;this.getTuid(i).setSchema(t)}for(let i in t){let e=t[i],n=this.tuids[i];n.proxies={};for(let t of e)n.proxies[t]=this.tuids[t]}}buildAccess(e){for(let t in e){let i=e[t];switch(typeof i){case"string":this.fromType(t,i);break;case"object":this.fromObj(t,i)}}}newAction(e,t){let i=this.actions[e];return void 0!==i?i:(i=this.actions[e]=new y(this,e,t),this.actionArr.push(i),i)}newTuid(e,t){let i=this.tuids[e];return void 0!==i?i:(i=this.tuids[e]=new f(this,e,t),this.tuidArr.push(i),i)}newQuery(e,t){let i=this.queries[e];return void 0!==i?i:(i=this.queries[e]=new S(this,e,t),this.queryArr.push(i),i)}newBook(e,t){let i=this.books[e];return void 0!==i?i:(i=this.books[e]=new k(this,e,t),this.bookArr.push(i),i)}newMap(e,t){let i=this.maps[e];return void 0!==i?i:(i=this.maps[e]=new P(this,e,t),this.mapArr.push(i),i)}newHistory(e,t){let i=this.histories[e];if(void 0===i)return i=this.histories[e]=new F(this,e,t),this.historyArr.push(i),i}newPending(e,t){let i=this.pendings[e];if(void 0===i)return i=this.pendings[e]=new N(this,e,t),this.pendingArr.push(i),i}newSheet(e,t){let i=this.sheets[e];return void 0!==i?i:(i=this.sheets[e]=new b(this,e,t),this.sheetArr.push(i),i)}fromType(e,t){let i=t.split("|");t=i[0];let n=Number(i[1]);switch(t){case"usq":this.usqId=n;break;case"tuid":this.newTuid(e,n).sys=!1;break;case"action":this.newAction(e,n);break;case"query":this.newQuery(e,n);break;case"book":this.newBook(e,n);break;case"map":this.newMap(e,n);break;case"history":this.newHistory(e,n);break;case"sheet":this.newSheet(e,n);break;case"pending":this.newPending(e,n)}}fromObj(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}buildSheet(e,t){let i=this.sheets[e];void 0===i&&(i=this.newSheet(e,t.id)),i.build(t)}buildFieldTuid(e,t){if(void 0!==e){for(let t of e){let{tuid:e,arr:i,url:n}=t;void 0!==e&&(t._tuid=this.getTuid(e,i,n))}for(let i of e){let{owner:n}=i;if(void 0===n)continue;let s=e.find(e=>e.name===n);if(void 0===s&&(void 0!==t&&(s=t.find(e=>e.name===n)),void 0===s))throw`owner field ${n} is undefined`;i._ownerField=s;let{arr:r,url:o}=i;if(i._tuid=this.getTuid(s._tuid.name,r,o),void 0===i._tuid)throw"owner field ${owner} is not tuid"}}}buildArrFieldsTuid(e,t){if(void 0!==e)for(let i of e){let{fields:e}=i;void 0!==e&&this.buildFieldTuid(e,t)}}}i.d(t,"b",function(){return A}),i.d(t,"a",function(){return V})},86:function(e,t,i){"use strict";var n=i(0),s=i(2),r=i.n(s),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{}class l extends a{constructor(e){super(),this.onClick=(()=>o(this,void 0,void 0,function*(){yield this.controller.start()})),this.view=(e=>n.createElement("div",{className:r()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)),this.controller=e,this.icon=e.icon,this.label=e.label}render(e){return n.createElement(this.view,e)}}i.d(t,"a",function(){return l})},92:function(e,t,i){"use strict";i.d(t,"a",function(){return c});var n=i(0),s=i(4),r=i(75),o=i(98),a=i(95),l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends s.Controller{constructor(e,t){super(Object(s.resLang)(t&&t.res)),this.cImportUsqs={},this.cUsqCollection={},this.renderRow=((e,t)=>{let{id:i,nick:s,name:o}=e;return n.createElement(r.LMR,{className:"px-3 py-2",right:"id: "+i},n.createElement("div",null,s||o))}),this.onRowClick=(e=>l(this,void 0,void 0,function*(){s.meInFrame.unit=e.id,yield this.start()})),this.selectUnitPage=(()=>n.createElement(s.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:!0},n.createElement(r.List,{items:this.appUnits,item:{render:this.renderRow,onClick:this.onRowClick}})));let i=e.split("/");if(2!==i.length)throw"tonvaApp name must be / separated, owner/app";this.appOwner=i[0],this.appName=i[1],this.ui=t||{usqs:{}},this.caption=this.res.caption||"Tonva"}startDebug(){return l(this,void 0,void 0,function*(){let e=this.appOwner+"/"+this.appName,t=new c(e,{usqs:{}});yield t.start(!0)})}loadUsqs(){return l(this,void 0,void 0,function*(){let e=[],t=(s.meInFrame.unit,yield Object(s.loadAppUsqs)(this.appOwner,this.appName)),{id:i,usqs:n}=t;this.id=i;for(let s of n){let{id:t,usqOwner:i,usqName:n,url:r,urlDebug:o,ws:a,access:l,token:c}=s,h=i+"/"+n,u=this.ui&&this.ui.usqs&&this.ui.usqs[h],d=this.newCUsq(h,t,l,u||{}),m=yield d.loadSchema();void 0===m?this.cUsqCollection[h]=d:e.push(m)}if(0!==e.length)return e})}getImportUsq(e,t){return l(this,void 0,void 0,function*(){let i=e+"/"+t,n=this.cImportUsqs[i];if(void 0!==n)return n;let s=this.ui&&this.ui.usqs&&this.ui.usqs[i];this.cImportUsqs[i]=n=this.newCUsq(i,-1,void 0,s||{});let r=yield n.loadSchema();if(void 0===r)return n;console.error(r)})}newCUsq(e,t,i,n){let s=new(this.ui.CUsq||o.a)(this,e,this.id,t,i,n);return Object.setPrototypeOf(s.x,this.x),s}get cUsqArr(){let e=[];for(let t in this.cUsqCollection)e.push(this.cUsqCollection[t]);return e}getCUsq(e){return this.cUsqCollection[e]}get VAppMain(){return this.ui&&this.ui.main||h}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return l(this,void 0,void 0,function*(){if(!1===(yield e.beforeStart.call(this)))return!1;try{let e=document.location.hash;e.startsWith("#tvdebug")?this.isProduction=!1:this.isProduction=e.startsWith("#tv");let{unit:i}=s.meInFrame;if(!1===this.isProduction&&(void 0===i||i<=0)){let e=yield Object(s.loadAppUsqs)(this.appOwner,this.appName),{id:t}=e;switch(this.id=t,yield this.loadAppUnits(),this.appUnits.length){case 0:return this.showUnsupport(),!1;case 1:if(void 0===(i=this.appUnits[0].id)||i<0)return this.showUnsupport(),!1;s.meInFrame.unit=i;break;default:return s.nav.push(n.createElement(this.selectUnitPage,null)),!1}}let r=yield this.loadUsqs();return void 0===r||(this.openPage(n.createElement(s.Page,{header:"ERROR"},n.createElement("div",{className:"m-3"},n.createElement("div",null,"Load Usqs \u53d1\u751f\u9519\u8bef\uff1a"),r.map((e,t)=>n.createElement("div",{key:t},e))))),!1)}catch(t){return s.nav.push(n.createElement(s.Page,{header:"App start error!"},n.createElement("pre",null,"string"===typeof t?t:t.message))),!1}})}internalStart(e){return l(this,void 0,void 0,function*(){!0!==e&&this.clearPrevPages(),yield this.showMainPage()})}load(){return l(this,void 0,void 0,function*(){yield this.beforeStart()})}render(){return this.renderView(this.VAppMain)}clearPrevPages(){s.nav.clear()}showUnsupport(){this.clearPrevPages(),this.openPage(n.createElement(s.Page,{header:"APP\u65e0\u6cd5\u8fd0\u884c",logout:!0},n.createElement("div",{className:"m-3 text-danger container"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},n.createElement(r.FA,{name:"exclamation-triangle"})),n.createElement("div",{className:"col"},"\u7528\u6237\u4e0d\u652f\u6301APP")),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"\u7528\u6237: "),n.createElement("div",{className:"col"},`${s.nav.user.name}`)),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"App:"),n.createElement("div",{className:"col"},`${this.appOwner}/${this.appName}`)))))}showMainPage(){return l(this,void 0,void 0,function*(){let e=document.location.hash.split("-");if(e.length>2){let t=e[2];if("sheet"===t||"sheet_debug"===t){let t=Number(e[3]),i=Number(e[4]),n=Number(e[5]),s=this.getCUsqFromId(t);return void 0===s?void alert("unknown usqId: "+t):(this.clearPrevPages(),void(yield s.navSheet(i,n)))}}this.showVPage(this.VAppMain)})}getCUsqFromId(e){for(let t in this.cUsqCollection){let i=this.cUsqCollection[t];if(i.id===e)return i}}loadAppUnits(){return l(this,void 0,void 0,function*(){let e=yield a.a.userAppUnits(this.id);this.appUnits=e,1===e.length&&(s.meInFrame.unit=e[0].id)})}}class h extends s.VPage{constructor(){super(...arguments),this.appContent=(()=>{let e,{cUsqArr:t}=this.controller;return e=0===t.length?n.createElement("div",{className:"text-danger"},n.createElement(r.FA,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684USQ"):t.map((e,t)=>n.createElement("div",{key:t},e.render())),n.createElement(n.Fragment,null,e)})}showEntry(e){return l(this,void 0,void 0,function*(){this.openPage(this.appPage)})}render(e){return this.appContent()}appPage(){let{caption:e}=this.controller;return n.createElement(s.Page,{header:e,logout:()=>{s.meInFrame.unit=void 0}},this.appContent())}}},93:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i.n(n),r=i(75);function o(e,t){return s.a.createElement(r.FA,{className:e,name:t,fixWidth:!0})}const a={tuid:o("text-info","list-alt"),action:o("text-info","hand-o-right"),map:o("text-muted","list-ul"),book:o("text-muted","book"),query:o("text-warning","search"),history:o("text-info","hand-o-right"),pending:o("text-info","forward"),sheet:o("text-primary","wpforms")}},94:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(4);class s extends n.Controller{constructor(e,t){super(t),this.cUsq=e}}},95:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(4),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const r=new class extends n.CenterApi{userAppUnits(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0)},96:function(e,t,i){"use strict";var n=i(1),s=i(4),r=i(74),o=i(0),a=i.n(o),l=i(8),c=i(78),h=i(75),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends r.b{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:n}=e;if(0===n)return null;let s=o.createElement(c.a,{className:"ml-5 align-self-end",color:"success"},n);return o.createElement(h.LMR,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:s})}),this.view=Object(l.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=o.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),o.createElement(s.Page,{header:this.label},o.createElement(h.LMR,{className:"mx-3 my-2",right:i},o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),o.createElement(h.List,{className:"my-2",header:o.createElement(h.Muted,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}showEntry(){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}}var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends r.b{constructor(){super(...arguments),this.onSubmit=(()=>m(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=this.vForm.values;yield this.controller.onSave(e,t)})),this.view=(()=>o.createElement(s.Page,{header:this.label},this.vForm.render()))}showEntry(e){return m(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view)})}}var v=i(84);const p={width:"8rem"};class y extends r.b{constructor(){super(...arguments),this.flowRow=((e,t)=>{let i,{date:n,user:s,preState:r,state:a,action:l}=e;switch(void 0===l&&(l=o.createElement(o.Fragment,null,o.createElement(h.FA,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),a){case"$":break;case"#":i=o.createElement(o.Fragment,null,o.createElement(h.FA,{className:"text-success",name:"file-archive-o"}));break;default:i=o.createElement(o.Fragment,null,o.createElement(h.FA,{className:"text-muted",name:"arrow-right"})," \xa0 ",a)}return o.createElement(h.LMR,{left:o.createElement("div",{className:"pl-3 py-2",style:p},l),right:o.createElement("div",{className:"p-2"},o.createElement(h.Muted,null,o.createElement(h.EasyDate,{date:n})))},o.createElement("div",{className:"p-2"},i))}),this.sheetView=(()=>{let e,{brief:t,flows:i}=this.sheetData;return"-"===t.state&&(e=o.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),o.createElement("div",null,e,this.vForm.render(),o.createElement(h.List,{header:o.createElement(h.Muted,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:this.flowRow}}))})}}var g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w extends y{constructor(){super(...arguments),this.onSubmit=(()=>g(this,void 0,void 0,function*(){let e=this.vForm.getValues();yield this.controller.saveSheet(e,this.vForm.values),this.closePage(),this.returnCall(this.vForm.values)})),this.view=(()=>o.createElement(s.Page,{header:this.label},this.vForm.render()))}showEntry(e){return g(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,v.a.edit),this.openPage(this.view)})}}var b=i(2),x=i.n(b),E=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends y{constructor(){super(...arguments),this.actionClick=(e=>E(this,void 0,void 0,function*(){let{id:t,flow:i,state:n}=this.sheetData.brief;yield this.controller.action(t,i,n,e.name);this.ceasePage(),this.openPage(this.acted)})),this.deleteClick=(()=>E(this,void 0,void 0,function*(){alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d")})),this.editClick=(()=>E(this,void 0,void 0,function*(){let e=yield this.controller.editSheet(this.sheetData);this.vForm.setValues(e)})),this.page=(()=>{let e,t,{brief:i}=this.sheetData,{state:n,no:r}=i,o=this.controller.getStateLabel(n),{states:l}=this.entity,h=l.find(e=>e.name===n);if(void 0===h){let t,i;switch(n){default:t="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+n+"'",i="text-info";break;case"-":t="\u5df2\u4f5c\u5e9f",i="text-danger";break;case"#":t="\u5df2\u5f52\u6863",i="text-success"}e=a.a.createElement("div",{className:x()(i)},"[",t,"]")}else e=a.a.createElement("div",{className:"flex-grow-1"},h.actions.map((e,t)=>a.a.createElement(c.b,{key:t,className:"mr-2",color:"primary",onClick:()=>this.actionClick(e)},this.controller.getActionLabel(n,e.name)))),"$"===n&&(t=a.a.createElement("div",null,a.a.createElement(c.b,{outline:!0,className:"ml-2",color:"info",onClick:this.editClick},"\u4fee\u6539"),a.a.createElement(c.b,{outline:!0,className:"ml-2",color:"danger",onClick:this.deleteClick},"\u4f5c\u5e9f")));return a.a.createElement(s.Page,{header:this.label+":"+o+"-"+r},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},e,t),a.a.createElement(this.sheetView,null)))}),this.acted=(()=>{let{discription:e}=this.sheetData.brief;return a.a.createElement(s.Page,{header:"\u5df2\u5904\u7406",back:"close"},a.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},a.a.createElement("div",{className:"p-3"},e),a.a.createElement("div",{className:"text-success"},a.a.createElement(h.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),a.a.createElement("div",{className:"p-3"},a.a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de"))))})}showEntry(e){return E(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var k=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class F extends r.b{constructor(){super(...arguments),this.view=(()=>o.createElement(s.Page,{header:this.label+"\u6a21\u677f"},o.createElement("pre",{className:"mx-3 my-2"},this.entity.schemaStringify())))}showEntry(e){return k(this,void 0,void 0,function*(){this.openPage(this.view)})}}var C=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class P extends r.b{constructor(){super(...arguments),this.archiveClick=(e=>C(this,void 0,void 0,function*(){1!==e.processing&&this.event("archived",e)})),this.archiveRow=((e,t)=>{let{id:i,no:n,discription:s,date:r}=e,a=o.createElement(o.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),l=o.createElement(h.Muted,null,o.createElement(h.EasyDate,{date:r}));return o.createElement(h.LMR,{className:"px-3 py-2",left:a,right:l})}),this.view=(()=>o.createElement(s.Page,{header:"\u5df2\u5f52\u6863"+this.label},o.createElement(h.List,{items:this.list,item:{render:this.archiveRow,onClick:this.archiveClick}})))}showEntry(){return C(this,void 0,void 0,function*(){this.list=yield this.entity.getArchives(void 0,10),this.openPage(this.view)})}}var N=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class I extends r.b{constructor(){super(...arguments),this.rowClick=(e=>N(this,void 0,void 0,function*(){1!==e.processing?this.event("action",e.id):this.event("processing",e.id)})),this.onScrollBottom=(()=>{console.log("onScrollBottom"),this.controller.pageStateItems.more()}),this.rowContent=(e=>{let{id:t,no:i,discription:n,date:s,processing:r}=e,a=o.createElement(o.Fragment,null,i," \xa0 ",o.createElement(h.Muted,null,n)," ",1===r?"...":""),l=o.createElement(h.Muted,null,o.createElement(h.EasyDate,{date:s}));return o.createElement(h.LMR,{className:"px-3 py-2",left:a,right:l})}),this.renderRow=((e,t)=>o.createElement(this.row,Object.assign({},e))),this.view=(()=>{let{pageStateItems:e}=this.controller;return o.createElement(s.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottom},o.createElement(h.List,{items:e,item:{render:this.renderRow,onClick:this.rowClick}}))})}showEntry(e){return N(this,void 0,void 0,function*(){this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),yield this.controller.pageStateItems.first(this.stateName),this.openPage(this.view)})}}var A=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class V extends y{constructor(){super(...arguments),this.view=(()=>{let{brief:e}=this.sheetData;return o.createElement(s.Page,{header:this.label+":-"+e.no},o.createElement(this.sheetView,null))})}showEntry(e){return A(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view)})}}class q extends r.b{}var O=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class R extends q{constructor(){super(...arguments),this.restart=(()=>O(this,void 0,void 0,function*(){this.ceasePage(),yield this.event("new")})),this.actionClick=(e=>O(this,void 0,void 0,function*(){this.ceasePage();let{id:t,flow:i,state:n}=this.brief;yield this.controller.action(t,i,n,e.name);this.openPage(this.acted)})),this.buttons=o.createElement(o.Fragment,null,o.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:this.restart},"\u7ee7\u7eed\u5f00\u5355"),o.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de")),this.view=(()=>{let{states:e}=this.entity;let t=e.find(e=>"$"===e.name),i=o.createElement(o.Fragment,null,t.actions.map((e,t)=>o.createElement("button",{key:t,className:"btn btn-primary mr-3",onClick:()=>this.actionClick(e)},this.controller.getActionLabel("$",e.name))));return o.createElement(s.Page,{header:"\u5df2\u4fdd\u5b58",back:"close"},o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(h.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),o.createElement("div",{className:"p-3"},i,this.buttons)))}),this.acted=(()=>o.createElement(s.Page,null,o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(h.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),o.createElement("div",{className:"p-3"},this.buttons))))}showEntry(e){return O(this,void 0,void 0,function*(){this.brief=e,this.openPage(this.view)})}}var T=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class U extends y{constructor(){super(...arguments),this.page=(()=>{let{brief:e}=this.sheetData,{state:t,no:i}=e,n=this.controller.getStateLabel(t);return a.a.createElement(s.Page,{header:this.label+":"+n+"-"+i},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),a.a.createElement(this.sheetView,null)))})}showEntry(e){return T(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var j=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class L extends r.a{constructor(){super(...arguments),this.statesCount=n.k.array([],{deep:!0}),this.onSave=((e,t)=>j(this,void 0,void 0,function*(){let i=yield this.saveSheet(e,t);this.ceasePage(),yield this.showSaved(i)}))}internalStart(){return j(this,void 0,void 0,function*(){yield this.loadStateSheetCount(),this.pageStateItems=this.entity.createPageStateItems(),yield this.showVPage(this.VSheetMain)})}onMessage(e){return j(this,void 0,void 0,function*(){let{type:t,body:i,from:n,to:s,push:r}=e;"sheet"===t&&this.onSheet(n,s,i)})}onSheet(e,t,i){let n=this.user.id,{id:s,preState:r,state:o}=i;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:s,preState:r,state:o,me:n,sheetData:i}),e===n&&this.sheetActPreState(s,r),void 0!==t.find(e=>e===n)&&this.sheetActState(s,o,i)}sheetActPreState(e,t){if(this.changeStateCount(t,-1),void 0===this.curState||this.curState!==t)return;let i=this.pageStateItems.items.findIndex(t=>t.id===e);i>=0&&this.pageStateItems.items.splice(i,1)}sheetActState(e,t,i){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(t=>t.id===e)<0&&this.pageStateItems.items.push(i)}changeStateCount(e,t){if(void 0===e)return;let i=this.statesCount.findIndex(t=>t.state===e);if(console.log({$:"changeState",state:e,delta:t,index:i}),i<0)return;let n=this.statesCount[i];n.count+=t,n.count<0&&(n.count=0)}get VSheetMain(){return this.ui&&this.ui.main||d}get VSheetNew(){return this.ui.sheetNew||f}get VSheetSaved(){return this.ui.sheetSaved||R}get VSheetEdit(){return this.ui.sheetEdit||w}get VSheetSchema(){return F}get VArchives(){return P}get VArchived(){return V}get VSheetList(){return I}get VSheetAction(){return this.ui.sheetAction||S}get VSheetProcessing(){return U}onEvent(e,t){return j(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VSheetNew;break;case"schema":i=this.VSheetSchema;break;case"archives":i=this.VArchives;break;case"state":this.curState=t.state,i=this.VSheetList;break;case"archived":return void(yield this.showArchived(t));case"action":return void(yield this.showAction(t));case"processing":return void(yield this.showProcessing(t))}yield this.showVPage(i,t)})}startSheet(e){return j(this,void 0,void 0,function*(){!1!==(yield this.beforeStart())&&(yield this.onEvent("action",e))})}showAction(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);Object(s.postWsToTop)({body:{$type:"msg",action:"$sheet",msg:{id:e,usq:this.cUsq.id,state:t.brief.state}}}),yield this.showVPage(this.VSheetAction,t)})}showProcessing(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);yield this.showVPage(this.VSheetProcessing,t)})}editSheet(e){return j(this,void 0,void 0,function*(){return yield this.vCall(this.VSheetEdit,e)})}showArchived(e){return j(this,void 0,void 0,function*(){let t=yield this.getArchived(e.id);yield this.showVPage(this.VArchived,t)})}showSaved(e){return j(this,void 0,void 0,function*(){yield this.showVPage(this.VSheetSaved,e)})}getStateUI(e){let{states:t}=this.res;if(void 0!==t)return t[e]}getStateLabel(e){let t=this.getStateUI(e),i=t&&t.label||e;switch(i){default:return i;case"$":return"\u65b0\u5355"}}getActionLabel(e,t){let i=this.getStateUI(e);if(void 0===i)return t;let n=i.actions;if(void 0===n)return t;let s=n[t];return s&&s.label||t}loadStateSheetCount(){return j(this,void 0,void 0,function*(){this.statesCount.clear();let e=yield this.entity.stateSheetCount();this.statesCount.splice(0,0,...e)})}getSheetData(e){return j(this,void 0,void 0,function*(){return yield this.entity.getSheet(e)})}getArchived(e){return j(this,void 0,void 0,function*(){return yield this.entity.getArchive(e)})}saveSheet(e,t){return j(this,void 0,void 0,function*(){let{sheetTitle:i}=this.ui,n=void 0===i?this.label:i(t,this.x);return yield this.entity.save(n,e)})}action(e,t,i,n){return j(this,void 0,void 0,function*(){return yield this.entity.action(e,t,i,n)})}}i.d(t,"a",function(){return L})},97:function(e,t,i){"use strict";var n=i(7),s=i.n(n),r=i(74),o=i(0),a=i.n(o),l=i(75),c=i(78),h=i(4),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends r.b{constructor(){super(...arguments),this.onNew=(()=>this.event("new")),this.onList=(()=>this.event("list")),this.onSearch=(e=>u(this,void 0,void 0,function*(){return this.event("list",e)}))}showEntry(e){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}entityRender(e,t){return e.render()}entityClick(e){return u(this,void 0,void 0,function*(){yield e.onClick()})}get view(){let e,{label:t,proxyLinks:i,isFrom:n}=this.controller;return!1===n&&(e=o.createElement(c.b,{className:"ml-3",color:"primary",onClick:this.onNew},"\u65b0\u589e")),()=>o.createElement(h.Page,{header:t},void 0===i?o.createElement(o.Fragment,null,o.createElement(l.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+t}),o.createElement("div",{className:"my-3"},e,o.createElement(c.b,{className:"ml-3",color:"primary",onClick:this.onList},"\u5217\u8868"))):o.createElement(l.List,{className:"my-2",header:o.createElement(l.Muted,null,t," \u4ee3\u7406\u4e0b\u5217Tuid"),items:i,item:{render:this.entityRender,onClick:this.entityClick}}))}}var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends r.b{constructor(){super(...arguments),this.next=(()=>m(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2),this.event("edit-end")}),this.onSubmit=(()=>m(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.controller.entity.save(this.id,e),{id:i}=t;if(i<0){let{unique:e}=this.controller.entity;if(void 0!==e)for(let t of e)this.vForm.setError(t,"\u4e0d\u80fd\u91cd\u590d")}else{if(this.controller.isCalling)return this.returnCall(i),void this.closePage();this.openPageElement(o.createElement(h.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement(c.b,{className:"mr-3",color:"primary",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement(c.b,{color:"primary",outline:!0,onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:e})}}))}showEntry(e){return m(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView)})}get editView(){return()=>o.createElement(h.Page,{header:(void 0===this.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+this.label},this.vForm.render("py-3"))}resetForm(){this.vForm.reset()}}var v=i(76),p=i(8),y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends r.b{constructor(){super(...arguments),this.mainView=Object(p.a)(()=>{let e=a.a.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return a.a.createElement(h.Page,{header:e,back:"close"},a.a.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickMainRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.onSearchMain=(e=>y(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderMainRow=((e,t)=>a.a.createElement(this.mainRowContent,Object.assign({},e))),this.clickMainRow=(e=>y(this,void 0,void 0,function*(){this.ceasePage(),void 0!==this.controller.entity.owner?yield this.showDiv(this.entity.getIdFromObj(e)):this.returnCall(e)})),this.divView=(e=>a.a.createElement(h.Page,{header:"\u9009\u62e9Div"},a.a.createElement(l.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))),this.renderDivRow=((e,t)=>a.a.createElement(this.divRowContent,Object.assign({},e))),this.clickDivRow=(e=>{this.ceasePage(),this.returnCall(e)})}showEntry(e){return y(this,void 0,void 0,function*(){void 0===e?yield this.showMain(e):yield this.showDiv(e)})}showMain(e){return y(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||v.c,yield this.controller.searchMain(e),this.openPage(this.mainView)})}showDiv(e){return y(this,void 0,void 0,function*(){let{divs:t}=this.ui;void 0!==t&&(this.divRowContent=t[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=v.c);let i=yield this.controller.getDivItems(e);this.openPage(this.divView,{items:i})})}}var w=i(77),b=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class x extends r.b{constructor(){super(...arguments),this.next=(()=>b(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2)}),this.onSubmit=(()=>b(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.entity.save(this.id,e);t&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+Object(w.a)(t)),this.openPage(()=>o.createElement(h.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement(c.b,{className:"mr-3",color:"primary",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement(c.b,{color:"primary",outline:!0,onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))})),this.view=(()=>o.createElement(h.Page,{header:this.label},this.vForm.render("py-3")))}buildForm(e){this.vForm=this.createForm(void 0,e)}showEntry(e){return b(this,void 0,void 0,function*(){this.buildForm(e),this.openPage(this.view)})}render(e){return this.buildForm(e),this.vForm.render()}loadId(e){return b(this,void 0,void 0,function*(){this.id=e})}resetForm(){this.vForm.reset()}}class E extends x{}var S=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class k extends h.PageItems{constructor(e){super(!0),this.tuid=e}load(e,t,i){return S(this,void 0,void 0,function*(){return yield this.tuid.search(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var F=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class C extends r.b{constructor(){super(...arguments),this.onSearch=(e=>F(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderRow=((e,t)=>o.createElement(this.rowContent,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.rowKey=(e=>{let{id:t}=e;return t}),this.view=Object(p.a)(()=>{let e,t=o.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label}),{owner:i}=this.entity;if(void 0!==i){let t=i.valueFromId(this.ownerId);e=o.createElement("div",null,"owner: ",Object(w.a)(t))}return o.createElement(h.Page,{header:t},e,o.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow,key:this.rowKey},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}showEntry(e){return F(this,void 0,void 0,function*(){this.rowContent=this.ui.rowContent||v.c,void 0!==this.entity.owner&&(this.ownerId=Number(e)),yield this.controller.searchMain(""),this.openPage(this.view)})}callOnSelected(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}class P extends C{onSelected(e){return F(this,void 0,void 0,function*(){!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id)})}}var N=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class I extends r.a{buildPageItems(){return new k(this.entity.owner||this.entity)}searchMain(e){return N(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first(e))})}getDivItems(e){return N(this,void 0,void 0,function*(){return yield this.entity.searchArr(e,void 0,0,1e3)})}}class A extends I{constructor(e,t,i,n){super(e,t,i,n);let s=this.entity;if(this.proxies=s.proxies,void 0!==this.proxies){this.proxyLinks=[];for(let e in this.proxies){let t=this.cUsq.linkFromName("tuid",e);this.proxyLinks.push(t)}}}from(){return N(this,void 0,void 0,function*(){let e=yield this.entity.cFrom();return void 0===e?this:e})}cUsqFrom(){return N(this,void 0,void 0,function*(){return yield this.entity.cUsqFrom()})}cEditFrom(){return N(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidEditFromName(this.entity.name)})}cInfoFrom(){return N(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidInfoFromName(this.entity.name)})}cSelectFrom(){return N(this,void 0,void 0,function*(){let e=yield this.entity.cUsqFrom();return yield e.cTuidSelectFromName(this.entity.name)})}getLable(e){if(e===this.entity)return this.label;let{name:t}=e,{arrs:i}=this.res;if(void 0!==i){let e=i[t];if(void 0!==e){let t=e.label;if(void 0!==t)return t}}return t}get VTuidMain(){return d}get VTuidEdit(){return f}get VTuidList(){return P}internalStart(e){return N(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.showVPage(this.VTuidMain)})}onEvent(e,t){return N(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VTuidEdit;break;case"list":i=this.VTuidList;break;case"edit":return void(yield this.edit(t));case"item-changed":return void this.itemChanged(t);case"info":let n=new R(this.cUsq,this.entity,this.ui,this.res);return void(yield n.start(t))}yield this.showVPage(i,t)})}edit(e){return N(this,void 0,void 0,function*(){let t=void 0;void 0!==e&&(t=yield this.entity.load(e));let i=this.VTuidEdit;yield this.showVPage(i,t)})}itemChanged({id:e,values:t}){if(void 0===this.PageItems)return;let i=this.PageItems.items.find(t=>t.id===e);void 0!==i&&s.a.merge(i,t)}}class V extends A{internalStart(e){return N(this,void 0,void 0,function*(){yield this.edit(e)})}}class q extends A{internalStart(e){return N(this,void 0,void 0,function*(){yield this.showVPage(this.VTuidList)})}}class O extends I{internalStart(e){return N(this,void 0,void 0,function*(){yield this.showVPage(this.VTuidSelect,e)})}beforeStart(){const e=Object.create(null,{beforeStart:{get:()=>super.beforeStart}});return N(this,void 0,void 0,function*(){return!1!==(yield e.beforeStart.call(this))&&(void 0!==this.PageItems&&this.PageItems.reset(),!0)})}get VTuidSelect(){return g}idFromItem(e){return e.id}}class R extends I{internalStart(e){return N(this,void 0,void 0,function*(){let t=yield this.entity.load(e);yield this.showVPage(this.VTuidInfo,t)})}get VTuidInfo(){return E}}i.d(t,"d",function(){return A}),i.d(t,"a",function(){return V}),i.d(t,"c",function(){return q}),i.d(t,"e",function(){return O}),i.d(t,"b",function(){return R})},98:function(e,t,i){"use strict";var n=i(4),s=i(85),r=i(86),o=i(74),a=i(0),l=i.n(a),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class h extends o.b{constructor(){super(...arguments),this.view=(()=>a.createElement(n.Page,{header:this.label},"Book"))}showEntry(e){return c(this,void 0,void 0,function*(){this.openPage(this.view)})}}var u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends o.a{internalStart(){return u(this,void 0,void 0,function*(){yield this.showVPage(this.VBookMain)})}get VBookMain(){return h}}var m=i(96),f=i(101),v=i(99),p=i(97),y=i(100),g=i(76),w=i(75);class b extends n.View{constructor(e){super(e),this.isSysVisible=!1,this.view=(()=>{let e,{res:t,usq:i,error:n}=this.controller,s={render:(e,t)=>e.render(),onClick:void 0},r=[{header:t.tuid||"TUID",items:this.tuidLinks},{cn:"my-2",header:t.map||"MAP",items:this.mapLinks},{cn:"my-2",header:t.sheet||"SHEET",items:this.sheetLinks},{cn:"my-2",header:t.action||"ACTION",items:this.actionLinks},{cn:"my-2",header:t.query||"QUERY",items:this.queryLinks},{cn:"mt-2 mb-4",header:t.book||"BOOK",items:this.bookLinks},{cn:"mt-2 mb-4",header:t.history||"HISTORY",items:this.historyLinks},{cn:"mt-2 mb-4",header:t.pending||"PENDING",items:this.pendingLinks}];return e=void 0!==n?l.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",n):r.map(({cn:e,header:t,items:i},n)=>i.length>0&&l.a.createElement(w.List,{key:n,className:e,header:l.a.createElement("div",{className:"px-3 py-1 bg-light"},l.a.createElement(w.Muted,null,t)),items:i,item:s})),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"px-3 py-1 small"},t.usq||i),e)});let{tuidArr:t,mapArr:i,sheetArr:n,actionArr:s,queryArr:o,bookArr:a,historyArr:c,pendingArr:h}=e.entities;this.tuidLinks=t.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cTuidMain(e))),this.mapLinks=i.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cMap(e))),this.sheetLinks=n.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cSheet(e))),this.actionLinks=s.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cAction(e))),this.queryLinks=o.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cQuery(e))),this.bookLinks=a.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cBook(e))),this.historyLinks=c.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cHistory(e))),this.pendingLinks=h.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cPending(e)))}isVisible(e){return!0!==e.sys||this.isSysVisible}render(e){return void 0===this.view?l.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):l.a.createElement(this.view)}}var x=i(103),E=i(102),S=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function k(e){if(void 0!==e)for(let t in e)e[t.toLowerCase()]=e[t]}class F extends n.Controller{constructor(e,t,i,r,o,a){super(Object(n.resLang)(a.res)),this.schemaLoaded=!1,this.isSysVisible=!1,this.cApp=e,this.usq=t,this.id=r,k(a.tuid),k(a.sheet),k(a.map),k(a.query),k(a.action),k(a.book),k(a.history),k(a.pending),this.ui=a,this.CTuidMain=a.CTuidMain||p.d,this.CTuidEdit=a.CTuidEdit||p.a,this.CTuidList=a.CTuidList||p.c,this.CTuidSelect=a.CTuidSelect||p.e,this.CTuidInfo=a.CTuidInfo||p.b,this.CQuery=a.CQuery||v.a,this.CQuerySelect=a.CQuerySelect||v.b,this.CMap=a.CMap||y.a,this.CAction=a.CAction||f.a,this.CSheet=a.CSheet||m.a,this.CBook=a.CBook||d,this.CHistory=a.CHistory||x.a,this.CPending=a.CPending||E.a;let l,c,h=t.split("/");switch(h.length){case 1:l="$$$",c=h[0];break;case 2:l=h[0],c=h[1];break;default:return void console.log("usq must be usqOwner/usqName format")}let u,g,w=document.location.hash,b=void 0===w||""===w?"debug/":"tv/";u=null===o||void 0===o||"*"===o?[]:o.split(";").map(e=>e.trim()).filter(e=>e.length>0),g="$$$/$unitx"===t?new n.UnitxApi(n.meInFrame.unit):new n.UsqApi(b,l,c,u,!0),this.entities=new s.a(this,g,i)}internalStart(){return S(this,void 0,void 0,function*(){})}loadEntites(){return S(this,void 0,void 0,function*(){yield this.entities.loadAccess()})}loadSchema(){return S(this,void 0,void 0,function*(){try{if(!0===this.schemaLoaded)return;yield this.loadEntites(),void 0===this.id&&(this.id=this.entities.usqId);for(let e in this.ui){let t=this.ui[e];if(void 0===t)continue;let{caption:i,collection:n}=t;if(void 0!==n)for(let s in n)void 0===this.entities[e](s)&&console.warn(e+":'"+s+"' is not usql entity")}return void(this.schemaLoaded=!0)}catch(e){return console.error(e),this.error=e}})}getQuerySearch(e){return S(this,void 0,void 0,function*(){let t=this.entities.query(e);if(void 0===t)alert(`QUERY ${e} \u6ca1\u6709\u5b9a\u4e49!`);else{yield t.loadSchema();let{returns:i}=t;i.length>1&&alert(`QUERY ${e} \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch`)}return t})}getTuidPlaceHolder(e){let t,{tuidPlaceHolder:i,entity:n}=this.res,{name:s}=e;if(void 0!==n){let e=n[s];void 0!==e&&(t=e.label)}return i||"Select"}getNone(){let{none:e}=this.res;return e||"none"}isVisible(e){return!0!==e.sys||this.isSysVisible}navSheet(e,t){return S(this,void 0,void 0,function*(){let i=this.entities.sheetFromTypeId(e);if(void 0===i)return void alert("sheetTypeId "+e+" is not exists!");let n=this.cSheet(i);yield n.startSheet(t)})}sheet(e){return this.entities.sheet(e)}action(e){return this.entities.action(e)}query(e){return this.entities.query(e)}book(e){return this.entities.book(e)}map(e){return this.entities.map(e)}history(e){return this.entities.history(e)}pending(e){return this.entities.pending(e)}tuid(e){return this.entities.tuid(e)}tuidDiv(e,t){let i=this.entities.tuid(e);if(void 0===i)return;let{divs:n}=i;return void 0!==n?n[t]:void 0}cSheetFromName(e){let t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}cActionFromName(e){let t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}cQueryFromName(e){let t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}cBookFromName(e){let t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}cMapFromName(e){let t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}cHistoryFromName(e){let t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}cPendingFromName(e){let t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}cTuidMainFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}cTuidEditFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}cTuidInfoFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}cTuidSelectFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}cFromName(e,t){switch(e){case"sheet":let i=this.entities.sheet(t);if(void 0===i)return;return this.cSheet(i);case"action":let n=this.entities.action(t);if(void 0===n)return;return this.cAction(n);case"tuid":let s=this.entities.tuid(t);if(void 0===s)return;return this.cTuidMain(s);case"query":let r=this.entities.query(t);if(void 0===r)return;return this.cQuery(r);case"book":let o=this.entities.book(t);if(void 0===o)return;return this.cBook(o);case"map":let a=this.entities.map(t);if(void 0===a)return;return this.cMap(a);case"history":let l=this.entities.history(t);if(void 0===l)return;return this.cHistory(l);case"pending":let c=this.entities.pending(t);if(void 0===c)return;return this.cPending(c)}}linkFromName(e,t){return this.link(this.cFromName(e,t))}getUI(e){let t,i,{name:n,typeName:s}=e;if(void 0!==this.ui){let e=this.ui[s];void 0!==e&&(t=e[n])}let{entity:r}=this.res;return void 0!==r&&(i=r[n]),{ui:t||{},res:i||{}}}link(e){return new r.a(e)}get tuidLinks(){return this.entities.tuidArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cTuidMain(e)))}cTuidMain(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidMain||this.CTuidMain)(this,e,t,i)}cTuidEdit(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidEdit||this.CTuidEdit)(this,e,t,i)}cTuidList(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidList||this.CTuidList)(this,e,t,i)}cTuidSelect(e){let{ui:t,res:i}=this.getUI(e.owner||e);return new(t&&t.CTuidSelect||this.CTuidSelect)(this,e,t,i)}cTuidInfo(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidInfo||this.CTuidInfo)(this,e,t,i)}cSheet(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CSheet||this.CSheet)(this,e,t,i)}get sheetLinks(){return this.entities.sheetArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cSheet(e)))}cAction(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CAction||this.CAction)(this,e,t,i)}get actionLinks(){return this.entities.actionArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cAction(e)))}cQuery(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CQuery||this.CQuery)(this,e,t,i)}cQuerySelect(e){let t=this.entities.query(e);if(void 0===t)return;let{ui:i,res:n}=this.getUI(t);return new(i&&i.CQuerySelect||this.CQuerySelect)(this,t,i,n)}get queryLinks(){return this.entities.queryArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cQuery(e)))}cBook(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CBook||this.CBook)(this,e,t,i)}get bookLinks(){return this.entities.bookArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cBook(e)))}cHistory(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CHistory||this.CHistory)(this,e,t,i)}get historyLinks(){return this.entities.historyArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cHistory(e)))}cPending(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CPending||this.CPending)(this,e,t,i)}get pendingLinks(){return this.entities.pendingArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cPending(e)))}cMap(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CMap||this.CMap)(this,e,t,i)}get mapLinks(){return this.entities.mapArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cMap(e)))}getTuidContent(e){let{owner:t}=e;if(void 0===t){let{ui:t}=this.getUI(e);return t&&t.inputContent||g.b}{let{ui:i}=this.getUI(t);return i&&i.divs&&i.divs[e.name].inputContent||g.b}}showTuid(e,t){return S(this,void 0,void 0,function*(){let{owner:i}=e,n=this.cTuidInfo(i||e);yield n.start(t)})}get VUsq(){return b}render(){return new this.VUsq(this).render()}}i.d(t,"a",function(){return F})},99:function(e,t,i){"use strict";var n=i(74),s=i(0),r=i.n(s),o=i(8),a=i(75),l=i(4),c=i(77);const h=e=>r.a.createElement("div",{className:"px-3 py-2"},Object(c.a)(e));var u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>u(this,void 0,void 0,function*(){let e=this.vForm.getValues();if(!0===this.entity.isPaged)yield this.entity.resetPage(30,e),yield this.entity.loadPage(),this.replacePage(this.pageResult);else{let t=yield this.entity.query(e);this.replacePage(this.queryResult,t)}})),this.again=(()=>{this.vForm.reset(),this.replacePage(this.view)}),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.view=(()=>s.createElement(l.Page,{header:this.label},this.vForm.render("mx-3 my-2"),this.renderExtra())),this.pageResult=(()=>{let{name:e,list:t}=this.entity,i=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(l.Page,{header:this.label,right:i},s.createElement(a.List,{items:t,item:{render:this.renderRow}}))}),this.queryResult=Object(o.a)(e=>{let t=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(l.Page,{header:this.label,right:t},s.createElement("pre",null,JSON.stringify(e,void 0,"\t")))})}showEntry(e){return u(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e);let{row:t,queryRow:i}=this.ui;this.row=i||t||h,this.openPage(this.view)})}renderExtra(){}}var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends n.b{constructor(){super(...arguments),this.onSearch=(e=>m(this,void 0,void 0,function*(){yield this.PageItems.first(e)})),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.view=(()=>{let e=s.createElement(a.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return s.createElement(l.Page,{header:e},s.createElement(a.List,{items:this.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}showEntry(e){return m(this,void 0,void 0,function*(){let{row:t,selectRow:i}=this.ui;this.row=i||t||h,this.PageItems=new v(this.entity),yield this.onSearch(e),this.openPage(this.view)})}callOnSelected(e){this.closePage(),this.returnCall(e)}}class v extends l.PageItems{constructor(e){super(),this.query=e}load(){return m(this,void 0,void 0,function*(){let e;if(yield this.query.loadSchema(),!0===this.query.isPaged)e=yield this.query.page(this.param,this.pageStart,this.pageSize);else{e=(yield this.query.query(this.param))[this.query.returns[0].name]}return e})}setPageStart(e){void 0===e&&(this.pageStart=0)}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y extends n.a{}class g extends y{internalStart(){return p(this,void 0,void 0,function*(){yield this.showVPage(this.VQueryMain)})}get VQueryMain(){return this.ui&&this.ui.main||d}}class w extends y{internalStart(e){return p(this,void 0,void 0,function*(){yield this.showVPage(this.VQuerySelect,e)})}get VQuerySelect(){return f}}i.d(t,"a",function(){return g}),i.d(t,"b",function(){return w})}}]);
//# sourceMappingURL=5.401dbf89.chunk.js.map