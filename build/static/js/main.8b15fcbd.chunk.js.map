{"version":3,"sources":["tonva-tools/ui/nav.tsx","tonva-tools/index.ts","tonva-tools/ui/form/context.tsx","tonva-tools/net/appBridge.ts","tonva-tools/net/wsChannel.ts","tonva-tools/net/index.ts","tonva-tools/net/httpChannelUI.ts","tonva-tools/net/usqApi.ts","tonva-tools/uid.ts","tonva-tools/net/apiBase.ts","tonva-tools/local.ts","tonva-tools/ui/index.ts","tonva-tools/net/debugHost.ts","tonva-tools/net/httpChannel.ts","tonva-tools/ui/page.tsx","tonva-tools/ui/res.ts","tonva-tools/ui/titleBar.tsx","tonva-tools/ui/loading.tsx","tonva-tools/ui/form/rules/index.ts","tonva-tools/ui/form/widgets/widget.tsx","tonva-tools/ui/form/widgets/textWidget.tsx","tonva-tools/ui/form/widgets/numberWidget.tsx","tonva-tools/ui/form/widgets/updownWidget.tsx","tonva-tools/ui/form/widgets/dateWidget.tsx","tonva-tools/ui/form/widgets/checkBoxWidget.tsx","tonva-tools/ui/form/arrRow.tsx","tonva-tools/ui/form/widgets/selectWidget.tsx","tonva-tools/ui/form/widgets/idWidget.tsx","tonva-tools/ui/form/widgets/unknown.tsx","tonva-tools/ui/form/widgets/buttonWidget.tsx","tonva-tools/ui/form/widgets/factory.tsx","tonva-tools/ui/form/widgets/textareaWidget.tsx","tonva-tools/ui/form/widgets/passwordWidget.tsx","tonva-tools/ui/form/widgets/radioWidget.tsx","tonva-tools/ui/form/widgets/rangeWidget.tsx","tonva-tools/ui/form/widgets/index.ts","tonva-tools/net/fetchLocalCheck.ts","face/store.ts","tonva-tools/user.ts","tonva-tools/ui/rowIcon.tsx","tonva-tools/ui/row.tsx","tonva-tools/ui/VM.tsx","tonva-tools/ui/form/index.ts","tonva-tools/ui/form/field.tsx","tonva-tools/pageItems.ts","tonva-tools/cacheIds.ts","tonva-tools/ui/form/formRes.ts","tonva-tools/ui/form/form.tsx","tonva-tools/ui/tabs/tabs.tsx","tonva-tools/ui/tabs/index.tsx","tonva-tools/net/netToken.ts","tonva-tools/ui/fetchErrorView.tsx","tonva-tools/img/logo.svg","face/home/index.tsx","face/index.tsx","face/member/index.tsx","face/cart/index.tsx","face/me/index.tsx","App.tsx","registerServiceWorker.ts","index.tsx"],"names":["mobileHeaderStyle","RegExp","test","navigator","userAgent","minHeight","undefined","__webpack_require__","logMark","logs","stackKey","NavView","react__WEBPACK_IMPORTED_MODULE_0__","[object Object]","props","super","this","waitCount","isHistoryBack","clearError","setState","fetchError","back","bind","navBack","stack","state","wait","window","addEventListener","nav","set","start","level","length","waitTimeHandler","global","setTimeout","clearTimeout","err","error","unauthorized","showLogin","view","disposer","clear","push","removeCeased","history","pushState","key","ceased","refresh","item","pop","dispose","p","i","len","backLevel","popAndDispose","Error","find","v","confirmClose","log","confirm","self","top","postMessage","type","message","elWait","elError","className","_fetchErrorView__WEBPACK_IMPORTED_MODULE_5__","Object","assign","map","index","style","visibility","centerUrlAndWs","centerHost","url","ws","Nav","local","_local__WEBPACK_IMPORTED_MODULE_7__","user","lang","district","_res__WEBPACK_IMPORTED_MODULE_15__","language","culture","handler","onWsReceiveAny","handlerId","endWsReceive","msg","receive","_page__WEBPACK_IMPORTED_MODULE_3__","header","_loading__WEBPACK_IMPORTED_MODULE_16__","urlAndWs","debugUrlAndWs","NODE_ENV","PUBLIC_URL","REACT_APP_CENTER_HOST","REACT_APP_CENTER_DEBUG_HOST","_net__WEBPACK_IMPORTED_MODULE_8__","document","location","hash","includes","loadCenterUrl","wsHost","console","origin","isInFrame","startsWith","mif","_net_appBridge__WEBPACK_IMPORTED_MODULE_6__","_net_wsChannel__WEBPACK_IMPORTED_MODULE_13__","parent","device","get","_uid__WEBPACK_IMPORTED_MODULE_14__","logined","notLogined","onLogined","token","connect","JSON","stringify","_net_netToken__WEBPACK_IMPORTED_MODULE_4__","showAppView","withBack","lv","e","then","loginView","default","notShowLogin","logoutClear","startWait","endWait","onError","show","replace","ceaseTop","regConfirmClose","confirmBox","unitId","apiId","sheetType","sheetId","sheet","uh","id","onClick","src","open","date","Date","getTime","toTimeString","step","__decorate","mobx__WEBPACK_IMPORTED_MODULE_1__","_net__WEBPACK_IMPORTED_MODULE_2__","d","__webpack_exports__","_ui__WEBPACK_IMPORTED_MODULE_3__","o","_pageItems__WEBPACK_IMPORTED_MODULE_5__","Context","form","uiSchema","data","inNode","widgets","errors","errorWidgets","renderErrors","mobx_react__WEBPACK_IMPORTED_MODULE_2__","rules","Array","isArray","arrName","itemName","value","widget","setValue","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","checkRules","clearContextErrors","rule","ret","setError","setContextError","addErrorWidget","clearContextError","checkFieldRules","checkContextRules","findIndex","pos","splice","hasError","checkHasError","RowContext","formContext","arrSchema","row","uiArr","items","name","isRow","itemSchemas","FormContext","rowContexts","arrRowContexts","j","rowContext","removeErrors","ContextContainer","usqTokens","logoutUsqTokens","appsInFrame","meInFrame","unit","_unit","val","isBridged","setMeInFrame","appHash","parts","split","substr","Number","page","param","slice","appUrl","u","_uid__WEBPACK_IMPORTED_MODULE_2__","loadAppUsqs","appOwner","appName","centerAppApi","_usqApi__WEBPACK_IMPORTED_MODULE_3__","usqs","appUsq","usq","usqOwner","usqName","usqToken","urlDebug","realUrl","_apiBase__WEBPACK_IMPORTED_MODULE_5__","resolve","reject","Promise","at","__awaiter","a","opener","apiName","evt","subWin","source","_wsChannel__WEBPACK_IMPORTED_MODULE_4__","el","getElementById","hidden","hideFrameBack","lodash__WEBPACK_IMPORTED_MODULE_0___default","clone","_ui__WEBPACK_IMPORTED_MODULE_1__","subFrameStarted","onReceive","initSubWin","from","callId","method","body","result","directCall","callCenterApiFromMessage","bca","brideCenterApis","bridgeCenterApiReturn","appInFrame","onReceiveAppApiMessage","action","onAppApiReturn","bridgeCenterApi","subAppWindow","setSubAppWindow","win","postWsToTop","WsBase","handlerSeed","anyHandlers","msgHandlers","seed","$type","wsBaseSeed","wsBridge","wsBaseId","WSChannel","centerToken","that","WebSocket","onopen","ev","onerror","onmessage","wsMessage","onclose","close","event","parse","postWsToSubApp","netThis","send","_wsChannel__WEBPACK_IMPORTED_MODULE_0__","_apiBase__WEBPACK_IMPORTED_MODULE_1__","_usqApi__WEBPACK_IMPORTED_MODULE_2__","_appBridge__WEBPACK_IMPORTED_MODULE_3__","_debugHost__WEBPACK_IMPORTED_MODULE_4__","httpChannelUI_HttpChannelNavUI","channelUIs","channelNoUIs","logoutApis","usqApi_channels","usqApi_UsqApi","apiBase","basePath","access","showWaiting","channels","channelUI","channel","appBridge","httpChannel","acc","join","names","post","params","arr","owner","pageStart","pageSize","order","$order","ids","proxy","put","lodash","usqApi_UnitxApi","buildChannel","CenterAppApi","unitxUsq","setCenterUrl","centerChannel","centerChannelUI","getCenterUrl","setCenterToken","t","usqApi_CenterApi","path","usqTokenApi","callCenterapi","call","uid","ALPHABET","ID_LENGTH","rtn","charAt","Math","floor","random","refetchApi","options","fetch","ApiBase","getHttpChannel","callFetch","delete","replaceUrlHost","hostString","defaultHost","envHost","indexOf","host","getUrlOrDebug","_local__WEBPACK_IMPORTED_MODULE_0__","orgDebug","endsWith","_debugHost__WEBPACK_IMPORTED_MODULE_1__","fetchUrl","fetchOptions","mode","headers","Content-Type","_fetchLocalCheck__WEBPACK_IMPORTED_MODULE_2__","text","isDevelopment","LocalData","Data","localStorage","getItem","setItem","removeItem","homeTabCur","_nav__WEBPACK_IMPORTED_MODULE_0__","_page__WEBPACK_IMPORTED_MODULE_2__","_VM__WEBPACK_IMPORTED_MODULE_5__","_form__WEBPACK_IMPORTED_MODULE_6__","_res__WEBPACK_IMPORTED_MODULE_7__","_tabs__WEBPACK_IMPORTED_MODULE_8__","_loading__WEBPACK_IMPORTED_MODULE_9__","centerDebugHost","usqDebugHost","debugUsqlServer","HttpChannel","isCenter","hostUrl","apiToken","ui","showError","timeout","_local__WEBPACK_IMPORTED_MODULE_2__","keys","c","k","buildOptions","innerFetch","buildError","timeOutHandler","res","encodeURI","ok","statusText","ct","json","retJson","catch","toLowerCase","_ui_nav__WEBPACK_IMPORTED_MODULE_1__","logout","_appBridge__WEBPACK_IMPORTED_MODULE_0__","Headers","append","scrollTimeGap","ScrollView","bottomTime","topTime","onScroll","onScrollTop","onScrollBottom","target","scrollTop","offsetHeight","scrollHeight","direct","children","forEach","child","_$scroll","toString","eachChild","Page","cur","tabs","tabStates","tab","lodash__WEBPACK_IMPORTED_MODULE_3___default","isSelected","isMounted","t0","onTabClick","load","footer","right","keepHeader","titleBar","icon","title","redDot","img","redDotView","cn","classnames__WEBPACK_IMPORTED_MODULE_2___default","_titleBar__WEBPACK_IMPORTED_MODULE_4__","center","content","invisible","onTouchStart","elFooter","renderTabs","renderSingle","mobx_react__WEBPACK_IMPORTED_MODULE_1__","resOptions","resLang","lodash__WEBPACK_IMPORTED_MODULE_0__","n","merge","_","l","entity","languages","setResOptions","TitleBar","logoutClick","_nav__WEBPACK_IMPORTED_MODULE_1__","navChange","hasBack","href","debugLogout","rightView","b","nick","role","openWindow","Loading","height","width","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","trim","NaN","required","rules_RuleNum","min","max","minMsg","lodash_default","template","maxMsg","number","checkMore","RuleInt","isInteger","integer","widget_Widget","context","itemSchema","fieldProps","contextErrors","onChange","onChanging","onChanged","prev","allowChange","isChanging","setDataValue","currentTarget","getUiItem","readOnly","disabled","visible","defaultValue","getValue","init","buildRules","r","check","removeErrorWidget","isOk","setElementValue","fieldClass","classnames_default","FieldClass","label","render","uiLabel","requiredFlag","react","FieldContainer","Templet","errorList","tag","mobx_module","textWidget_TextWidget","inputType","onBlur","onFocus","input","placeholder","renderTemplet","ref","onKeyDown","maxLength","numberWidget_NumberWidget","updownWidget_UpdownWidget","keyCode","returnValue","dateWidget_DateWidget","checkBoxWidget_CheckBoxWidget","checked","trueValue","falseValue","defaultChecked","keySeed","ArrRow","selectWidget_SelectWidget","select","option","list","selectWidget_decorate","idWidget_IdWidget","pickId","alert","form-control","required-item","cursor-pointer","is-invalid","idWidget_decorate","Unknown","dataType","uiType","dataTypes","buttonWidget_ButtonWidget","buttonWidget_awaiter","onButtonClick","observerRender","index_module","widgetType","button","ButtonClass","widgetsFactory","textarea","rows","password","datetime","time","month","email","updown","color","checkbox","checkboxes","radio","inputs","rowKey","range","factory","typeWidget","getItemSchema","ArrComponent","getTypeWidget","WidgetElement","renderContainer","selectable","deletable","restorable","arrLabel","arrSelectable","arrDeletable","arrRestorable","ArrContainer","RowContainer","formSelectable","formDeletable","formRestorable","first","arrRow","$row","selectCheck","deleteIcon","$isSelected","isDeleted","$isDeleted","onDelClick","rowContent","editContainer","deleted","row-selected","sep","RowSeperator","form_context","typeofTemplet","Provider","fetchLocalCheck","store","mobx__WEBPACK_IMPORTED_MODULE_0__","homeCount","box","cartCount","decodeToken","jwt_decode__WEBPACK_IMPORTED_MODULE_0__","accesses","Controller","isDev","_local__WEBPACK_IMPORTED_MODULE_1__","onMessageReceive","onMessage","x","_nav__WEBPACK_IMPORTED_MODULE_2__","isLogined","unregisterReceiveHandler","receiveHandlerId","onDispose","vp","showEntry","onEvent","openPage","registerReceiveHandler","beforeStart","internalStart","isCalling","_resolve_$","View","controller","vm","returnCall","replacePage","backPage","closePage","ceasePage","VPage","coordinator","_form__WEBPACK_IMPORTED_MODULE_0__","_field__WEBPACK_IMPORTED_MODULE_1__","_schema__WEBPACK_IMPORTED_MODULE_2__","_uiSchema__WEBPACK_IMPORTED_MODULE_3__","Field","_widgets__WEBPACK_IMPORTED_MODULE_1__","_context__WEBPACK_IMPORTED_MODULE_2__","contextType","PageItems","itemObservable","isFirst","loading","beforeLoad","loaded","allLoaded","firstSize","appendPosition","_items","array","deep","topDiv","_uid__WEBPACK_IMPORTED_MODULE_1__","bottomDiv","setPageStart","unshift","reset","more","reverse","maxCount","dict","Map","loadId","shift","_loadIds","_loadId","formRes","zh","form_Form","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultArrContainer","DefaultRowContainer","py-3","DefaultButtonClass","DefaultRowSeperator","DefaultRes","ui_res","schema","formData","Container","arrItem","arrItems","arrDict","nm","beforeShow","Tab","selected","_content","contentBuilder","TabCaptionComponent","tabs_Tabs","tabClick","selectedTab","size","tabBack","contentBack","caption","notify","display","notifyCircle","num","netToken","_usqApi__WEBPACK_IMPORTED_MODULE_0__","_wsChannel__WEBPACK_IMPORTED_MODULE_1__","FetchErrorView","reApi","_net__WEBPACK_IMPORTED_MODULE_1__","errContent","module","exports","faceTabs","LoadableComponent","lib_default","loader","all","tonva_tools","tc","TabController","src_App_0","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","react_dom","URL","response","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.8b15fcbd.chunk.js","sourcesContent":["import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport {fetchLocalCheck} from '../net/fetchLocalCheck';\r\nimport {User, decodeToken} from '../user';\r\nimport {Page} from './page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView from './fetchErrorView';\r\nimport {FetchError} from '../fetchError';\r\nimport {appUrl, setMeInFrame, isBridged, logoutUsqTokens} from '../net/appBridge';\r\nimport {LocalData} from '../local';\r\nimport {logoutApis, setCenterUrl, setCenterToken, WSChannel, getCenterUrl, centerDebugHost} from '../net';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { WsBase, wsBridge } from '../net/wsChannel';\r\nimport { uid } from '../uid';\r\nimport { resOptions } from './res';\r\nimport { Loading } from './loading';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n\r\nconst logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\n\r\nexport interface Props //extends React.Props<Nav>\r\n{\r\n    //view: JSX.Element | (()=>JSX.Element);\r\n    start?: ()=>Promise<void>;\r\n    onLogined: ()=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface State {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, State> {\r\n    private stack: StackItem[];\r\n    private htmlTitle: string;\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.back = this.back.bind(this);\r\n        this.navBack = this.navBack.bind(this);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n    }\r\n    async componentWillMount() {\r\n        window.addEventListener('popstate', this.navBack);\r\n    }\r\n\r\n    async componentDidMount()\r\n    {\r\n        nav.set(this);\r\n        let start = this.props.start;\r\n        if (start !== undefined) {\r\n            await start();\r\n        }\r\n        else {\r\n            await nav.start();\r\n        }\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = global.setTimeout(\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        setTimeout(() => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined && err.unauthorized === true) {\r\n            await nav.showLogin();\r\n            return;\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        throw new Error('to be designed');\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack() {\r\n        nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n    }\r\n\r\n    async back(confirm:boolean = true) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (self != window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let stack = this.state.stack;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <li className=\"va-wait va-wait1\">\r\n                </li>;\r\n                break;\r\n            case 2:\r\n                elWait = <li className=\"va-wait va-wait2\">\r\n                    <i className=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i>\r\n                    <span className=\"sr-only\">Loading...</span>\r\n                </li>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />\r\n        return (\r\n        <ul className='va'>\r\n            {\r\n                stack.map((item, index) => {\r\n                    let {key, view} = item;\r\n                    return <li key={key} style={index<top? {visibility: 'hidden'}:undefined}>\r\n                        {view}\r\n                    </li>\r\n                })\r\n            }\r\n            {elWait}\r\n            {elError}\r\n        </ul>\r\n        );\r\n    }\r\n\r\n    private refresh() {\r\n        // this.setState({flag: !this.state.flag});\r\n        this.setState({stack: this.stack });\r\n        // this.forceUpdate();\r\n    }\r\n}\r\n\r\ninterface UrlAndWs {\r\n    url: string;\r\n    ws: string;\r\n}\r\n\r\nfunction centerUrlAndWs(centerHost:string):UrlAndWs {\r\n    //let host = 'REACT_APP_CENTER_HOST';\r\n    //let centerHost = process.env[host];\r\n    if (centerHost === undefined) return {url:undefined, ws:undefined};\r\n    return {\r\n        url: 'http://' + centerHost + '/',\r\n        ws: 'ws://' + centerHost + '/tv/',\r\n    }\r\n}\r\n\r\nasync function loadCenterUrl():Promise<{url:string, ws:string}> {\r\n    let urlAndWs:UrlAndWs = centerUrlAndWs(process.env['REACT_APP_CENTER_HOST']);\r\n    let debugUrlAndWs:UrlAndWs = centerUrlAndWs(process.env.REACT_APP_CENTER_DEBUG_HOST || centerDebugHost);\r\n    let hash = document.location.hash;\r\n    if (hash.includes('sheet_debug') === true) {\r\n        return debugUrlAndWs;\r\n    }\r\n    if (process.env.NODE_ENV==='development') {\r\n        if (debugUrlAndWs.url !== undefined) {\r\n            try {\r\n                console.log('try connect debug url');\r\n                //let ret = await fetch(debugUrlAndWs.url);\r\n                let ret = await fetchLocalCheck(debugUrlAndWs.url);\r\n                console.log('connected');\r\n                return debugUrlAndWs;\r\n            }\r\n            catch (err) {\r\n                //console.error(err);\r\n            }\r\n        }\r\n    }\r\n    return urlAndWs;\r\n}\r\n\r\nexport class Nav {\r\n    private nav:NavView;\r\n    //private loginView: JSX.Element;\r\n    private ws: WsBase;\r\n    private wsHost: string;\r\n    local: LocalData = new LocalData();\r\n    @observable user: User = undefined; // = {id:undefined, name:undefined, token:undefined};\r\n    language: string;\r\n    culture: string;\r\n\r\n    constructor() {\r\n        /*\r\n        let language = navigator.languages && navigator.languages[0] || // Chrome / Firefox\r\n               navigator.language; // ||   // All browsers\r\n               //navigator.userLanguage; // IE <= 10\r\n        if (!language) {\r\n            this.language = 'zh';\r\n            this.culture = 'CN';\r\n        }\r\n        let parts = language.split('-');\r\n        this.language = parts[0];\r\n        if (parts.length > 1) this.culture = parts[1];\r\n        */\r\n\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n    }\r\n    \r\n    set(nav:NavView) {\r\n        //this.logo = logo;\r\n        this.nav = nav;\r\n    }\r\n\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        if (this.ws === undefined) return;\r\n        return this.ws.onWsReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        this.ws.endWsReceive(handlerId);\r\n    }\r\n\r\n    async onReceive(msg:any) {\r\n        if (this.ws === undefined) return;\r\n        await this.ws.receive(msg);\r\n    }\r\n\r\n    private isInFrame:boolean;\r\n    async start() {\r\n        nav.push(<Page header={false}><Loading /></Page>);\r\n\r\n        let {url, ws} = await loadCenterUrl();\r\n        setCenterUrl(url);\r\n        this.wsHost = ws;\r\n\r\n        let hash = document.location.hash;\r\n        // document.title = document.location.origin;\r\n        console.log(\"url=%s hash=%s\", document.location.origin, hash);\r\n        this.isInFrame = hash !== undefined && hash !== '' && hash.startsWith('#tv');\r\n        if (this.isInFrame === true) {\r\n            let mif = setMeInFrame(hash);\r\n            if (mif !== undefined) {\r\n                this.ws = wsBridge;\r\n                console.log('this.ws = wsBridge in sub frame');\r\n                //nav.user = {id:0} as User;\r\n                if (self !== window.parent) {\r\n                    window.parent.postMessage({type:'sub-frame-started', hash: mif.hash}, '*');\r\n                }\r\n                //  appBridge.ts  initSubWinmain frameuser\r\n                //await this.showAppView();\r\n                return;\r\n            }\r\n        }\r\n        let device: string = this.local.device.get();\r\n        let user: User = this.local.user.get();\r\n        if (device === undefined) {\r\n            device = uid();\r\n            this.local.device.set(device);\r\n            user = undefined;\r\n        }\r\n        if (user === undefined || user.device !== device) {\r\n            let {notLogined} = this.nav.props;\r\n            if (notLogined !== undefined) {\r\n                await notLogined();\r\n            }\r\n            else {\r\n                await nav.showLogin();\r\n            }\r\n            return;\r\n        }\r\n\r\n        await nav.logined(user);\r\n    }\r\n\r\n    async showAppView() {\r\n        let {onLogined} = this.nav.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined();\r\n        console.log('logined: AppView shown');\r\n    }\r\n\r\n    async logined(user: User) {\r\n        let ws:WSChannel = this.ws = new WSChannel(this.wsHost, user.token);\r\n        ws.connect();\r\n\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.local.user.set(user);\r\n        netToken.set(user.token);\r\n        this.user = user;\r\n        console.log('ws.connect() in app main frame');\r\n        await this.showAppView();\r\n    }\r\n\r\n    async showLogin(withBack?:boolean) {\r\n        //if (this.loginView === undefined) {\r\n        let lv = await import('../entry/login');\r\n        //this.loginView = <lv.default logo={logo} />;\r\n        let loginView = <lv.default withBack={withBack} />;\r\n        //}\r\n        if (withBack !== true) {\r\n            this.nav.clear();\r\n            this.pop();\r\n        }\r\n        //this.nav.show(loginView);\r\n        this.nav.push(loginView);\r\n    }\r\n\r\n    async logout(notShowLogin?:boolean) {\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        logoutUsqTokens();\r\n        setCenterToken(undefined);\r\n        this.ws = undefined;\r\n        if (notShowLogin === true) return;\r\n        await this.showLogin();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.nav.level;\r\n    }\r\n    startWait() {\r\n        this.nav.startWait();\r\n    }\r\n    endWait() {\r\n        this.nav.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.nav.onError(error);\r\n    }\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.nav.pop(level);\r\n    }\r\n    clear() {\r\n        this.nav.clear();\r\n    }\r\n    navBack() {\r\n        this.nav.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.nav.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.nav.confirmBox(message);\r\n    }\r\n    navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number) {\r\n        let centerUrl = getCenterUrl();\r\n        let sheet = centerUrl.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n        let uh = sheetId === undefined?\r\n                appUrl(url, unitId) :\r\n                appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n        console.log('navToApp: %s', JSON.stringify(uh));\r\n        nav.push(<article className='app-container'>\r\n            <span id={uh.hash} onClick={()=>this.back()} style={mobileHeaderStyle}>\r\n                <i className=\"fa fa-arrow-left\" />\r\n            </span>\r\n            <iframe src={uh.url} />\r\n        </article>);\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n","export {left0} from './left0';\r\nexport * from './user';\r\nexport * from './net';\r\nexport * from './ui';\r\nexport * from './uid';\r\nexport {PageItems} from './pageItems';\r\nexport {CacheIds} from './cacheIds';\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from './uiSchema';\r\nimport { ArrSchema, ItemSchema } from './schema';\r\nimport { Widget as Widget } from './widgets/widget';\r\nimport { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {    \r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly data: any;\r\n    readonly inNode: boolean;           // true: </> Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.data = data;\r\n        this.inNode = inNode;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    abstract get isRow():boolean;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.data[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.data[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        if (this.rules === undefined) return;\r\n        this.clearContextErrors();\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, ret[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) this.widgets[i].clearContextError();\r\n    }\r\n\r\n    checkRules() {\r\n        this.checkFieldRules();\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        return (this.errorWidgets.length + this.errors.length) > 0\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    removeErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nexport class RowContext extends Context {\r\n    readonly formContext: FormContext;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly uiSchema: UiArr;\r\n    readonly row: ArrRow;\r\n    constructor(formContext:FormContext, arrSchema: ArrSchema, data: any, inNode: boolean, row:ArrRow) {\r\n        let uiArr:UiArr;\r\n        let {form} = formContext;\r\n        let {uiSchema} = form;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(formContext.form, uiArr, data, inNode);\r\n        this.formContext = formContext;\r\n        this.arrSchema = arrSchema;\r\n        this.row = row;\r\n    }\r\n    get isRow():boolean {return true};\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    rowContexts:{[name:string]:{[rowKey:string]:RowContext}} = {};\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode);\r\n    }\r\n    get isRow():boolean {return false};\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    checkFieldRules() {\r\n        super.checkFieldRules();\r\n        for (let i in this.rowContexts) {\r\n            let arrRowContexts = this.rowContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n    checkContextRules() {\r\n        super.checkContextRules();\r\n        for (let i in this.rowContexts) {\r\n            let arrRowContexts = this.rowContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.removeErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n    @computed get hasError():boolean {\r\n        if (super.checkHasError() === true) return true;\r\n        for (let i in this.rowContexts) {\r\n            let arrRowContexts = this.rowContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import _ from 'lodash';\r\nimport {nav} from '../ui';\r\nimport {uid} from '../uid';\r\nimport {usqTokenApi, callCenterapi, CenterAppApi, AppUsq, centerToken, App} from './usqApi';\r\nimport {setSubAppWindow, wsBridge} from './wsChannel';\r\nimport { getUrlOrDebug } from './apiBase';\r\n\r\nexport interface UsqToken {\r\n    name: string;\r\n    url: string;\r\n    urlDebug: string;\r\n    token: string;\r\n}\r\ninterface UsqTokenAction extends UsqToken {\r\n    resolve: (value?: UsqToken | PromiseLike<UsqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst usqTokens:{[usqName:string]: UsqTokenAction}  = {};\r\nexport function logoutUsqTokens() {\r\n    for (let i in usqTokens) usqTokens[i] = undefined;\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let meInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            console.log(\"receive PostMessage: %s\", JSON.stringify(message));\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            console.log(\"onReceiveAppApiMessage: %s\", JSON.stringify(ret));\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                url: ret.url,\r\n                urlDebug: ret.urlDebug,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n            this.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    nav.user = message; // message.user;\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UsqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, url:undefined, urlDebug:undefined, token:undefined};\r\n    let {unit} = appInFrame;\r\n    let parts = apiName.split('/');\r\n    let ret = await usqTokenApi.usq({unit: unit, usqOwner: parts[0], usqName: parts[1]});\r\n    if (ret === undefined) {\r\n        console.log('apiTokenApi.api return undefined. api=%s, unit=%s', apiName, unit);\r\n        throw 'api not found';\r\n    }\r\n    return {name: apiName, url: ret.url, urlDebug:ret.urlDebug, token: ret.token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, url, urlDebug, token} = message;\r\n    let action = usqTokens[apiName];\r\n    if (action === undefined) {\r\n        throw 'error app api return';\r\n        //return;\r\n    }\r\n    let realUrl = await getUrlOrDebug(url, urlDebug);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', debug=' + urlDebug + ', real=' + realUrl);\r\n    action.url = realUrl;\r\n    action.token = token;\r\n    action.resolve(action);\r\n}\r\n\r\nexport function setMeInFrame(appHash: string):AppInFrame {\r\n    let parts = appHash.split('-');\r\n    let len = parts.length;\r\n    meInFrame.hash = parts[0].substr(3);\r\n    if (len>0) meInFrame.unit = Number(parts[1]);\r\n    if (len>1) meInFrame.page = parts[2];\r\n    if (len>2) meInFrame.param = parts.slice(3);\r\n    return meInFrame;\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nexport async function loadAppUsqs(appOwner:string, appName): Promise<App> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let unit = meInFrame.unit;\r\n    return await centerAppApi.usqs(unit, appOwner, appName);\r\n}\r\n\r\nexport async function appUsq(usq:string, usqOwner:string, usqName:string): Promise<UsqToken> {\r\n    let usqToken = usqTokens[usq];\r\n    if (usqToken !== undefined) return usqToken;\r\n    if (!isBridged()) {\r\n        usqToken = await usqTokenApi.usq({unit: meInFrame.unit, usqOwner:usqOwner, usqName:usqName});\r\n        if (usqToken === undefined) {\r\n            let err = 'unauthorized call: usqTokenApi center return undefined!';\r\n            throw err;\r\n        }\r\n        if (usqToken.token === undefined) usqToken.token = centerToken;\r\n        let {url, urlDebug} = usqToken;\r\n        let realUrl = await getUrlOrDebug(url, urlDebug);\r\n        console.log('realUrl: %s', realUrl);\r\n        usqToken.url = realUrl;\r\n        usqTokens[usq] = usqToken;\r\n        return usqToken;\r\n    }\r\n    console.log(\"appApi parent send: %s\", meInFrame.hash);\r\n    usqToken = {\r\n        name: usq,\r\n        url: undefined,\r\n        urlDebug: undefined,\r\n        token: undefined,\r\n        resolve: undefined,\r\n        reject: undefined,\r\n    };\r\n    usqTokens[usq] = usqToken;\r\n    return new Promise<UsqToken>((resolve, reject) => {\r\n        usqToken.resolve = async (at) => {\r\n            let a = await at;\r\n            console.log('return from parent window: %s', JSON.stringify(a));\r\n            usqToken.url = a.url;\r\n            usqToken.urlDebug = a.urlDebug;\r\n            usqToken.token = a.token;\r\n            resolve(usqToken);\r\n        }\r\n        usqToken.reject = reject;\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: usq,\r\n            hash: meInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async receive(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","export {WSChannel, wsBridge, postWsToTop} from './wsChannel';\r\nexport * from './apiBase';\r\nexport * from './usqApi';\r\nexport {meInFrame, loadAppUsqs, isBridged} from './appBridge';\r\nexport * from './debugHost';\r\nexport {httpGet} from './httpChannel';\r\n","import {nav} from '../ui/nav';\r\nimport {FetchError} from '../fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n}\r\n\r\n","import * as _ from 'lodash';\r\nimport {HttpChannel} from './httpChannel';\r\nimport {HttpChannelUI, HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUsq} from './appBridge';\r\nimport {ApiBase, getUrlOrDebug} from './apiBase';\r\n\r\nlet channelUIs:{[name:string]: HttpChannel} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n}\r\n\r\nexport class UsqApi extends ApiBase {\r\n    private access:string[];\r\n    usqOwner: string;\r\n    usqName: string;\r\n    usq: string;\r\n\r\n    constructor(basePath: string, usqOwner, usqName: string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        if (usqName) {\r\n            this.usqOwner = usqOwner;\r\n            this.usqName = usqName;\r\n            this.usq = usqOwner + '/' + usqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.usq];\r\n        if (channel !== undefined) return channel;\r\n        let usqToken = await appUsq(this.usq, this.usqOwner, this.usqName);\r\n        this.token = usqToken.token;\r\n        channel = new HttpChannel(false, usqToken.url, usqToken.token, channelUI);\r\n        return channels[this.usq] = channel;\r\n    }\r\n\r\n\r\n    async update():Promise<string> {\r\n        return await this.get('update');\r\n    }\r\n\r\n    async loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        return await this.get('access', {acc:acc});\r\n    }\r\n\r\n    async loadEntities():Promise<any> {\r\n        return await this.get('entities');\r\n    }\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async schemas(names:string[]):Promise<any[]> {\r\n        return await this.post('schema', names);\r\n    }\r\n\r\n    async tuidGet(name:string, id:number):Promise<any> {\r\n        return await this.get('tuid/' + name + '/' + id);\r\n    }\r\n\r\n    async tuidGetAll(name:string):Promise<any[]> {\r\n        return await this.get('tuid-all/' + name + '/');\r\n    }\r\n\r\n    async tuidSave(name:string, params):Promise<any> {\r\n        return await this.post('tuid/' + name, params);\r\n    }\r\n\r\n    async tuidSearch(name:string, arr:string, owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret = await this.post('tuids/' + name, {\r\n            arr: arr,\r\n            owner: owner,\r\n            key: key,\r\n            pageStart: pageStart,\r\n            pageSize: pageSize\r\n        });\r\n        return ret;\r\n    }\r\n    async tuidArrGet(name:string, arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.get('tuid-arr/' + name + '/' + owner + '/' + arr + '/' + id);\r\n    }\r\n    async tuidArrGetAll(name:string, arr:string, owner:number):Promise<any[]> {\r\n        return await this.get('tuid-arr-all/' + name + '/' + owner + '/' + arr + '/');\r\n    }\r\n    async tuidArrSave(name:string, arr:string, owner:number, params):Promise<any> {\r\n        return await this.post('tuid-arr/' + name + '/' + owner + '/' + arr + '/', params);\r\n    }\r\n    async tuidArrPos(name:string, arr:string, owner:number, id:number, order:number):Promise<any> {\r\n        return await this.post('tuid-arr-pos/' + name + '/' + owner + '/' + arr + '/', {\r\n            id: id,\r\n            $order: order\r\n        });\r\n    }\r\n\r\n    async tuidIds(name:string, arr:string, ids:number[]):Promise<any[]> {\r\n        try {\r\n            let url = 'tuidids/' + name + '/';\r\n            if (arr !== undefined) url += arr;\r\n            else url += '$';\r\n            let ret = await this.post(url, ids);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    async proxied(name:string, proxy:string, id:number):Promise<any> {\r\n        try {\r\n            let url = 'tuid-proxy/' + name + '/' + proxy + '/' + id;\r\n            let ret = await this.get(url);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    async sheetSave(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name, data);\r\n    }\r\n\r\n    async sheetAction(name:string, data:object) {\r\n        return await this.put('sheet/' + name, data);\r\n    }\r\n\r\n    async stateSheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/states', data);\r\n    }\r\n\r\n    async stateSheetCount(name:string):Promise<any> {\r\n        return await this.get('sheet/' + name + '/statecount');\r\n    }\r\n\r\n    async getSheet(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/get/' + id);\r\n    }\r\n\r\n    async sheetArchives(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name + '/archives', data);\r\n    }\r\n\r\n    async sheetArchive(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/archive/' + id);\r\n    }\r\n\r\n    async action(name:string, data:object):Promise<any> {\r\n        return await this.post('action/' + name, data);\r\n    }\r\n\r\n    async page(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p:any;\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return await this.post('query-page/' + name, p);\r\n    }\r\n\r\n    async query(name:string, params:any):Promise<any> {\r\n        let ret = await this.post('query/' + name, params);\r\n        return ret;\r\n    }\r\n/*\r\n    async history(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n\r\n    async book(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n*/\r\n    async user():Promise<any> {\r\n        return await this.get('user');\r\n    }\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UsqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUsq(this.unitId);\r\n        let {token, url, urlDebug} = ret;\r\n        let realUrl = await getUrlOrDebug(url, urlDebug);\r\n        this.token = token;\r\n        return new HttpChannel(false, realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport function getCenterUrl():string {\r\n    return centerHost;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nexport function setCenterToken(t?:string) {\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new HttpChannel(true, centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new HttpChannel(true, centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApi extends ApiBase {\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nexport class UsqTokenApi extends CenterApi {\r\n    async usq(params: {unit:number, usqOwner:string, usqName:string}):Promise<any> {\r\n        return await this.get('app-usq', params);\r\n    }\r\n}\r\n\r\nexport const usqTokenApi = new UsqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApi {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface App {\r\n    id: number;\r\n    usqs: AppUsq[];\r\n}\r\n\r\nexport interface AppUsq {\r\n    id: number;\r\n    usqOwner: string;\r\n    usqName: string;\r\n    url: string;\r\n    urlDebug: string;\r\n    ws: string;\r\n    wsDebug: string;\r\n    access: string;\r\n    token: string;\r\n}\r\nconsole.log('CenterApi');\r\nconsole.log(CenterApi);\r\nexport class CenterAppApi extends CenterApi {\r\n    async usqs(unit:number, appOwner:string, appName:string):Promise<App> {\r\n        return await this.get('tie/app-usqs', {unit:unit, appOwner:appOwner, appName:appName});\r\n    }\r\n    async unitxUsq(unit:number):Promise<AppUsq> {\r\n        return await this.get('tie/unitx-usq', {unit:unit});\r\n    }\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import {isDevelopment} from '../local';\r\nimport {HttpChannel} from './httpChannel';\r\nimport {centerDebugHost, usqDebugHost, debugUsqlServer} from './debugHost';\r\nimport {fetchLocalCheck} from './fetchLocalCheck';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url, options, resolve, reject) {\r\n    await channel.fetch(url, options, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract async getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n\r\nfunction replaceUrlHost(url:string, hostString:string, defaultHost:string, envHost:string) {\r\n    //let hostString = '://centerhost:';\r\n    let pos = url.indexOf(hostString);\r\n    if (pos > 0) {\r\n        let host = process.env[envHost] || defaultHost;\r\n        url = url.replace(hostString, '://' + host + '/');\r\n    }\r\n    return url;\r\n}\r\n\r\nexport async function getUrlOrDebug(url:string, urlDebug:string, path:string = 'hello'):Promise<string> {\r\n    if (isDevelopment !== true) return url;\r\n    if (!urlDebug) return url;\r\n    try {\r\n        let orgDebug = urlDebug;\r\n        if (urlDebug.endsWith('/') === false) urlDebug += '/';\r\n        urlDebug = replaceUrlHost(urlDebug, '://centerhost/', centerDebugHost, 'REACT_APP_CENTER_DEBUG_HOST');\r\n        urlDebug = replaceUrlHost(urlDebug, '://usqhost/', usqDebugHost, 'REACT_APP_USQ_DEBUG_HOST');\r\n        urlDebug = replaceUrlHost(urlDebug, '://unitxhost/', usqDebugHost, 'REACT_APP_USQ_DEBUG_HOST');        \r\n        urlDebug = replaceUrlHost(urlDebug, '://usql-server/', debugUsqlServer, 'REACT_APP_DEBUG_USQL_SERVER');\r\n\r\n        if (path === undefined) path = '';\r\n        let fetchUrl = urlDebug + path;\r\n        console.log('urlDebug: ' + orgDebug + ' ---- ' + urlDebug + ' === ' + fetchUrl);\r\n        let fetchOptions = {\r\n            method: \"GET\",\r\n            mode: \"no-cors\", // no-cors, cors, *same-origin\r\n            headers: {\r\n                \"Content-Type\": \"text/plain\"\r\n            },\r\n        };\r\n        let ret = await fetchLocalCheck(fetchUrl, fetchOptions);\r\n        let text = await ret.text();\r\n        return urlDebug;\r\n    }\r\n    catch (error) {\r\n        console.log('cannot connect %s, so use %s', urlDebug, url);\r\n        console.error(error);\r\n        return url;\r\n    }\r\n}\r\n","import {User} from './user';\r\n\r\nexport const isDevelopment = process.env.NODE_ENV === 'development';\r\n\r\nexport interface ClearableData {\r\n    clear(): void;\r\n}\r\n\r\nexport class Data<T> implements ClearableData {\r\n    private name: string;\r\n    private value?: T;\r\n    constructor(name: string) {this.name = name; }\r\n    get(): T {\r\n        if (this.value !== undefined) return this.value;\r\n        let v = localStorage.getItem(this.name);\r\n        return this.value = v === null ? undefined : JSON.parse(v); \r\n    }\r\n    set(value: T) {\r\n        if (!value) { this.clear(); return; }\r\n        this.value = value;\r\n        localStorage.setItem(this.name, JSON.stringify(value));\r\n    }\r\n    clear() {\r\n        this.value = undefined;\r\n        localStorage.removeItem(this.name);\r\n    }\r\n}\r\n\r\nexport class LocalData {\r\n    user = new Data<User>('user');\r\n    device = new Data<string>('device');\r\n    homeTabCur = new Data<number>('homeTabCur');\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user, \r\n            this.homeTabCur\r\n        ].map(d => d.clear());\r\n    }\r\n}\r\n","export * from './nav';\r\nexport * from './titleBar';\r\nexport * from './page';\r\n//export * from './listView';\r\n//export * from './listRow';\r\nexport * from './rowIcon';\r\nexport * from './row';\r\n//export * from './dropdownActions';\r\n//export * from './validForm';\r\nexport * from './VM';\r\nexport * from './form';\r\nexport * from './res';\r\nexport * from './tabs';\r\nexport * from './loading';","export const centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nexport const usqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nexport const debugUsqlServer = 'localhost:3009';\r\n\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from '../fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../ui/nav';\r\nimport { isDevelopment } from '../local';\r\n\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n\r\nexport class HttpChannel {\r\n    private isCenter: boolean;\r\n    private hostUrl: string;\r\n    private apiToken: string;\r\n    private ui?: HttpChannelUI;\r\n    private timeout: number;\r\n\r\n    constructor(isCenter: boolean, hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.isCenter = isCenter;\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = isDevelopment === true? 500000:5000;\r\n    }\r\n\r\n    private startWait = () => {\r\n        if (this.ui !== undefined) this.ui.startWait();\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('webapi ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async get(url: string, params: any = undefined): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async post(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async put(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async delete(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n    async fetch(url: string, options: any, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait();\r\n        let path = url;\r\n        function buildError(err: string) {\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s %s', options.method, path);\r\n            let timeOutHandler = setTimeout(() => that.endWait(url, reject), this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        return resolve(retJson.res);\r\n                    }\r\n                    if (retJson.error === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retJson.error));\r\n                        reject(retJson.error);\r\n                    }\r\n                    //throw retJson.error;\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error.message));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            if (typeof error === 'string') {\r\n                if (error.toLowerCase().startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            await this.showError(buildError(error.message));\r\n        };\r\n    }\r\n\r\n    private async innerFetch(url: string, options: any): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.isCenter === true && this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    private buildOptions(): any {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        let options = {\r\n            headers: headers,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {IComputedValue} from 'mobx';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\nimport {TitleBar} from './titleBar';\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: () => void;\r\n    onScrollBottom?: () => void;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n    className?: string;\r\n}\r\nconst scrollTimeGap = 100;\r\nclass ScrollView extends React.Component<ScrollViewProps, null> {\r\n    private bottomTime:number = 0;\r\n    private topTime:number = 0;\r\n\r\n    private onScroll = async (e) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) this.props.onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        if (el.scrollTop < 30) {\r\n            //this.eachChild(this, 'top');\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n                    onScrollTop();\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n    }\r\n    render() {\r\n        return (\r\n            <main className={this.props.className} onScroll={this.onScroll}>\r\n                {this.props.children}\r\n            </main>\r\n        );\r\n    }\r\n}\r\n\r\nexport interface Tab extends ScrollProps {\r\n    title: string;\r\n    icon?: string;\r\n    content?: JSX.Element | (()=>JSX.Element);\r\n    header?: string;\r\n    isSelected?: boolean;\r\n    redDot?: IComputedValue<number>;\r\n    load?: () => Promise<void>;\r\n}\r\nexport interface TabState extends Tab {\r\n    isMounted?: boolean;\r\n}\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    keepHeader?: boolean;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    tabs?: Tab[];\r\n    logout?: boolean | (()=>void);\r\n}\r\nexport interface PageState {\r\n    cur?: Tab;\r\n    tabs?: TabState[];\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps, PageState> {\r\n    private tabs:TabState[];\r\n    constructor(props: PageProps) {\r\n        super(props);\r\n        let {tabs} = props;\r\n        if (tabs === undefined || tabs.length === 0) return;\r\n        this.tabs = tabs;\r\n        let cur:Tab;\r\n        let tabStates:Tab[] = [];\r\n        for (let tab of tabs) {\r\n            let t:TabState = _.clone(tab);\r\n            if (cur === undefined) {\r\n                if (t.isSelected === true)\r\n                    cur = t;\r\n                else\r\n                    t.isSelected = false;\r\n            }\r\n            else {\r\n                t.isSelected = false;\r\n            }\r\n            t.isMounted = false;\r\n            tabStates.push(t);\r\n        }\r\n        this.state = {\r\n            cur: cur,\r\n            tabs: tabStates,\r\n        };\r\n    }\r\n\r\n    async componentDidMount() {\r\n        if (this.tabs === undefined) return;\r\n        let t0 = this.state.tabs[0];\r\n        if (t0 === undefined) return;\r\n        await this.onTabClick(t0);\r\n    }\r\n\r\n    private async onTabClick(tab: TabState) {\r\n        if (tab.isSelected === true) return;\r\n        let cur:TabState;\r\n        let tabs = this.state.tabs;\r\n        for (let t of tabs) {\r\n            if (t === tab) {\r\n                t.isSelected = true;\r\n                cur = t;\r\n            }\r\n            else\r\n                t.isSelected = false;\r\n        }\r\n        if (cur.isMounted !== true) {\r\n            let {load} = cur;\r\n            if (load !== undefined) {\r\n                await load();\r\n            }\r\n        }\r\n        this.setState({\r\n            cur: cur,\r\n            tabs: tabs\r\n        });\r\n    }\r\n\r\n    private onTouchStart(evt: React.TouchEvent<HTMLElement>) {\r\n    }\r\n\r\n    private renderTabs(footer: JSX.Element) {\r\n        const {header, back, right, keepHeader} = this.props;\r\n        let cur = this.state.cur;\r\n        let tabs = <div>{\r\n                this.state.tabs.map((tab, index) => {\r\n                    const {icon, isSelected, title, redDot} = tab;\r\n                    let img:any, redDotView:any, cn:any;\r\n                    if (icon !== undefined) img = <img src={icon} />;\r\n                    if (redDot !== undefined) {\r\n                        let v = redDot.get();\r\n                        if (v < 0) {\r\n                            cn = classNames('red-dot');\r\n                            redDotView = <u />;\r\n                        }\r\n                        else if (v > 0) {\r\n                            cn = classNames('red-dot', 'num');\r\n                            redDotView = <u>{v}</u>;\r\n                        }\r\n                    }\r\n                    return <div key={index}\r\n                        className= {classNames('va-tab', {cur: isSelected})}\r\n                        onClick={() => this.onTabClick(tab)}>\r\n                        {img}<div className={cn}>{title}{redDotView}</div>\r\n                    </div>\r\n                })\r\n            }</div>;\r\n        let titleBar;\r\n        if (header !== false) {\r\n            titleBar = <TitleBar \r\n                back={back} \r\n                center={keepHeader===true? (header as string) : (cur && (cur.header || cur.title))}\r\n                right={right} \r\n            />;\r\n        }\r\n\r\n        return <article className='page-container'>\r\n            {titleBar}\r\n            <section>\r\n            {\r\n                this.state.tabs.map((tab, index) => {\r\n                    let {isSelected, isMounted, content} = tab;\r\n                    if (isSelected === true || isMounted === true) {\r\n                        tab.isMounted = true;\r\n                        return <ScrollView key={index}\r\n                            className={classNames({invisible: isSelected===false})}\r\n                            onScroll={tab.onScroll}\r\n                            onScrollTop={tab.onScrollTop}\r\n                            onScrollBottom={tab.onScrollBottom}\r\n                        >\r\n                            {(typeof content)==='function'? (content as ()=>JSX.Element)():content}\r\n                        </ScrollView>;\r\n                    }\r\n                })\r\n            }\r\n            </section>\r\n            {tabs}\r\n            {footer}\r\n        </article>;\r\n    }\r\n    private renderSingle(footer: JSX.Element) {\r\n        const {back, header, right, onScroll, onScrollTop, onScrollBottom, children} = this.props;\r\n        let titleBar;\r\n        if (header !== false)\r\n            titleBar = <TitleBar \r\n                back={back} \r\n                center={header as any}\r\n                right={right}\r\n                logout={this.props.logout}\r\n            />;\r\n        return (\r\n            <article className='page-container' onTouchStart={this.onTouchStart}>\r\n                {titleBar}\r\n                <section>\r\n                    <ScrollView\r\n                        onScroll={onScroll}\r\n                        onScrollTop={onScrollTop}\r\n                        onScrollBottom={onScrollBottom}\r\n                    >\r\n                        {children}\r\n                    </ScrollView>\r\n                </section>\r\n                {footer}\r\n            </article>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        const {footer} = this.props;\r\n        let elFooter;\r\n        if (footer !== undefined) elFooter = <footer>{footer}</footer>;\r\n        if (this.tabs !== undefined)\r\n            return this.renderTabs(elFooter);\r\n        else\r\n            return this.renderSingle(elFooter);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{lang:string, district:string} = {\r\n    lang: undefined,\r\n    district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n    resOptions.lang = lang;\r\n    resOptions.district = district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = navigator.languages && navigator.languages[0] || // Chrome / Firefox\r\n        navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1];\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {nav, mobileHeaderStyle} from './nav';\r\n\r\nexport interface TitleBarProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>void);\r\n}\r\nexport interface TitleBarState {\r\n    hasBack: boolean;\r\n}\r\nexport class TitleBar extends React.Component<TitleBarProps, TitleBarState> {\r\n    private navChangeHandler: ()=>void;\r\n    constructor(props) {\r\n        super(props);\r\n        this.navChange = this.navChange.bind(this);\r\n        this.state = {\r\n            hasBack: false,\r\n        };\r\n    }\r\n    navChange() {\r\n        this.setState({\r\n            hasBack: nav.level > 1\r\n        })\r\n    }\r\n    componentWillMount() {\r\n        this.navChange();\r\n        //this.navChangeHandler = nav.events.add('change', this.navChange);\r\n    }\r\n    componentWillUnmount() {\r\n        //nav.events.remove('change', this.navChangeHandler);\r\n    }\r\n    async back() {\r\n        await nav.back(); // confirm boxdataForm\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        if (confirm('Really want to logout?') === false) return;\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            logout(); \r\n        }\r\n        nav.logout();\r\n    }\r\n    render() {\r\n        let b = this.state.hasBack || self != top;\r\n        let {right, center, logout} = this.props;\r\n        let back, pop, debugLogout;\r\n        if (logout !== undefined && self === top) {\r\n            if (typeof logout === 'boolean' && logout === true\r\n                || typeof logout === 'function')\r\n            {\r\n                let {nick, name} = nav.user;\r\n                debugLogout = <div className=\"d-flex align-items-center\">\r\n                    <small className=\"text-light\">{nick || name}</small>\r\n                    <a className=\"dropdown-toggle btn btn-secondary btn-sm ml-2\"\r\n                        role=\"button\"\r\n                        onClick={this.logoutClick}>\r\n                        <i className=\"fa fa-sign-out\" />\r\n                    </a>\r\n                </div>;\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none': back = undefined; break;\r\n                default:\r\n                case 'back': back = <nav onClick={this.back}><i className=\"fa fa-arrow-left\" /></nav>; break;\r\n                case 'close': back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>; break;\r\n            }\r\n        }\r\n        if (self != top) {\r\n            console.log(document.location.href);\r\n            pop = <header onClick={this.openWindow} />;\r\n        }\r\n        let rightView;\r\n        if (right || debugLogout) rightView = <aside>{right} {debugLogout}</aside>;\r\n        return (\r\n        <header style={mobileHeaderStyle}>\r\n            {pop}\r\n            {back}\r\n            <div>{center}</div>\r\n            {rightView}\r\n        </header>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div style={{height:'100%'}} className=\"d-flex flex-fill align-items-center justify-content-center\">\r\n    <div className=\"d-flex align-items-center justify-content-center slide text-info\" style={{width:'5em', height:'2em'}}>\r\n        ...\r\n    </div>\r\n    </div>\r\n}\r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if ((value as number) !== NaN) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (n === NaN) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../uiSchema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable, reaction } from 'mobx';\r\n\r\nexport abstract class Widget {\r\n    protected name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected itemSchema: ItemSchema;\r\n    protected ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected value: any;\r\n    protected rules: Rule[];\r\n    @observable protected errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    protected readOnly:boolean;\r\n    protected disabled:boolean;\r\n    @observable visible:boolean;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this.ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);            \r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        this.init();\r\n    }\r\n\r\n    protected init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.data[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.setDataValue(value);\r\n        this.setElementValue(value);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onChange = (evt: React.ChangeEvent<any>) => {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(evt.currentTarget.value);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    renderContainer():JSX.Element {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            label = uiLabel || this.name;\r\n        }\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.render());\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.context, this.name, this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem } from '../uiSchema';\r\nimport { StringSchema } from '../schema';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected ui: UiTextItem;\r\n    protected input: HTMLInputElement;\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown: (evt:React.KeyboardEvent<HTMLInputElement>)=>void;\r\n\r\n    protected onBlur = () => {\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = () => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.removeErrors();\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n        this.input.disabled = this.disabled = value\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onChange}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected itemSchema: NumBaseSchema;\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n    protected onKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        let key = evt.keyCode;\r\n        event.returnValue = key===46 || key===8 || key===37 || key===39\r\n            || key>=48 && key<=57\r\n            || key>=96 && key<=105\r\n            || key===109 || key===189;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../uiSchema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected ui: UiCheckItem;\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    protected init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.setDataValue(evt.target.checked === true? this.trueValue : this.falseValue);\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onChange} />;\r\n        return this.context.inNode?\r\n            <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n            :\r\n            <div className={cn}>{input}</div>;\r\n    }\r\n}\r\n","import { Form } from './form';\r\nimport { UiArr } from './uiSchema';\r\nimport { ArrSchema } from './schema';\r\n\r\nlet keySeed:number = 1;\r\n\r\nexport class ArrRow {\r\n    readonly key: number;\r\n    readonly form: Form;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly uiArr: UiArr\r\n    readonly data: any;\r\n    constructor(form:Form, arrSchema:ArrSchema, data:any) {\r\n        this.key = keySeed++;\r\n        this.form = form;\r\n        this.arrSchema = arrSchema;\r\n        let {uiSchema} = form;\r\n        if (uiSchema !== undefined) {\r\n            this.uiArr = uiSchema.items[arrSchema.name] as UiArr;\r\n        }\r\n        this.data = data;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../uiSchema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected ui: UiSelect;\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../uiSchema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class IdWidget extends Widget {\r\n    protected ui: UiIdItem;\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || 'placeholder';\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            content = <>{this.value}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.context, this.name, this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../schema';\r\nimport { UiType } from '../uiSchema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../uiSchema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected ui: UiButton;\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            this.context.checkRules()\r\n            if (this.context.hasError === true) {\r\n                return;\r\n            }\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, label:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            label = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet(context, name);\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = label; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    render() {\r\n        return <this.observerRender />\r\n    }\r\n\r\n    renderContainer():JSX.Element {\r\n        if (this.visible === false) return null;        \r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        return form.FieldContainer(null, this.render());\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { Schema, ArrSchema, DataType, ButtonSchema, ItemSchema } from '../schema';\r\nimport { UiItem, UiArr, UiType, UiButton, TempletType } from '../uiSchema';\r\n//import { ContextValue, FormContext, Form } from '../form';\r\nimport { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, FormContext, ContextContainer } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { Unknown } from './unknown';\r\n\r\ntype TypeWidget = new (context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) => Widget;\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n    },\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    //case 'button':\r\n    //case 'submit':\r\n    //    return <FormButton context={context} itemSchema={itemSchema as ButtonSchema} children={children} />;\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent formContext={context as FormContext} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) {\r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n    let {isRow, widgets} = context;\r\n    let widget = new typeWidget(context, itemSchema, fieldProps, children);\r\n    widgets[name] = widget;\r\n\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.renderContainer());\r\n        //if (inNode === true) \r\n        return <WidgetElement />;\r\n        //return form.FieldContainer(label, <WidgetElement />);\r\n    }\r\n    else {\r\n        let widgetElement = widget.renderContainer();\r\n        //if (inNode === true) \r\n        return widgetElement;\r\n        //return form.FieldContainer(label, widgetElement);\r\n    }\r\n}\r\n\r\nconst ArrComponent = observer((\r\n    {formContext, arrSchema, children}:{formContext: FormContext, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = formContext.data[name] as any[];\r\n    let {form, rowContexts} = formContext;\r\n    let arrRowContexts = rowContexts[name];\r\n    if (arrRowContexts === undefined) rowContexts[name] = arrRowContexts = {};\r\n    let ui = formContext.getUiItem(name) as UiArr;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;    \r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable} = ui;\r\n        selectable = arrSelectable;\r\n        deletable = arrDeletable;\r\n        restorable = arrRestorable;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let {ArrContainer, RowContainer, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let arrRow = row.$row;\r\n            if (arrRow === undefined) {\r\n                row.$row = arrRow = new ArrRow(form, arrSchema, row);\r\n            }\r\n            let rowKey = arrRow.key;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    row.$isSelected=(evt.target as HTMLInputElement).checked;\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n                        if (p>=0) data.splice(p, 1);\r\n                    }\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit align-self-start text-info cursor-pointer\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}<div className=\"flex-grow-1\">{content}</div>{deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = form.RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(formContext, arrSchema, row, true, arrRow);\r\n                rowContent = <>children</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(formContext, arrSchema, row, true, arrRow);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent));\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(formContext, arrSchema, row, true, arrRow);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(formContext, arrSchema, row, false, arrRow);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            arrRowContexts[rowKey] = rowContext;\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../uiSchema';\r\nimport { StringSchema } from '../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected itemSchema: StringSchema;\r\n    protected input: HTMLTextAreaElement;\r\n    protected ui: UiTextAreaItem;\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        return <textarea ref={(input) => this.input=input} \r\n            rows={this.ui && this.ui.rows}\r\n            maxLength={this.itemSchema.maxLength}\r\n            defaultValue={this.defaultValue} onChange={this.onChange} />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../uiSchema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\n//const radioStyle:React.CSSProperties = {width:'2em', height:'1.2em'};\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected ui: UiRadio;\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow, inNode} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).row.key;\r\n        }\r\n        let cn = classNames(this.className, 'form-radio-inline');\r\n        return <span className={cn}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n/*\r\n<div className=\"form-control d-flex border-0\"><input\r\nref={(input)=>this.input = input}\r\nclassName={classNames(this.className, 'align-self-center')}\r\ntype=\"checkbox\"\r\nstyle={{maxHeight:\"1.2em\"}}\r\ndefaultValue={this.defaultValue} \r\nonChange={this.onChange} />\r\n</div>\r\n*/","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../uiSchema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected ui: UiRange;\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","export {factory} from './factory';","// \r\n// fetch timeout\r\n// timeoutfetchcancel\r\n\r\n// web\r\nconst timeout = 2000;\r\n\r\nexport function fetchLocalCheck(url, options?:any):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, options).then(resolve).catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      setTimeout(reject, timeout, e);\r\n    });\r\n}\r\n","import {observable} from 'mobx';\r\n\r\nexport const store = {\r\n    homeCount: observable.box<number>(-1),\r\n    cartCount: observable.box<number>(101),\r\n};\r\n","import * as jwtDecode from 'jwt-decode';\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    token: string;\r\n    device: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let accesses;\r\n    if (ret.accesses) accesses = ret.accesses.split(',');\r\n\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        token: token,\r\n        device: ret.device,\r\n    };\r\n    return user;\r\n}\r\n","import * as React from 'react';\r\n\r\nconst iconStyle=(color?:string) => { \r\n    return {\r\n        color:color || '#7f7fff',\r\n        margin:'6px 0'\r\n    }\r\n};\r\nexport const rowIcon=(name:string, color?:string) => \r\n    <i style={iconStyle(color)} className={'fa fa-lg fa-' + name} />;\r\n","import * as React from 'react';\r\nimport * as classNames from 'classnames';\r\n\r\nexport interface LabelRowProps {\r\n    label: string;\r\n    className?: string;\r\n    action?: () => void;\r\n}\r\n\r\nexport interface LabelRowState {\r\n    isPressed: boolean;\r\n} \r\n\r\nexport class LabelRow extends React.Component<LabelRowProps, LabelRowState> {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            isPressed: false\r\n        }\r\n    }\r\n    mouseDown() {\r\n        this.setState({isPressed: true});\r\n    }\r\n    mouseUp() {\r\n        this.setState({isPressed: false});\r\n        if (this.props.action) this.props.action();\r\n    }\r\n    render() {\r\n        let c = classNames('row', 'label-row', this.props.className, {\r\n            pressed: this.state.isPressed\r\n        });\r\n        return (\r\n        <div\r\n            className={c}\r\n            onMouseDown={()=>this.mouseDown()} \r\n            onMouseUp={()=>this.mouseUp()}>\r\n            <div className=\"col-xs-3\">{this.props.label}</div>\r\n            <div className=\"col-xs-9\">{this.props.children}</div>\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport interface ActionRowProps {\r\n    className?: string;\r\n    action?: () => void;\r\n}\r\n\r\nexport interface ActionRowState {\r\n    isPressed: boolean;\r\n} \r\n\r\nexport class ActionRow extends React.Component<ActionRowProps, ActionRowState> {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            isPressed: false\r\n        }\r\n    }\r\n    mouseDown() {\r\n        this.setState({isPressed: true});\r\n    }\r\n    mouseUp() {\r\n        this.setState({isPressed: false});\r\n        if (this.props.action) this.props.action();\r\n    }\r\n    render() {\r\n        let c = classNames('action-row', this.props.className, {\r\n            pressed: this.state.isPressed\r\n        });\r\n        return (\r\n        <div\r\n            className={c}\r\n            onMouseDown={()=>this.mouseDown()} \r\n            onMouseUp={()=>this.mouseUp()}>\r\n            {this.props.children}\r\n        </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {isDevelopment} from '../local';\r\nimport {User} from '../user';\r\nimport {nav} from './nav';\r\nimport {Page} from './page';\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n    readonly x: any;\r\n    icon: string|JSX.Element;\r\n    label:string;\r\n    readonly isDev:boolean = isDevelopment;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res:any) {\r\n        this.res = res || {};\r\n        this.x = this.res.x || {};\r\n    }\r\n\r\n    private receiveHandlerId:number;\r\n    private disposer:()=>void;\r\n\r\n    private dispose() {\r\n        // message listener\r\n        nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    protected async showVPage(vp: new (coordinator: Controller)=>VPage<Controller>, param?:any):Promise<void> {\r\n        await (new vp(this)).showEntry(param);\r\n    }\r\n\r\n    protected renderView(view: new (coordinator: Controller)=>View<Controller>, param?:any) {\r\n        return (new view(this)).render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n    protected async beforeStart():Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        this.registerReceiveHandler();\r\n        return true;\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any):Promise<void>;\r\n    async start(param?:any):Promise<void> {\r\n        this.disposer = this.dispose.bind(this);\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param);\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call(param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param);\r\n        });\r\n    }\r\n\r\n    async vCall(vp: new (coordinator: Controller)=>VPage<Controller>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this)).showEntry(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Coordinator call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element) {\r\n        nav.push(page, this.disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element) {\r\n        nav.replace(page, this.disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n    }\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n    }\r\n}\r\n\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n        this.x = controller.x;\r\n    }\r\n\r\n    protected get isDev() {return isDevelopment}\r\n\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (coordinator: Controller)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async showVPage(vp: new (coordinator: Controller)=>VPage<Controller>, param?:any):Promise<void> {\r\n        await (new vp(this.controller)).showEntry(param);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        /*\r\n        if (this._resolve_$_ !== undefined) {\r\n            await this._resolve_$_({type:type, value:value});\r\n            return;\r\n        }*/\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.openPage(React.createElement(view, param));\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element) {\r\n        this.controller.openPage(page);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element) {\r\n        this.controller.replacePage(page);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n}\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n    constructor(coordinator: C) {\r\n        super(coordinator);\r\n    }\r\n\r\n    abstract showEntry(param?:any):Promise<void>;\r\n\r\n    render(param?:any):JSX.Element {return null;}\r\n}\r\n\r\nexport type TypeVPage<C extends Controller> = new (coordinator: C)=>VPage<C>;\r\n\r\n","export {Form} from './form';\r\nexport {Field} from './field';\r\nexport * from './schema';\r\nexport * from './uiSchema';\r\nexport {Context} from './context';\r\n","import * as React from 'react';\r\n//import { FormContext, ContextValue, Form } from './form';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class Field extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import {observable, IObservableArray, computed} from 'mobx';\r\nimport {uid} from './uid';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n    private isFirst: boolean = true;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n    }\r\n\r\n    @observable topDiv:string;\r\n    @observable bottomDiv:string;\r\n    scrollToTop() {\r\n        this.topDiv = '$$'+uid();\r\n    }\r\n    scrollToBottom() {\r\n        this.bottomDiv = '$$'+uid();\r\n    }\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n    protected abstract async load(param:any, pageStart:any, pageSize:number):Promise<T[]>;\r\n    protected abstract setPageStart(item:T);\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n        this.allLoaded = false;\r\n        this._items.clear();\r\n        this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();        \r\n    }\r\n\r\n    async more():Promise<void> {\r\n        if (this.allLoaded === true) return;\r\n        if (this.loading === true) return;\r\n        this.loading = true;\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n                pageSize);\r\n        this.loading = false;\r\n        this.loaded = true;\r\n        let len = ret.length;\r\n        if (this.isFirst===true && len>this.firstSize ||\r\n            this.isFirst===false && len>this.pageSize)\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n        }\r\n        if (len === 0) {\r\n            this._items.clear();\r\n            return;\r\n        }\r\n        this.setPageStart(ret[len-1]);\r\n        if (this.appendPosition === 'tail')\r\n            this._items.push(...ret);\r\n        else\r\n            this._items.unshift(...ret.reverse());\r\n        this.isFirst = false;\r\n    }\r\n}\r\n","import {observable, computed} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract async _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract async _loadId(id:number):Promise<T>;\r\n}\r\n","import _ from 'lodash';\r\nimport { KeyValueRes, Res } from '../res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '',\r\n            number: '',\r\n            integer: '',\r\n            min: '${min}',\r\n            max: '${max}',\r\n        }\r\n    },\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from './schema';\r\nimport { UiSchema, TempletType } from './uiSchema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context, RowContext } from './context';\r\nimport { FormRes, formRes } from './formRes';\r\nimport { resLang } from '../res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    //onSubmit?: FormButtonClick;\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ArrContainer?: (label:any, content:JSX.Element) => JSX.Element;\r\n    RowContainer?: (content:JSX.Element) => JSX.Element;\r\n    //ArrFieldContainer?: (itemName:string, content:JSX.Element, context:RowContext) => JSX.Element;\r\n    ButtonClass?: string;\r\n    RowSeperator?: JSX.Element;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ArrContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly RowContainer: (content:JSX.Element) => JSX.Element;\r\n    //readonly ArrFieldContainer: (label:any, content:JSX.Element, context:RowContext) => JSX.Element;\r\n    readonly ButtonClass: string;\r\n    readonly RowSeperator: JSX.Element;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private content: any;\r\n    @observable readonly data:any;\r\n\r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, formData, \r\n            Container, FieldContainer, FieldClass, \r\n            ArrContainer, RowContainer, //ArrFieldContainer, \r\n            ButtonClass, RowSeperator,\r\n            res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.ArrContainer = ArrContainer || this.DefaultArrContainer;\r\n        this.RowContainer = RowContainer || this.DefaultRowContainer;\r\n        //this.ArrFieldContainer = ArrFieldContainer || this.DefaultArrFieldContainer;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n        this.RowSeperator = RowSeperator || this.DefaultRowSeperator;\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        this.uiSchema = uiSchema;\r\n        this.data = {};\r\n        if (formData === undefined) formData = {};\r\n        for (let itemSchema of schema) {\r\n            let {name, type} = itemSchema;\r\n            this.itemSchemas[name] = itemSchema;\r\n            if (type === 'button') {\r\n            }\r\n            else if (type === 'arr') {\r\n                let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n                let {arr:arrItems} = arrItem;\r\n                if (arrItems === undefined) continue;\r\n                let arrDict = arrItem.itemSchemas = {};\r\n                for (let item of arrItems) {\r\n                    arrDict[item.name] = item;\r\n                }\r\n                let val:any[] = formData[name];\r\n                if (val === undefined) val = [{}];\r\n                else if (Array.isArray(val) === false) val = [val];\r\n                let arr:any[] = [];\r\n                for (let row of val) {\r\n                    let r = {};\r\n                    for (let item of arrItems) {\r\n                        let {name:nm} = item;\r\n                        let v = row[nm];\r\n                        if (v === undefined) v = null;\r\n                        r[nm] = v;\r\n                    }\r\n                    arr.push(r);\r\n                }\r\n                this.data[name] = observable(arr);\r\n            }\r\n            else {\r\n                this.data[name] = formData[name];\r\n            }\r\n        }\r\n        let inNode:boolean = this.props.children !== undefined || this.uiSchema && this.uiSchema.Templet !== undefined;\r\n        //this.formContext = new FormContext(this, inNode);\r\n        let {children} = this.props;\r\n        //let content:JSX.Element; //, inNode:boolean;\r\n        //let formContext: FormContext;\r\n        if (children !== undefined) {\r\n            //inNode = true;\r\n            this.content = <>{children}</>;\r\n            this.formContext = new FormContext(this, true);\r\n        }\r\n        else {\r\n            let Templet: TempletType;\r\n            if (this.uiSchema !== undefined) {\r\n                Templet = this.uiSchema.Templet;\r\n            }\r\n            if (Templet !== undefined) {\r\n                // inNode = true;\r\n                this.content = typeof(Templet) === 'function'? Templet(this.context) : Templet;\r\n                this.formContext = new FormContext(this, true);\r\n            }\r\n            else {\r\n                // inNode = false;\r\n                this.formContext = new FormContext(this, false);\r\n                this.content = <>{this.schema.map((v, index) => {\r\n                    return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n                })}</>;\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    render() {\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            <this.formContext.renderErrors />\r\n            {this.Container(this.content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    /*\r\n    protected DefaultArrFieldContainer = (itemName:string, content:JSX.Element, context:RowContext): JSX.Element => {\r\n        return this.InnerFieldContainer(itemName, content, context);\r\n    }*/\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        //return this.InnerFieldContainer(itemName, content, context);\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultRowContainer = (content:JSX.Element): JSX.Element => {\r\n        //return <div className=\"row\">{content}</div>;\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRowSeperator = <div className=\"border border-gray border-top\" />;\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IObservableValue } from 'mobx/lib/internal';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n    content: () => JSX.Element;\r\n    notify?: IObservableValue<number>;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBack?: string;\r\n    contentBack?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n}\r\n\r\nclass Tab {\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n    contentBuilder: ()=>JSX.Element;\r\n    notify: IObservableValue<number>;\r\n\r\n    private _content: JSX.Element;\r\n    get content(): JSX.Element {\r\n        if (this.selected !== true) return this._content;\r\n        if (this._content !== undefined) return this._content;\r\n        return this._content = this.contentBuilder();\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n    private size: string;\r\n    private tabBack: string;\r\n    private contentBack: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabs: Tab[] = [];\r\n\r\n    constructor(props: TabsProps) {\r\n        super(props);\r\n        let {size, tabs, tabBack, contentBack, sep, selected} = this.props;\r\n        switch (size) {\r\n            default:\r\n            case 'md': this.size = '3.2rem'; break;\r\n            case 'sm': this.size = '4rem'; break;\r\n            case 'lg': this.size = '2.5rem'; break;\r\n        }\r\n        this.tabs.push(...tabs.map(v => {\r\n                let tab = new Tab();\r\n                tab.name = v.name;\r\n                tab.selected = false;\r\n                tab.caption = v.caption;\r\n                tab.contentBuilder = v.content;\r\n                tab.notify = v.notify;\r\n                return tab;\r\n            }\r\n        ));\r\n        this.tabBack = tabBack || 'bg-light';\r\n        this.contentBack = contentBack;\r\n        this.sep = sep || 'border-top border-gray';\r\n        if (selected !== undefined) {\r\n            this.selectedTab = this.tabs.find(v => v.name === selected);\r\n        }\r\n        if (this.selectedTab === undefined) this.selectedTab = this.tabs[0];\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    private tabClick = (tab:Tab) => {\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n    }\r\n\r\n    render() {\r\n        return <div className=\"tab\">\r\n            <div className={this.contentBack} style={{height: 'calc(100% - ' + this.size + ')'}}>\r\n                {this.tabs.map((v,index) => {\r\n                    let style:React.CSSProperties={\r\n                        display: v.selected===true? undefined : 'none'};\r\n                    return <div key={index} style={style}>{v.content}</div>;\r\n                })}\r\n            </div>\r\n            <div className={classNames(this.tabBack, this.sep)} style={{height: this.size}}>\r\n                {this.tabs.map((v,index) => {\r\n                    let {selected, caption, notify} = v;\r\n                    let notifyCircle:any;\r\n                    if (notify !== undefined) {\r\n                        let num = notify.get();\r\n                        if (num !== undefined) {\r\n                            if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                            else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                        }\r\n                    }\r\n                    return <div key={index} className=\"\" onClick={()=>this.tabClick(v)}>\r\n                        <div className=\"align-self-center\">\r\n                            {notifyCircle}\r\n                            {caption(selected)}\r\n                        </div>\r\n                    </div>\r\n                })}\r\n            </div>\r\n        </div>\r\n    }\r\n};\r\n","export * from './tabs';\r\n","\r\nimport {setCenterToken} from './usqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(token:string) {\r\n        setCenterToken(token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../fetchError';\r\nimport { refetchApi } from '../net';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n            //let errMsg = fetchError.errorMsg;\r\n        let errContent;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <li>\r\n            <article className=\"page-container\">\r\n                <section>\r\n                    <div  className=\"va-error\">\r\n                        <div></div>\r\n                        <div></div>\r\n                        <div>url: {url}</div>\r\n                        {errContent}\r\n                        <div className=\"p-3\">\r\n                            <button type='button' onClick={this.reApi}>API</button>\r\n                            <button type='button' onClick={this.close}></button>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n            </article>\r\n        </li>;\r\n    }\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","import * as React from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { Loading } from 'tonva-tools';\r\n\r\nexport const homeTab = () => {\r\n    let LoadableComponent = Loadable({\r\n        loader: () => import('./tab'),\r\n        loading: Loading\r\n    });\r\n    return <LoadableComponent />;\r\n}\r\n","import * as React from 'react';\r\nimport { TabCaptionComponent } from 'tonva-tools';\r\nimport {store} from './store';\r\nimport {homeTab} from './home';\r\nimport {memberTab} from './member';\r\nimport {cartTab} from './cart';\r\nimport {meTab} from './me';\r\n\r\n//export const cApp = new CApp(tonvaApp);\r\n\r\n\r\nconst color = (selected:boolean) => selected===true? 'text-primary' : 'text-muted';\r\nexport const faceTabs = [\r\n    {name: 'home', label: '', icon: 'home', content: homeTab, notify: store.homeCount},\r\n    {name: 'member', label: '', icon: 'vcard', content: memberTab},\r\n    {name: 'cart', label: '', icon: 'shopping-cart', content: cartTab, notify: store.cartCount},\r\n    {name: 'me', label: '', icon: 'user', content: meTab}\r\n].map(v => {\r\n    let {name, label, icon, content, notify} = v;\r\n    return {\r\n        name: name,\r\n        caption: (selected:boolean) => TabCaptionComponent(label, icon, color(selected)),\r\n        content: content,\r\n        notify: notify,\r\n    }\r\n});\r\n","import * as React from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { Loading } from 'tonva-tools';\r\n\r\nexport const memberTab = () => {\r\n    let LoadableComponent = Loadable({\r\n        loader: () => import('./tab'),\r\n        loading: Loading,\r\n        render(loaded, props) {\r\n            let tc = new loaded.TabController();\r\n            tc.start();\r\n            return <tc.render />;\r\n        }\r\n    });\r\n    return <LoadableComponent />;\r\n}\r\n","import * as React from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { Loading } from 'tonva-tools';\r\n\r\nexport const cartTab = () => {\r\n    let LoadableComponent = Loadable({\r\n        loader: () => import('./tab'),\r\n        loading: Loading\r\n    });\r\n    return <LoadableComponent />;\r\n}\r\n","import * as React from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { Loading } from 'tonva-tools';\r\n\r\nexport const meTab = () => {\r\n    let LoadableComponent = Loadable({\r\n        loader: () => import('./tab'),\r\n        loading: Loading\r\n    });\r\n    return <LoadableComponent />;\r\n}\r\n","import * as React from 'react';\nimport './App.css';\nimport { Page, Tabs, NavView, nav } from 'tonva-tools';\nimport { faceTabs } from 'face';\n\nclass App extends React.Component {\n  render() {\n      let page = <Page header={false}><Tabs tabs={faceTabs} /></Page>;\n      return <NavView onLogined={async () => nav.push(page)} />;\n  }\n}\n\nexport default App;","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString()\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === 'installed') {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log('New content is available; please refresh.');\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log('Content is cached for offline use.');\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type')!.indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport App from './App';\nimport './index.css';\nimport registerServiceWorker from './registerServiceWorker';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root') as HTMLElement\n);\nregisterServiceWorker();\n"],"sourceRoot":""}