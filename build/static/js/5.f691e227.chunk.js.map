{"version":3,"sources":["tonva-react-usql/controllers/map/vMain.tsx","tonva-react-usql/controllers/map/inputValues.tsx","tonva-react-usql/controllers/map/cMap.ts","tonva-react-usql/controllers/map/index.ts","tonva-react-usql/controllers/action/vActionMain.tsx","tonva-react-usql/controllers/action/cAction.ts","tonva-react-usql/controllers/action/index.ts","tonva-react-usql/controllers/pending/vPendingMain.tsx","tonva-react-usql/controllers/pending/cPending.ts","tonva-react-usql/controllers/pending/index.ts","tonva-react-usql/controllers/history/vHistoryMain.tsx","tonva-react-usql/controllers/history/cHistory.ts","tonva-react-usql/controllers/history/index.ts","../node_modules/util/util.js","../node_modules/util/support/isBufferBrowser.js","../node_modules/inherits/inherits_browser.js","face/member/tab.tsx","tonva-react-usql/controllers/CVEntity.tsx","tonva-react-usql/controllers/form/viewModel.tsx","tonva-react-usql/tools/jsonStringify.ts","tonva-react-usql/tools/tv.tsx","tonva-react-usql/tools/index.ts","tonva-react-usql/controllers/index.ts","tonva-react-usql/controllers/form/vBand.tsx","tonva-react-usql/controllers/form/vSubmit.tsx","tonva-react-usql/controllers/form/rule.ts","tonva-react-usql/controllers/form/vField/vField.tsx","tonva-react-usql/controllers/form/vField/vComputeField.tsx","tonva-react-usql/controllers/form/vArr.tsx","tonva-react-usql/controllers/form/vField/vTuidField.tsx","tonva-react-usql/controllers/form/bandsBuilder.ts","tonva-react-usql/controllers/form/vField/buildVmField.ts","tonva-react-usql/controllers/form/vForm.tsx","tonva-react-usql/controllers/form/index.ts","tonva-react-usql/entities/entity.ts","tonva-react-usql/entities/tuid.ts","tonva-react-usql/entities/action.ts","tonva-react-usql/entities/sheet.ts","tonva-react-usql/entities/query.ts","tonva-react-usql/entities/book.ts","tonva-react-usql/entities/history.ts","tonva-react-usql/entities/map.ts","tonva-react-usql/entities/pending.ts","tonva-react-usql/entities/entities.ts","tonva-react-usql/entities/index.ts","tonva-react-usql/controllers/link/cLink.tsx","tonva-react-usql/controllers/link/index.ts","tonva-react-usql/controllers/CApp.tsx","tonva-react-usql/controllers/icons.tsx","tonva-react-usql/controllers/ControllerUsq.ts","tonva-react-usql/centerApi.ts","tonva-react-usql/controllers/sheet/vMain.tsx","tonva-react-usql/controllers/sheet/vNew.tsx","tonva-react-usql/controllers/sheet/vSheetView.tsx","tonva-react-usql/controllers/sheet/vEdit.tsx","tonva-react-usql/controllers/sheet/vSheetAction.tsx","tonva-react-usql/controllers/sheet/vSchema.tsx","tonva-react-usql/controllers/sheet/vArchives.tsx","tonva-react-usql/controllers/sheet/vList.tsx","tonva-react-usql/controllers/sheet/vArchived.tsx","tonva-react-usql/controllers/sheet/vSheet.tsx","tonva-react-usql/controllers/sheet/vSaved.tsx","tonva-react-usql/controllers/sheet/vSheetProcessing.tsx","tonva-react-usql/controllers/sheet/cSheet.ts","tonva-react-usql/controllers/sheet/index.ts","tonva-react-usql/controllers/tuid/vTuidMain.tsx","tonva-react-usql/controllers/tuid/vTuidEdit.tsx","tonva-react-usql/controllers/tuid/vTuidSelect.tsx","tonva-react-usql/controllers/tuid/vTuidView.tsx","tonva-react-usql/controllers/tuid/vTuidInfo.tsx","tonva-react-usql/controllers/tuid/pageItems.ts","tonva-react-usql/controllers/tuid/vTuidList.tsx","tonva-react-usql/controllers/tuid/cTuid.ts","tonva-react-usql/controllers/tuid/index.tsx","tonva-react-usql/controllers/book/vBookMain.tsx","tonva-react-usql/controllers/book/cBook.ts","tonva-react-usql/controllers/usq/vUsq.tsx","tonva-react-usql/controllers/usq/cUsq.tsx","tonva-react-usql/controllers/usq/index.ts","tonva-react-usql/controllers/query/defaultRow.tsx","tonva-react-usql/controllers/query/vQueryMain.tsx","tonva-react-usql/controllers/query/vQuerySelect.tsx","tonva-react-usql/controllers/query/cQuery.ts","tonva-react-usql/controllers/query/index.ts"],"names":["vMain_VMapMain","CVEntity","[object Object]","this","itemRender","item","index","react","ItemRow","Object","index_module","add","remove","right","content","border","valuesView","tuid","box","children","isLeaf","keyIndex","values","keyUI","controller","keyUIs","keyContent","valuesContent","none","keyNone","isFrom","className","onClick","addClick","tonva_react_form","name","removeClick","undefined","viewModel","x","items","render","classnames_default","tools","param","openPage","view","tonva_tools","header","label","inputValues_VInputValues","onValuesSubmit","inputValues_awaiter","ceasePage","vForm","getValues","returnCall","createForm","openPageElement","cMap_MapItem","parent","mobx_module","array","deep","cMap_CMap","cMap_awaiter","keysLen","keyFields","length","keysLast","idx","keyField","kn","_tuid","searchParam","data","p","ki","id","searchOnKey","useId","idBox","boxId","arr1","entity","fields","ret","vCall","i","f","type","null","nullable","entities","actions","submit","rowIndex","findIndex","v","push","createItem","row","splice","removeCeased","cUsq","cTuidMain","Main","getLable","confirmDelete","res","lodash_default","a","template","confirm","map","v0","len","del","keys","schemaFrom","q","queries","all","query","clone","ui","retFields","returns","r","newItem","addItem","showVPage","VMapMain","key","val","n","_ownerField","cTuidSelect","callParam","call","getIdFromObj","__webpack_require__","d","__webpack_exports__","vActionMain_VActionMain","onSubmit","__awaiter","closePage","resultPage","mainPage","back","cAction_CAction","VActionMain","vPendingMain_VPendingMain","cPending_CPending","VPendingMain","vHistoryMain_VHistoryMain","cHistory_CHistory","VHistoryMain","global","process","formatRegExp","exports","format","isString","objects","arguments","inspect","join","args","str","String","replace","Number","JSON","stringify","_","isNull","isObject","deprecate","fn","msg","isUndefined","apply","noDeprecation","warned","throwDeprecation","Error","traceDeprecation","console","trace","error","debugEnviron","debugs","obj","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styleType","style","styles","value","recurseTimes","isFunction","constructor","prototype","primitive","simple","isNumber","formatPrimitive","visibleKeys","hash","forEach","arrayToHash","getOwnPropertyNames","isError","indexOf","formatError","isRegExp","RegExp","toString","isDate","Date","output","base","braces","isArray","toUTCString","l","hasOwnProperty","formatProperty","match","formatArray","pop","reduce","prev","cur","numLinesEst","reduceToSingleString","desc","getOwnPropertyDescriptor","get","set","split","line","substr","ar","Array","arg","re","objectToString","e","o","pad","debuglog","NODE_ENV","PUBLIC_URL","REACT_APP_CENTER_HOST","NODE_DEBUG","toUpperCase","test","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","string","date","regexp","isNullOrUndefined","isSymbol","isPrimitive","isBuffer","months","prop","log","time","getHours","getMinutes","getSeconds","getDate","getMonth","inherits","origin","module","copy","fill","readUInt8","create","ctor","superCtor","super_","enumerable","writable","configurable","TempCtor","tonvaApp","TabController","renderProductRow","discription","react__WEBPACK_IMPORTED_MODULE_0__","renderContent","tonva_react_form__WEBPACK_IMPORTED_MODULE_4__","mobx_react__WEBPACK_IMPORTED_MODULE_3__","tonva_tools__WEBPACK_IMPORTED_MODULE_5__","cApp","tonva_react_usql__WEBPACK_IMPORTED_MODULE_1__","load","getCUsq","tuidProduct","search","__decorate","mobx__WEBPACK_IMPORTED_MODULE_2__","CEntity","_ControllerUsq__WEBPACK_IMPORTED_MODULE_3__","super","setPrototypeOf","typeName","icon","_icons__WEBPACK_IMPORTED_MODULE_2__","_super","beforeStart","loadSchema","mode","options","buildFormOptions","_form__WEBPACK_IMPORTED_MODULE_1__","setValues","submitCaption","arrNewCaption","arrEditCaption","arrTitleNewButton","arrFields","new","formUI","form","arrs","inputs","buildInputs","buildFieldsInputs","arr","arrFieldInputs","field","fieldUI","select","buildSelect","buildContent","placeHolder","getTuidPlaceHolder","cSelectFrom","getValue","autoList","idFromItem","queryName","cQuerySelect","VEntity","tonva_tools__WEBPACK_IMPORTED_MODULE_0__","ViewModel","PureJSONContent","JSONContent","RowContent","mobx_react__WEBPACK_IMPORTED_MODULE_1__","_tools__WEBPACK_IMPORTED_MODULE_2__","vm","replacer","jsonStringify","Tv","tuidValue","nullUI","ttv","bi","templet","_$tuid","_$com","t","controllers","com","getTuidContent","valueFromId","boxIdContent","tv","_CApp__WEBPACK_IMPORTED_MODULE_0__","_form_viewModel__WEBPACK_IMPORTED_MODULE_10__","vBand_VBand","addRow","VFieldBand","vField","vBand_VArrBand","vArr","setAddRow","vBand_VSubmitBand","vSubmit","vSubmit_VSubmit","onClickSubmit","isOk","disabled","caption","Rule","RuleRequired","defy","trim","NaN","RuleNum","RuleInt","isNaN","isInteger","RuleMin","min","check","RuleMax","max","vField_VField","fieldRes","init","buildRules","rules","required","checkRules","errors","err","readonly","FormMode","edit","editable","vField_decorate","vField_VInputControl","renderError","ref","input","setInputValue","onFocus","onBlur","computeFields","onChange","evt","parse","currentTarget","setValue","redDot","inputGroup","suffix","ctrlCN","inputType","readOnly","placeholder","maxLength","onKeyPress","RedMark","color","position","left","top","VStringField","size","KeyCode_Neg","KeyCode_Dot","vField_VNumberControl","event","ch","charCode","extraChars","onKeyDot","onKeyNeg","preventDefault","text","_a","vField_VIntField","VDecField","VTextField","VDateTimeField","vComputeField_VComputeField","react_default","createElement","vArr_VArr","ownerForm","onEditRow","rowPage","vArr_awaiter","valueBoxs","onRowChanged","rowValues","$owner","list","reset","merge","renderItem","rowContent","assign","showRow","editRow","editSubmitCaption","internalAddRow","newSubmitCaption","button","paddingTop","paddingBottom","arrsRes","arrRes","newSubmit","editSubmit","arrUI","vForm_VForm","clear","buttonStyle","textAlign","paddingLeft","paddingRight","overflow","vTuidField_VTuidField","vTuidField_awaiter","showInfo","alert","bandsBuilder_BandsBuilder","layout","formItems","bandsOnFly","bandsFromLayout","bands","bandsFromFields","bandFromArr","bandFromField","formItem","rfn","resFromName","buildVField","vFields","vArrs","onFormSubmit","buildFormValues","buildBands","bandColl","bandsBuilder","build","band","getVFields","getVArr","getVSubmit","order","rows","slice","initValues","arrList","ctrl","fieldName","valueFromFieldName","propName","buildFieldValues","buildObservableValues","vForm_decorate","tab","ln","Entity","typeId","fieldMaps","sys","sName","jName","tvApi","usqApi","find","schema","setSchema","buildFieldTuid","buildArrFieldsTuid","getTuid","arrName","fieldArr","toLowerCase","an","packRow","packArr","charCodeAt","substring","result","escape","unpackRow","unpackArr","ch0","c","fLen","to","vals","maxCacheSize","tuid_Tuid","queue","waitingIds","cache","buildIdBoxer","BoxId","defineProperty","toJSON","idName","unique","from","_id","owner","delete","defer","util","has","cacheTuids","moveToHead","shift","proxied","cacheValue","api","getApiFrom","tuids","tuidIds","cacheTuidFieldValues","afterCacheId","tuidGet","divName","cacheFieldsInValue","arrValues","tuidDiv","getDiv","props","params","tuidSave","retId","inId","pageStart","pageSize","searchArr","tuidSearch","tuidArrGet","tuidArrSave","tuidArrPos","showTuid","TuidMain","divs","TuidDiv","cacheIds","usq","cUsqFrm","getImportUsq","retErrors","cUsqFrom","cTuidMainFromName","cTuidEditFromName","cTuidInfoFromName","cTuidSelectFromName","proxies","$proxy","action_Action","pack","action","sheet_Sheet","states","op","ops","appId","sheetSave","app","flow","state","sheetAction","brief","unpackSheet","flows","getSheet","getArchive","unpack","sheetArchive","sheetArchives","stateSheets","sheet_PageStateItems","stateSheetCount","s","count","sheet","getStateSheets","query_Query","isPaged","more","hasMore","startField","getTime","page","unpackReturns","$page","table","book_Book","queryApiName","history_History","map_Map","newAction","newQuery","pending_Pending","fieldDefaultValue","entities_Entities","sheets","books","maps","histories","pendings","tuidArr","actionArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","loadIds","clearCacheTimer","accesses","loadAccess","buildEntities","loadEntities","access","buildTuids","buildAccess","div","tuidUrl","cacheTimer","setTimeout","clearTimeout","proxyColl","newTuid","fromType","fromObj","book","history","pending","parts","usqId","newBook","newMap","newHistory","newSheet","newPending","buildSheet","mainFields","url","ownerField","af","Link","cLink_CLink","start","CApp","tonva_tools__WEBPACK_IMPORTED_MODULE_1__","cImportUsqs","cUsqCollection","renderRow","nick","tonva_react_form__WEBPACK_IMPORTED_MODULE_2__","onRowClick","unit","selectUnitPage","logout","appUnits","appOwner","appName","usqs","appUsq","usqOwner","usqName","urlDebug","ws","token","newCUsq","retError","CUsq","_usq__WEBPACK_IMPORTED_MODULE_3__","cUsqArr","apiName","VAppMain","main","loadUnits","document","location","startsWith","isProduction","logs","loadAppUnits","showUnsupport","loadUsqs","message","clearPrevPages","showMainPage","loaded","registerReceiveHandler","renderView","user","sheetTypeId","sheetId","getCUsqFromId","navSheet","_centerApi__WEBPACK_IMPORTED_MODULE_4__","userAppUnits","appContent","appPage","entityIcons","react__WEBPACK_IMPORTED_MODULE_0___default","tonva_react_form__WEBPACK_IMPORTED_MODULE_1__","fixWidth","ControllerUsq","centerApi","vMain_VSheetMain","newClick","schemaClick","archivesClick","sheetStateClick","renderState","badge","reactstrap_es","getStateLabel","statesCount","filter","isDev","vNew_VSheetNew","vNew_awaiter","valuesWithBox","onSave","leftFlowStyle","width","vSheetView_VSheetView","flowRow","preState","sheetView","removed","sheetData","vEdit_VSheetEdit","vEdit_awaiter","saveSheet","controllers_form","vSheetAction_VSheetAction","actionClick","vSheetAction_awaiter","acted","deleteClick","editClick","editSheet","actionButtons","startButtons","no","stateLabel","cn","getActionLabel","outline","backPage","vSchema_VSheetSchema","schemaStringify","vArchives_VArchives","archiveClick","vArchives_awaiter","processing","archiveRow","getArchives","vList_VSheetList","rowClick","vList_awaiter","onScrollBottom","pageStateItems","listRow","stateName","first","vArchived_VArchived","vSheet_VSheet","vSaved_VSheetSaved","restart","vSaved_awaiter","buttons","vSheetProcessing_VSheetProcessing","cSheet_CSheet","cSheet_awaiter","showSaved","loadStateSheetCount","createPageStateItems","VSheetMain","body","onSheet","me","$","sheetActPreState","sheetActState","changeStateCount","curState","delta","stateCount","VSheetNew","sheetNew","VSheetSaved","sheetSaved","VSheetEdit","sheetEdit","VSheetSchema","VArchives","VArchived","VSheetList","VSheetAction","VSheetProcessing","showArchived","showAction","showProcessing","onEvent","getSheetData","$type","inBrief","getArchived","getStateUI","actionName","sheetTitle","disc","save","vTuidMain_VTuidMain","onNew","onList","onSearch","link","newButton","proxyLinks","entityRender","entityClick","vTuidEdit_VTuidEdit","next","vTuidEdit_awaiter","finish","u","setError","isCalling","editView","vTuidSelect_VTuidSelect","mainView","initKey","onSearchMain","PageItems","renderMainRow","clickMainRow","before","vTuidSelect_awaiter","searchMain","mainRowContent","showDiv","divView","renderDivRow","clickDivRow","divRowContent","showMain","ownerValue","divItems","getDivItems","vTuidView_VTuidView","vTuidView_awaiter","buildForm","vTuidInfo_VTuidInfo","pageItems_TuidPageItems","vTuidList_VTuidMainListBase","vTuidList_awaiter","clickRow","callOnSelected","rowKey","ownerTop","ownerObj","ownerId","onSelected","VTuidMainList","cTuid_CTuid","buildPageItems","cTuid_CTuidMain","linkFromName","cFrom","VTuidMain","VTuidEdit","VTuidList","itemChanged","cTuidInfo","cTuid_CTuidInfo","CTuidEdit","CTuidList","cTuid_CTuidSelect","VTuidSelect","VTuidInfo","vBookMain_VBookMain","cBook_CBook","VBookMain","vUsq_VUsq","isSysVisible","linkItem","cLink","lists","tuidLinks","mapLinks","sheetLinks","actionLinks","queryLinks","bookLinks","historyLinks","pendingLinks","Fragment","isVisible","controllers_link","cMap","cSheet","cAction","cQuery","cBook","cHistory","cPending","lowerPropertyName","cUsq_CUsq","schemaLoaded","CTuidMain","controllers_tuid","CTuidSelect","CTuidInfo","CQuery","CQuerySelect","CMap","CAction","CSheet","CBook","CHistory","controllers_history","CPending","acc","baseUrl","loadEntites","g","collection","j","warn","tuidPlaceHolder","en","sheetFromTypeId","startSheet","entityName","cTuidEdit","entityType","cFromName","tUI","cEntity","getUI","inputContent","VUsq","DefaultRow","vQueryMain_VQueryMain","resetPage","loadPage","replacePage","pageResult","queryResult","again","renderExtra","rightClose","queryRow","vQuerySelect_VQuerySelect","vQuerySelect_awaiter","selectRow","vQuerySelect_QueryPageItems","cQuery_CQueryBase","cQuery_CQuery","VQueryMain","cQuery_CQuerySelect","VQuerySelect"],"mappings":"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","file":"static/js/5.f691e227.chunk.js","sourcesContent":["import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport className from 'classnames';\r\nimport { List, LMR, FA } from 'tonva-react-form';\r\nimport { Page, nav } from 'tonva-tools';\r\nimport { tv } from '../../tools';\r\nimport { Map } from '../../entities';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CMap, MapItem, MapKey, MapUI } from './cMap';\r\nimport { PureJSONContent } from '../form/viewModel';\r\n\r\nexport class VMapMain extends VEntity<Map, MapUI, CMap> {\r\n    private isFrom: boolean;\r\n\r\n    async showEntry(param?:any) {\r\n        this.isFrom = this.controller.isFrom;\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    itemRender = (item:MapItem, index:number) => {\r\n        return <this.ItemRow item={item} />;\r\n    }\r\n\r\n    private ItemRow = observer(({item}: {item:MapItem}) => {\r\n        let {tuid, box, children, isLeaf, keyIndex, values} = item;\r\n        let keyUI = this.controller.keyUIs[keyIndex];\r\n        let {content:keyContent, valuesContent, none:keyNone} = keyUI;\r\n        let add, remove;\r\n        if (this.isFrom === false) {\r\n            add = <button className=\"btn btn-link btn-sm\" onClick={()=>this.controller.addClick(item)}>\r\n                <FA name=\"plus\" />\r\n            </button>;\r\n            remove = <button className=\"btn btn-link btn-sm\" onClick={()=>this.controller.removeClick(item)}>\r\n                <FA className=\"text-info\" name=\"trash\" />\r\n            </button>;\r\n        }\r\n        let right;\r\n        if (isLeaf === false) {\r\n            if (keyIndex === 0)\r\n                right = add;\r\n            else\r\n                right = <>{remove} &nbsp; {add}</>;\r\n        }\r\n        else if (keyIndex > 0) {\r\n            right = remove;\r\n        }\r\n        let content, border, valuesView;\r\n        if (isLeaf === true) {\r\n            content = undefined; //<div className=\"ml-5\">leaf</div>;\r\n            if (values) {\r\n                //valuesView = null; // 现在不显示values content了\r\n                valuesView = (valuesContent || PureJSONContent)(values, this.x);\r\n            }\r\n        }\r\n        else {\r\n            border = \"border-bottom\";\r\n            let none = keyNone && keyNone(this.x);\r\n            content = <List \r\n                className=\"ml-4\" \r\n                items={children} \r\n                item={{onClick:undefined, render:this.itemRender}}\r\n                none={none} />\r\n        }\r\n        return <div className=\"d-flex flex-column\">\r\n            <LMR className={className('px-3', 'py-2', border)} \r\n                right={right}\r\n            >\r\n                <div className=\"py-1\">{tv(box, keyContent, this.x)}</div>\r\n                <div className=\"py-1 font-weight-bold\">{valuesView}</div>\r\n            </LMR>\r\n            {content}\r\n        </div>;\r\n    });\r\n\r\n    protected get view() { return () => <Page header={this.label}>\r\n            <List items={this.controller.items} item={{className:'my-2', onClick:undefined, render:this.itemRender}} />\r\n        </Page>\r\n    };\r\n}\r\n","import * as React from 'react';\r\nimport { VEntity } from \"../CVEntity\";\r\nimport { MapUI, CMap } from \"./cMap\";\r\nimport { Map } from \"../../entities\";\r\nimport { Page } from \"tonva-tools\";\r\nimport { VForm } from '../form';\r\n\r\nexport class VInputValues extends VEntity<Map, MapUI, CMap> {\r\n    private vForm: VForm;\r\n\r\n    async showEntry(param?:any) {\r\n        this.vForm = this.createForm(this.onValuesSubmit);\r\n        this.openPageElement(<this.view />);\r\n    }\r\n\r\n    private onValuesSubmit = async () => {\r\n        this.ceasePage();\r\n        let values = this.vForm.getValues();\r\n        this.returnCall(values);\r\n    }\r\n\r\n    private view = () => {\r\n        return <Page>\r\n            {this.vForm.render()}\r\n        </Page>\r\n    }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\nimport { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { Map, Tuid, BoxId, Field, TuidMain, fieldDefaultValue } from \"../../entities\";\r\nimport { VMapMain } from \"./vMain\";\r\nimport { observable } from \"mobx\";\r\nimport { PureJSONContent } from '../form/viewModel';\r\nimport { VInputValues } from './inputValues';\r\n\r\nexport interface MapKey {\r\n    content: (values, x?:any) => JSX.Element;\r\n    valuesContent?: (values, x?:any) => JSX.Element;\r\n    none?: (x:any)=>string;\r\n}\r\n\r\nexport interface MapUI extends EntityUI {\r\n    CMap?: typeof CMap;\r\n    keys?: MapKey[],\r\n}\r\n\r\nexport class MapItem {\r\n    parent: MapItem;\r\n    tuid: Tuid;\r\n    box: BoxId;\r\n    isLeaf: boolean;\r\n    keyIndex:number;\r\n    children: MapItem[] = observable.array([], {deep: true});\r\n    values: any;\r\n    constructor(parent:MapItem, tuid:Tuid, box:BoxId, keyIndex:number) {\r\n        this.parent = parent;\r\n        this.tuid = tuid;\r\n        this.box = box;\r\n        this.keyIndex = keyIndex;\r\n        this.isLeaf = false;\r\n    }\r\n}\r\n\r\nexport class CMap extends CEntity<Map, MapUI> {\r\n    isFrom: boolean;\r\n    items:MapItem[];\r\n    keyFields: Field[];\r\n    keyUIs: MapKey[];\r\n\r\n    protected async internalStart() {\r\n        let {keys, schemaFrom} = this.entity;\r\n        this.isFrom = schemaFrom !== undefined;\r\n        let q = this.entity.queries.all;\r\n        let result = await q.query({});\r\n        //let data = await this.entity.unpackReturns(res);\r\n        let ret = result.ret;\r\n        let keysLen = keys.length;\r\n        this.keyUIs = _.clone(this.ui.keys || []);\r\n        this.keyFields = [];\r\n        let retFields = q.returns[0].fields;\r\n        for (let i=0; i<keysLen; i++) {\r\n            this.keyFields.push(retFields[i]);\r\n            if (i >= this.keyUIs.length) {\r\n                this.keyUIs.push({\r\n                    content: PureJSONContent,\r\n                });\r\n            }\r\n        }\r\n        this.items = observable([]);\r\n        let item:MapItem = undefined;\r\n        for (let r of ret) {\r\n            let newItem = this.addItem(item, r);\r\n            if (newItem !== undefined) {\r\n                this.items.push(newItem);\r\n                item = newItem;\r\n            }\r\n        }\r\n\r\n        await this.showVPage(this.VMapMain);\r\n    }\r\n\r\n    private createItem(parent:MapItem, tuid:Tuid, box:BoxId, keyIndex:number, values?:any) {\r\n        let item = new MapItem(parent, tuid, box, keyIndex);\r\n        if (keyIndex === this.keyFields.length - 1) {\r\n            item.isLeaf = true;\r\n            item.values = values;\r\n        }\r\n        return item;\r\n    }\r\n\r\n    addItem(item:MapItem, row:any):MapItem {\r\n        let ret:MapItem = undefined;\r\n        let keysLen = this.keyFields.length;\r\n        let p = item;\r\n        for (let i=0;i<keysLen;i++) {\r\n            let key = this.keyFields[i];\r\n            let {name} = key;\r\n            let tuid = key._tuid;\r\n            let val:BoxId = row[name];\r\n            if (val === undefined) break;\r\n            let {id} = val;\r\n            if (i === 0) {\r\n                if (id === 0) continue;\r\n                if (p === undefined || p.box.id !== id) {\r\n                    ret = p = this.createItem(undefined, tuid, val, i, row);\r\n                }\r\n                continue;\r\n            }\r\n            let {children, box} = p;\r\n            let len = children.length;\r\n            if (len > 0) {\r\n                let n = children[len-1];\r\n                if (n.box.id === id) {\r\n                    p = n;\r\n                    continue;\r\n                }\r\n            }\r\n            if (id > 0) {\r\n                children.push(p = this.createItem(p, tuid, val, i, row));\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async searchOnKey(keyField:Field, param):Promise<number> {\r\n        let {_tuid, _ownerField} = keyField;\r\n        let cTuidSelect = this.cUsq.cTuidSelect(_tuid);\r\n        let callParam = param;\r\n        if (_ownerField !== undefined) {\r\n            callParam = param[_ownerField.name];\r\n            if (typeof callParam === 'object') {\r\n                callParam = callParam.id;\r\n            }\r\n        }\r\n        let ret = await cTuidSelect.call(callParam);\r\n        return _tuid.getIdFromObj(ret);\r\n    }\r\n\r\n    addClick = async(item:MapItem) => {\r\n        let {keyIndex, children} = item;\r\n        let keysLen = this.keyFields.length;\r\n        let keysLast = keysLen-1;\r\n        let idx = keyIndex + 1;\r\n        if (idx >= keysLen) return;\r\n        let keyField = this.keyFields[idx];\r\n        let kn = keyField.name;\r\n        let tuid = keyField._tuid;\r\n        let searchParam = {} as any;\r\n        let data = {} as any;\r\n        for (let p=item;p!==undefined;p=p.parent) {\r\n            let {keyIndex:ki, box} = p;\r\n            let kn = this.keyFields[ki].name;\r\n            //searchParam[kn] = data['_' + kn] = box.id;\r\n            searchParam[kn] = data[kn] = box.id;\r\n        }\r\n\r\n        let id = await this.searchOnKey(keyField, searchParam);\r\n        if (id === undefined || id <= 0) return;\r\n        tuid.useId(id);\r\n        let idBox = tuid.boxId(id);\r\n        let arr1 = {} as any;\r\n        let values:any = {};\r\n        if (keyIndex+1===keysLast) {\r\n            tuid.useId(id);\r\n            //values[kn] = arr1['_' + kn] = idBox;\r\n            values[kn] = arr1[kn] = idBox;\r\n            if (this.entity.fields.length > 0) {\r\n                let ret = await this.vCall(VInputValues, data);\r\n                for (let i in ret) {\r\n                    //values[i] = arr1['_' + i] = ret[i];\r\n                    values[i] = arr1[i] = ret[i];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            //values[kn] = data['_' + kn] = idBox;\r\n            values[kn] = data[kn] = idBox;\r\n            for (let i=idx+1;i<keysLast;i++) {\r\n                //data['_' + this.keyFields[i].name] = 0;\r\n                data[this.keyFields[i].name] = 0;\r\n            }\r\n            // 填map的key field 0 值\r\n            //arr1['_' + this.keyFields[keysLast].name] = 0;\r\n            arr1[this.keyFields[keysLast].name] = 0;\r\n            let {fields} = this.entity;\r\n            for (let f of fields) {\r\n                let {name, type, null:nullable} = f;\r\n                if (!(nullable === true)) {\r\n                    //arr1['_' + f.name] = fieldDefaultValue(type);\r\n                    arr1[f.name] = fieldDefaultValue(type);\r\n                }\r\n            }\r\n        }\r\n        data.arr1 = [arr1];\r\n        await this.entity.actions.add.submit(data);\r\n        let rowIndex = children.findIndex(v => v.box.id === id);\r\n        if (rowIndex < 0) {\r\n            children.push(this.createItem(item, tuid, idBox, idx, values));\r\n        }\r\n        else {\r\n            let {fields} = this.entity;\r\n            if (fields !== undefined && fields.length > 0) {\r\n                let row = children[rowIndex];\r\n                children.splice(rowIndex, 1);\r\n                row.values = values;\r\n                /*\r\n                for (let f of fields) {\r\n                    let {name:fn} = f;\r\n                    row.values[fn] = values[fn];\r\n                }*/\r\n                children.splice(rowIndex, 0, row);\r\n            }\r\n        }\r\n        this.removeCeased();\r\n    }\r\n\r\n    removeClick = async(item:MapItem) => {\r\n        let keyField = this.keyFields[item.keyIndex];\r\n        let tuid = keyField._tuid;\r\n        let cTuidMain = this.cUsq.cTuidMain(tuid.Main);\r\n        let label = cTuidMain.getLable(tuid);\r\n        let confirmDelete:_.TemplateExecutor = \r\n            this.res.confirmDelete \r\n            || _.template('do you really want to remove ${label}?');\r\n        if (confirm(confirmDelete({label:label})) === false) return;\r\n        let map:Map = this.entity;\r\n        let data = {} as any;\r\n        let arr1 = data['arr1'] = [];\r\n        let v0 = {} as any;\r\n        arr1.push(v0);\r\n        for (let p=item; p!==undefined;p=p.parent) {\r\n            let ki=p.keyIndex;\r\n            //v0['_'+this.keyFields[ki].name] = p.box.id;\r\n            v0[this.keyFields[ki].name] = p.box.id;\r\n        }\r\n        let len = this.keyFields.length;\r\n        for (let i=item.keyIndex+1; i<len; i++) {\r\n            let k = this.keyFields[i];\r\n            //v0['_'+k.name] = -1;\r\n            v0[k.name] = -1;\r\n        }\r\n        await map.actions.del.submit(data);\r\n        let children = item.parent.children;\r\n        let index = children.findIndex(v => v === item);\r\n        if (index >= 0) children.splice(index, 1);\r\n    }\r\n\r\n    protected get VMapMain():typeof VMapMain {return VMapMain}\r\n}\r\n","export * from './cMap';\r\nexport * from './vMain';\r\n","import * as React from 'react';\r\nimport { VPage, Page } from 'tonva-tools';\r\nimport { jsonStringify } from '../../tools';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CAction, ActionUI } from './cAction';\r\nimport { Action } from '../../entities';\r\n\r\nexport class VActionMain extends VEntity<Action, ActionUI, CAction> {\r\n    protected vForm: VForm;\r\n    protected returns: any;\r\n\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.vForm = this.createForm(this.onSubmit, param);\r\n        this.openPage(this.mainPage);\r\n    }\r\n\r\n    private onSubmit = async () => {\r\n        let values = this.vForm.getValues();\r\n        this.returns = await this.controller.submit(values);\r\n        this.closePage();\r\n        this.openPage(this.resultPage);\r\n    }\r\n\r\n    protected mainPage = () => {\r\n        let {label} = this.controller;\r\n        return <Page header={label}>\r\n            {this.vForm.render('mx-3 my-2')}\r\n        </Page>;\r\n    }\r\n\r\n    protected resultPage = () => {\r\n        let {label} = this.controller;\r\n        return <Page header={label} back=\"close\">\r\n            完成！\r\n            <pre>\r\n                {jsonStringify(this.returns)}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}\r\n","import { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { Action } from \"../../entities\";\r\nimport { VActionMain } from \"./vActionMain\";\r\n\r\nexport interface ActionUI extends EntityUI {\r\n    CAction?: typeof CAction;\r\n    //main: typeof VActionMain,\r\n}\r\n\r\nexport class CAction extends CEntity<Action, ActionUI> {\r\n    protected async internalStart() {\r\n        await this.showVPage(this.VActionMain);\r\n    }\r\n\r\n    protected get VActionMain():typeof VActionMain {return VActionMain}\r\n\r\n    async submit(values:any) {\r\n        return this.entity.submit(values);\r\n    }\r\n}\r\n","export * from './cAction';\r\nexport * from './vActionMain';\r\n","import * as React from 'react';\r\nimport { TuidMain, Pending, Entity } from '../../entities';\r\nimport { Page } from 'tonva-tools';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CPending, PendingUI } from './cPending';\r\n\r\nexport class VPendingMain extends VEntity<Pending, PendingUI, CPending> {\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        pending\r\n    </Page>;\r\n}\r\n","import { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { Pending } from \"../../entities\";\r\nimport { VPendingMain } from \"./vPendingMain\";\r\n\r\nexport interface PendingUI extends EntityUI {\r\n    CPending?: typeof CPending;\r\n    main: typeof VPendingMain,\r\n}\r\n\r\nexport class CPending extends CEntity<Pending, PendingUI> {\r\n    protected async internalStart() {\r\n        await this.showVPage(this.VPendingMain);\r\n    }\r\n\r\n    protected get VPendingMain():typeof VPendingMain {return VPendingMain}\r\n}\r\n","export * from './cPending';\r\nexport * from './vPendingMain';\r\n","import * as React from 'react';\r\nimport { TuidMain, History, Entity } from '../../entities';\r\nimport { Page } from 'tonva-tools';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CHistory, HistoryUI } from './cHistory';\r\n\r\nexport class VHistoryMain extends VEntity<History, HistoryUI, CHistory> {\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        History\r\n    </Page>;\r\n}\r\n","import { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { History } from \"../../entities\";\r\nimport { VHistoryMain } from \"./vHistoryMain\";\r\n\r\nexport interface HistoryUI extends EntityUI {\r\n    CHistory?: typeof CHistory;\r\n    main: typeof VHistoryMain,\r\n}\r\n\r\nexport class CHistory extends CEntity<History, HistoryUI> {\r\n    protected async internalStart() {\r\n        await this.showVPage(this.VHistoryMain);\r\n    }\r\n\r\n    protected get VHistoryMain():typeof VHistoryMain {return VHistoryMain}\r\n}\r\n","export * from './cHistory';\r\nexport * from './vHistoryMain';\r\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\nvar formatRegExp = /%[sdj%]/g;\n\nexports.format = function (f) {\n  if (!isString(f)) {\n    var objects = [];\n\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function (x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n\n    switch (x) {\n      case '%s':\n        return String(args[i++]);\n\n      case '%d':\n        return Number(args[i++]);\n\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n\n      default:\n        return x;\n    }\n  });\n\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n\n  return str;\n}; // Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\n\n\nexports.deprecate = function (fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function () {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n\n      warned = true;\n    }\n\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\nvar debugs = {};\nvar debugEnviron;\n\nexports.debuglog = function (set) {\n  if (isUndefined(debugEnviron)) debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n\n      debugs[set] = function () {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function () {};\n    }\n  }\n\n  return debugs[set];\n};\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n\n/* legacy: obj, showHidden, depth, colors*/\n\n\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  }; // legacy...\n\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  } // set default options\n\n\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\n\nexports.inspect = inspect; // http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\n\ninspect.colors = {\n  'bold': [1, 22],\n  'italic': [3, 23],\n  'underline': [4, 24],\n  'inverse': [7, 27],\n  'white': [37, 39],\n  'grey': [90, 39],\n  'black': [30, 39],\n  'blue': [34, 39],\n  'cyan': [36, 39],\n  'green': [32, 39],\n  'magenta': [35, 39],\n  'red': [31, 39],\n  'yellow': [33, 39]\n}; // Don't use 'blue' not visible on cmd.exe\n\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return \"\\x1B[\" + inspect.colors[style][0] + 'm' + str + \"\\x1B[\" + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\nfunction arrayToHash(array) {\n  var hash = {};\n  array.forEach(function (val, idx) {\n    hash[val] = true;\n  });\n  return hash;\n}\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect && value && isFunction(value.inspect) && // Filter out the util module, it's inspect function is special\n  value.inspect !== exports.inspect && // Also filter out any prototype objects using the circular check.\n  !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n\n    return ret;\n  } // Primitive types cannot have properties\n\n\n  var primitive = formatPrimitive(ctx, value);\n\n  if (primitive) {\n    return primitive;\n  } // Look up the keys of the object.\n\n\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  } // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n\n\n  if (isError(value) && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  } // Some type of object without properties can be shortcutted.\n\n\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '',\n      array = false,\n      braces = ['{', '}']; // Make Array say that they are Array\n\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  } // Make functions say that they are functions\n\n\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  } // Make RegExps say that they are RegExps\n\n\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  } // Make dates with properties first say the date\n\n\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  } // Make error with message first say the error\n\n\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n  var output;\n\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function (key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n  return reduceToSingleString(output, base, braces);\n}\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value)) return ctx.stylize('undefined', 'undefined');\n\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '').replace(/'/g, \"\\\\'\").replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n\n  if (isNumber(value)) return ctx.stylize('' + value, 'number');\n  if (isBoolean(value)) return ctx.stylize('' + value, 'boolean'); // For some reason typeof null is \"object\", so special case here.\n\n  if (isNull(value)) return ctx.stylize('null', 'null');\n}\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n\n  keys.forEach(function (key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, true));\n    }\n  });\n  return output;\n}\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || {\n    value: value[key]\n  };\n\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function (line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function (line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n\n    name = JSON.stringify('' + key);\n\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\").replace(/\\\\\"/g, '\"').replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function (prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] + (base === '' ? '' : base + '\\n ') + ' ' + output.join(',\\n  ') + ' ' + braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n} // NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\n\n\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\n\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\n\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\n\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\n\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\n\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\n\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\n\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\n\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) && (objectToString(e) === '[object Error]' || e instanceof Error);\n}\n\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null || typeof arg === 'boolean' || typeof arg === 'number' || typeof arg === 'string' || typeof arg === 'symbol' || // ES6 symbol\n  typeof arg === 'undefined';\n}\n\nexports.isPrimitive = isPrimitive;\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']; // 26 Feb 16:19:34\n\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n} // log is just a thin wrapper to console.log that prepends a timestamp\n\n\nexports.log = function () {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\n\n\nexports.inherits = require('inherits');\n\nexports._extend = function (origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n  var keys = Object.keys(add);\n  var i = keys.length;\n\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object' && typeof arg.copy === 'function' && typeof arg.fill === 'function' && typeof arg.readUInt8 === 'function';\n};","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor;\n\n    var TempCtor = function TempCtor() {};\n\n    TempCtor.prototype = superCtor.prototype;\n    ctor.prototype = new TempCtor();\n    ctor.prototype.constructor = ctor;\n  };\n}","import * as React from 'react';\r\nimport { CApp, CUsq, TuidMain } from 'tonva-react-usql';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { List } from 'tonva-react-form';\r\nimport { Loading } from 'tonva-tools';\r\n\r\nconst tonvaApp = 'JKDev/jkOrder';\r\n\r\nexport class TabController {\r\n    private cApp: CApp;\r\n    private cUsq: CUsq;\r\n    private tuidProduct: TuidMain;\r\n\r\n    @observable private items:any[];\r\n\r\n    async start() {\r\n        console.log('start()');\r\n        this.cApp = new CApp(tonvaApp);\r\n        await this.cApp.load();\r\n        console.log('await this.cApp.load();');\r\n        this.cUsq = this.cApp.getCUsq('JKDev/jkOrder');\r\n        this.tuidProduct = this.cUsq.tuid('product');\r\n        let ret = await this.tuidProduct.search('', 0, 100);\r\n        this.items = ret;\r\n    }\r\n\r\n    private renderProductRow = (row:any, index:number) => {\r\n        let {id, discription} = row;\r\n        return <div>{id}: {discription}</div>;\r\n    }\r\n\r\n    private renderContent = () => {\r\n        return <div>product loaded\r\n            {this.items.length}\r\n            <List items={this.items} item={{render: this.renderProductRow, key:(item)=>item.id}} />\r\n        </div>\r\n    }\r\n\r\n    render = observer(() => {\r\n        return this.items === undefined? <Loading /> : this.renderContent();\r\n    });\r\n}\r\n\r\n/*\r\nexport const test = (cApp: CJkOrderApp, productList:any[]) => {\r\n    return <div>test {} {}</div>;\r\n}\r\nlet cApp = new CJkOrderApp(27);\r\n\r\ncApp: async () => await cApp.load(),\r\nloadProduct: async () => {\r\n    return ret;\r\n}\r\n\r\ninterface MemberTabProps {\r\n    cApp: CJkOrderApp;\r\n}\r\n\r\nexport default class MemberTab extends React.Component<MemberTabProps> {\r\n    private cUsq: CUsq;\r\n    constructor(props: MemberTabProps) {\r\n        super(props);\r\n        let {cApp} = props;\r\n        this.cUsq = cApp.getCUsq('JKDev/jkOrder');\r\n        let s = null;\r\n    }\r\n\r\n    render() {\r\n        return this.props.cApp.renderMain();\r\n    }\r\n}\r\n\r\n/*\r\nclass CTuidController extends Controller {\r\n    protected cUsq: CUsq;\r\n    protected cTuid: CTuidMain;\r\n    constructor(cUsq: CUsq, name: string) {\r\n        super({});\r\n    }\r\n    protected async internalStart() {\r\n    }\r\n}\r\n\r\nclass CProductList extends Controller {\r\n    protected product: CTuidMain;\r\n\r\n    constructor(cUsq: CUsq) {\r\n        super({});\r\n        this.product = product;\r\n    }\r\n\r\n    protected async internalStart() {\r\n    }\r\n\r\n\r\n}\r\n*/\r\n\r\n\r\n","import * as React from 'react';\r\nimport { Controller, VPage, View } from 'tonva-tools';\r\nimport { Entity, Field, TuidMain } from '../entities';\r\nimport { CUsq } from './usq/cUsq';\r\nimport { VForm, FieldInputs, FieldCall, FormOptions, FormMode } from './form';\r\nimport { CQuerySelect } from './query';\r\nimport { FormUI, FieldTuidUI } from './formUI';\r\nimport { entityIcons } from './icons';\r\nimport { ControllerUsq } from './ControllerUsq';\r\n\r\nexport interface EntityUI {\r\n    form?: FormUI;\r\n}\r\n\r\nexport abstract class CEntity<T extends Entity, UI extends EntityUI> extends ControllerUsq {\r\n    constructor(cUsq: CUsq, entity: T, ui: UI, res: any) {\r\n        super(cUsq, res);\r\n        Object.setPrototypeOf(this.x, cUsq.x);\r\n        let {name, typeName} = entity;\r\n        this.entity = entity;\r\n        this.ui = ui; // || entityUI.ui;\r\n        this.label = this.res.label || name;\r\n        this.icon = entityIcons[typeName];\r\n    }\r\n    readonly entity: T;\r\n    readonly ui: UI;\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        if (await super.beforeStart() === false) return false;\r\n        await this.entity.loadSchema();\r\n        return true;\r\n    }\r\n\r\n    createForm(onSubmit:()=>Promise<void>, values?:any, mode?:FormMode) {\r\n        let options = this.buildFormOptions(mode);\r\n        let ret = new VForm(options, onSubmit);\r\n        ret.setValues(values);\r\n        return ret;\r\n    }\r\n\r\n    private buildFormOptions(mode?:FormMode):FormOptions {\r\n        let {fields, arrFields} = this.entity;\r\n        let none, submitCaption, arrNewCaption, arrEditCaption, arrTitleNewButton;\r\n        if (this.res !== undefined) {\r\n            none = this.res['none'];\r\n            submitCaption = this.res['submit'];\r\n            arrNewCaption = this.res['arrNew'];\r\n            arrEditCaption = this.res['arrEdit'];\r\n            arrTitleNewButton = this.res['arrTitleNewButton'];\r\n        }\r\n        if (none === undefined) {\r\n            none = this.cUsq.res['none'] || 'none';\r\n        }\r\n        if (submitCaption === undefined)\r\n            submitCaption = this.cUsq.res['submit'] || 'Submit';\r\n        if (arrNewCaption === undefined)\r\n            arrNewCaption = this.cUsq.res['arrNew'] || 'New';\r\n        if (arrEditCaption === undefined)\r\n            arrEditCaption = this.cUsq.res['arrEdit'] || 'Edit';\r\n        if (arrTitleNewButton === undefined)\r\n        arrTitleNewButton = this.cUsq.res['arrTitleNewButton'];\r\n        if (mode === undefined) mode = FormMode.new;\r\n        let formUI = this.ui.form;\r\n        let ret:FormOptions = {\r\n            fields: fields,\r\n            arrs: arrFields,\r\n            ui: formUI,\r\n            res: this.res || {},\r\n            inputs: this.buildInputs(formUI),\r\n            none: none,\r\n            submitCaption: submitCaption,\r\n            arrNewCaption: arrNewCaption,\r\n            arrEditCaption: arrEditCaption,\r\n            arrTitleNewButton: arrTitleNewButton,\r\n            mode: mode,\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private buildInputs(formUI: FormUI):FieldInputs {\r\n        let {fields, arrFields} = this.entity;\r\n        let ret:FieldInputs = {};\r\n        this.buildFieldsInputs(ret, fields, undefined, formUI);\r\n        if (arrFields !== undefined) {\r\n            for (let arr of arrFields) {\r\n                let {name, fields} = arr;\r\n                let items = formUI && formUI.items;\r\n                this.buildFieldsInputs(ret, fields, name, items && items[name] as FormUI);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private buildFieldsInputs(ret:FieldInputs, fields:Field[], arr:string, formUI: FormUI) {\r\n        if (arr !== undefined) {\r\n            let arrFieldInputs = ret[arr];\r\n            if (arrFieldInputs === undefined) {\r\n                ret[arr] = arrFieldInputs = {};\r\n                ret = arrFieldInputs;\r\n            }\r\n        }\r\n        for (let field of fields) {\r\n            let {name, _tuid} = field;\r\n            if (_tuid === undefined) continue;\r\n            let fieldUI = formUI && formUI.items && formUI.items[name] as FieldTuidUI;\r\n            ret[name] = {\r\n                select: this.buildSelect(field, arr, fieldUI),\r\n                content: this.buildContent(field, arr),\r\n                placeHolder: this.cUsq.getTuidPlaceHolder(_tuid),\r\n            };\r\n        }\r\n    }\r\n\r\n    protected buildSelect(field:Field, arr:string, fieldUI: FieldTuidUI):FieldCall {\r\n        return async (form:VForm, field:Field, values:any):Promise<any> => {\r\n            let {_tuid, _ownerField} = field;\r\n            let cTuidSelect = await (_tuid as TuidMain).cSelectFrom(); // this.cUsq.cTuidSelect(_tuid);\r\n            let param:any = undefined;\r\n            if (_ownerField !== undefined) param = form.getValue(_ownerField.name);\r\n            if (fieldUI && fieldUI.autoList === true) {\r\n                console.log('select search set param=empty string');\r\n                param = '';\r\n            }\r\n            let ret = await cTuidSelect.call(param);\r\n            cTuidSelect.removeCeased(); // 清除已经废弃的顶部页面\r\n            if (ret === undefined) return undefined;\r\n            let id = cTuidSelect.idFromItem(ret);\r\n            _tuid.useId(id);\r\n            return id;\r\n        };\r\n    }\r\n\r\n    protected buildContent(field:Field, arr:string): React.StatelessComponent<any> {\r\n        return;\r\n    }\r\n\r\n    cQuerySelect(queryName:string):CQuerySelect {\r\n        return this.cUsq.cQuerySelect(queryName);\r\n    }\r\n}\r\n\r\nexport abstract class VEntity<T extends Entity, UI extends EntityUI, C extends CEntity<T, UI>> extends VPage<C> {\r\n    protected readonly entity: T;\r\n    protected readonly ui: UI;\r\n    constructor(controller: C) {\r\n        super(controller);\r\n        this.entity = controller.entity;\r\n        this.ui = controller.ui;\r\n    }\r\n\r\n    get label():string {return this.controller.label}\r\n\r\n    //private _form_$: VForm;\r\n    protected createForm(onSubmit:()=>Promise<void>, values?:any, mode?:FormMode): VForm {\r\n        //if (this._form_$ !== undefined) return this._form_$;\r\n        return this.controller.createForm(onSubmit, values, mode);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { jsonStringify } from '../../tools';\r\n\r\nexport type TypeViewModel = typeof ViewModel;\r\nexport type TypeView = React.StatelessComponent<{vm: ViewModel, className?:string|string[]}>;\r\nexport type TypeContent = React.StatelessComponent<any>;\r\n\r\nexport abstract class ViewModel {\r\n    protected abstract get view(): TypeView;\r\n    render(className?:string|string[]):JSX.Element {\r\n        if (this.view === undefined) return <div>??? viewModel 必须定义 view ???</div>\r\n        return React.createElement(this.view, {vm: this, className:className});\r\n    }\r\n}\r\n\r\nexport const PureJSONContent = (values, x?:any) => <>content: {jsonStringify(values)}</>;\r\nexport const JSONContent = observer(PureJSONContent);\r\nexport const RowContent = \r\n    (values) => <div className=\"px-3 py-2\">{jsonStringify(values)}</div>\r\n;\r\n","function replacer(key:string, value:any) {\r\n    let first = key.substr(0, 1);\r\n    switch (first) {\r\n        default: return value;\r\n        case '$':\r\n        case '_': return;\r\n    }\r\n}\r\n\r\nexport function jsonStringify(value:any) {\r\n    return JSON.stringify(value, replacer, ' ');\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { BoxId, Tuid } from \"../entities\";\r\nimport { PureJSONContent } from '../controllers';\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: (values?:any, x?:any)=>JSX.Element,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nfunction boxIdContent(bi: any, templet, x) {\r\n    let {id, _$tuid, _$com} = bi;\r\n    let t:Tuid = _$tuid;\r\n    if (t === undefined) {\r\n        if (templet !== undefined) return templet(bi, x);\r\n        return PureJSONContent(bi, x);\r\n    }\r\n    let com = templet || _$com;\r\n    if (com === undefined) {\r\n        com = bi._$com = t.getTuidContent();\r\n    }\r\n    let val = t.valueFromId(id);\r\n    if (typeof val === 'number') val = {id: val};\r\n    if (templet !== undefined) return templet(val, x);\r\n    return React.createElement(com, val);\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else\r\n                return ui(tuidValue, x);\r\n        case 'undefined':\r\n            if (nullUI === undefined) return <>null</>;\r\n            return nullUI();\r\n        case 'object':\r\n            if (tuidValue === null) {\r\n                if (nullUI === undefined) return <>null</>;\r\n                return nullUI();\r\n            }\r\n            return boxIdContent(tuidValue, ui, x);\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:(values?:any, x?:any)=>JSX.Element, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","export * from './jsonStringify';\r\nexport * from './tv';\r\n","export * from './CApp';\r\nexport * from './startApp';\r\nexport * from './usq';\r\nexport * from './action';\r\nexport * from './tuid';\r\nexport * from './sheet';\r\nexport * from './query';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './form/viewModel';\r\nexport * from './form';\r\nexport * from './formUI';\r\nexport * from './ControllerUsq';\r\nexport * from './CVEntity';\r\nexport * from './link';\r\nexport * from './icons';\r\n","import * as React from 'react';\r\nimport { VField } from './vField';\r\nimport { VArr } from './vArr';\r\nimport { VSubmit } from './vSubmit';\r\nimport { uid } from 'tonva-react-form';\r\n\r\nexport abstract class VBand {\r\n    protected label: string;\r\n    protected view = () => <div />;\r\n\r\n    constructor(label:string) {\r\n        this.label = label;\r\n    }\r\n\r\n    render():JSX.Element {\r\n        //text-sm-right\r\n        return <div key={this.key} className=\"px-3\">\r\n            <div className=\"form-group row\">\r\n                <label className=\"col-sm-2 col-form-label\">\r\n                    {this.label}\r\n                </label>\r\n                <div className=\"col-sm-10\">\r\n                    {this.renderContent()}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    setAddRow(addRow:()=>Promise<void>) {}\r\n    get key() {return this.label}\r\n    public getVFields():VField[] {return;}\r\n    public getVArr():VArr {return;}\r\n    public getVSubmit():VSubmit {return;}\r\n\r\n    protected renderContent():JSX.Element {\r\n        return <div className=\"form-control form-control-plaintext bg-white border border-info rounded \">content</div>;\r\n    }\r\n}\r\n\r\nexport interface FieldRes {\r\n    label: string;\r\n    placeHolder: string;\r\n    suffix: string;\r\n}\r\nexport class VFieldBand extends VBand {\r\n    protected vField:VField;\r\n    constructor(label:string, vField:VField) {\r\n        super(label);\r\n        this.vField = vField;\r\n    }\r\n\r\n    get key() {return this.vField.name}\r\n    public getVFields():VField[] {return [this.vField];}\r\n\r\n    protected renderContent():JSX.Element {\r\n        return this.vField.render();\r\n        /*\r\n        <div className=\"form-control form-control-plaintext bg-white border border-info rounded \">\r\n            {this.vField.render()}\r\n        </div>;*/\r\n    }\r\n}\r\n\r\nexport class VArrBand extends VBand {\r\n    protected vArr:VArr;\r\n    constructor(label:string, vArr:VArr) {\r\n        super(label);\r\n        this.vArr = vArr;\r\n    }\r\n\r\n    setAddRow(addRow:()=>Promise<void>) {this.vArr.setAddRow(addRow)}\r\n    get key() {return this.vArr.name}\r\n    public getVArr():VArr {return this.vArr;}\r\n\r\n    render():JSX.Element {\r\n        return <React.Fragment key={this.key}>\r\n            {this.vArr && this.vArr.render()}\r\n        </React.Fragment>;\r\n    }\r\n}\r\n\r\nexport class VFieldsBand extends VBand {\r\n    protected vFields: VField[];\r\n    constructor(label:string, vFields:VField[]) {\r\n        super(label);\r\n        this.vFields = vFields;\r\n    }\r\n\r\n    get key() {return this.vFields[0].name}\r\n    public getVFields():VField[] {return this.vFields;}\r\n\r\n    protected renderContent():JSX.Element {\r\n        return <div className=\"form-control form-control-plaintext bg-white border border-info rounded \">\r\n            fields\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class VSubmitBand extends VBand {\r\n    protected vSubmit: VSubmit;\r\n    constructor(vSubmit:VSubmit) {\r\n        super(undefined);\r\n        this.vSubmit = vSubmit;\r\n    }\r\n\r\n    get key() {return '$submit'}\r\n\r\n    public getVSubmit():VSubmit {return this.vSubmit;}\r\n\r\n    render():JSX.Element {\r\n        return <div key=\"$submit\" className=\"px-3\">\r\n            <div className=\"form-group row\">\r\n                <div className=\"offset-sm-2 col-sm-10\">\r\n                    {this.vSubmit.render()}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames'\r\nimport { ViewModel } from \"./viewModel\";\r\nimport { VForm } from './vForm';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class VSubmit extends ViewModel {\r\n    private vForm: VForm;\r\n    constructor(vForm: VForm) {\r\n        super();\r\n        this.vForm = vForm;\r\n        this.caption = this.vForm.submitCaption;\r\n        this.className = 'btn btn-primary w-25';\r\n    }\r\n    @observable caption: string;\r\n    @observable className: string;\r\n\r\n    private onClickSubmit = async () => {\r\n        this.vForm.submit();\r\n    }\r\n\r\n    protected view = observer(() => {\r\n        let {isOk} = this.vForm;\r\n        return <button type=\"button\" \r\n            onClick={this.onClickSubmit}\r\n            className={this.className}\r\n            disabled={isOk === false}>\r\n            {this.caption}\r\n        </button>;\r\n    });\r\n}","\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any);\r\n}\r\n\r\nexport class RuleRequired extends Rule {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if ((value as number) !== NaN) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push('不能为空');\r\n    }\r\n}\r\n\r\nexport class RuleNum extends Rule {\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (n === NaN) defy.push('必须是数字');\r\n    }\r\n}\r\n\r\nexport class RuleInt extends Rule {\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (Number.isNaN(n) === true || Number.isInteger(n) === false) {\r\n            defy.push('必须是整数');\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleMin extends RuleNum {\r\n    constructor(min: number) {\r\n        super();\r\n        this.min = min;\r\n    }\r\n    min: number;\r\n    check(defy:string[], value:any) {\r\n        super.check(defy, value);\r\n        if (Number(value) < this.min) defy.push('不能小于' + this.min);\r\n    }\r\n}\r\n\r\nexport class RuleMax extends RuleNum {\r\n    constructor(max: number) {\r\n        super();\r\n        this.max = max;\r\n    }\r\n    max: number;\r\n    check(defy:string[], value:any) {\r\n        super.check(defy, value);\r\n        if (Number(value) > this.max) defy.push('不能小于' + this.max);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { computed, action } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { FA } from 'tonva-react-form';\r\nimport { ViewModel } from \"../viewModel\";\r\nimport { VForm, FormMode } from '../vForm';\r\nimport { Rule, RuleRequired, RuleInt, RuleNum, RuleMin, RuleMax } from '../rule';\r\nimport { Field } from '../../../entities';\r\nimport { FieldRes } from '../vBand';\r\nimport { FieldUI, FieldInputUI, FieldStringUI, FieldNumberUI } from '../../formUI';\r\n\r\nexport abstract class VField extends ViewModel {\r\n    protected form: VForm;\r\n    protected fieldUI: FieldUI;\r\n    protected fieldRes:FieldRes;\r\n    protected field: Field;\r\n    protected rules: Rule[];\r\n    constructor(form:VForm, field:Field, fieldUI: FieldUI, fieldRes:FieldRes) {\r\n        super();\r\n        this.form = form;\r\n        this.field = field;\r\n        this.name = field.name;\r\n        this.fieldUI = fieldUI || {} as any;\r\n        this.fieldRes = fieldRes || {} as any;\r\n        this.init();\r\n    }\r\n\r\n    name: string;\r\n\r\n    protected init() {\r\n        this.buildRules();\r\n    }\r\n\r\n    protected buildRules() {\r\n        this.rules = [];\r\n        let {required} = this.fieldUI;\r\n        if (required === true || this.field !== undefined && this.field.null === false) {\r\n            this.rules.push(new RuleRequired);\r\n        }\r\n    }\r\n\r\n    @computed get checkRules(): string[] {\r\n        let defy = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        return defy;\r\n    }\r\n\r\n    @computed get isOk() {\r\n        if (this.rules.length === 0) return true;\r\n        let defy = this.checkRules;\r\n        return defy.length === 0;\r\n    }\r\n\r\n    @computed get value() { return this.form.values[this.name]; }\r\n    setValue(v:any) {\r\n        this.form.values[this.name]=v; \r\n    }\r\n    get error() { return this.form.errors[this.name]; }\r\n    set error(err:any) { this.form.errors[this.name]=err; }\r\n    protected parse(str:string):any {return str;}\r\n    get readonly():boolean {\r\n        let {mode} = this.form;\r\n        return mode === FormMode.readonly || \r\n            mode === FormMode.edit && this.fieldUI.editable === false;\r\n    }\r\n}\r\n\r\nexport class VUnknownField extends VField {\r\n    protected view = () => {\r\n        //let {name, type} = this.fieldUI;\r\n        let type='', name = '';\r\n        return <input type=\"text\" className=\"form-control form-control-plaintext border border-info rounded bg-light\"\r\n            placeholder={'unkown control: ' + type + '-' + name} />;\r\n    }\r\n}\r\n\r\nexport abstract class VInputControl extends VField {\r\n    protected fieldUI: FieldInputUI;\r\n    protected input: HTMLInputElement;\r\n\r\n    protected inputType:string;\r\n    protected get maxLength():number {return}\r\n\r\n    protected renderError = (className:string) => {\r\n        let {errors} = this.form;\r\n        let error = errors[this.name];\r\n        if (error === undefined) return;\r\n        return <div className={className}><FA name=\"exclamation-circle\" /> {error}</div>\r\n    }\r\n\r\n    /*\r\n    get value() {\r\n        return super.value;\r\n    }*/\r\n    setValue(v:any) {\r\n        super.setValue(v); this.setInputValue(); \r\n    }\r\n\r\n    protected ref = (input:HTMLInputElement) => {\r\n        this.input = input;\r\n        this.setInputValue();\r\n    }\r\n\r\n    protected setInputValue() {\r\n        if (!this.input) return;\r\n        let v = this.value;\r\n        this.input.value = v === null || v === undefined? '' : v;\r\n    }\r\n\r\n    protected onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected onBlur = () => {\r\n        let defy = this.checkRules;\r\n        if (defy.length > 0) {\r\n            this.error = defy[0];\r\n        }\r\n        this.form.computeFields();\r\n    }\r\n\r\n    protected onChange = (evt: React.ChangeEvent<any>) => {\r\n        let v = this.parse(evt.currentTarget.value);\r\n        if (v === null) {\r\n            return;\r\n        }\r\n        this.setValue(v);\r\n    }\r\n\r\n    protected onKeyPress: (event:React.KeyboardEvent<HTMLInputElement>) => void;\r\n    \r\n    protected view = observer(() => {\r\n        let {required} = this.fieldUI;\r\n        let {placeHolder, suffix} = this.fieldRes;\r\n        let ctrlCN = ['form-control', 'form-control-input'];\r\n        let errCN = 'text-danger small mt-1 mx-2';\r\n    \r\n        let redDot;\r\n        let input;\r\n        if (this.readonly === true) {\r\n            input = <input className={classNames(ctrlCN, 'bg-light')}\r\n                ref={this.ref}\r\n                type={this.inputType}\r\n                readOnly={true}\r\n            />;\r\n        }\r\n        else {\r\n            input = <input className={classNames(ctrlCN)}\r\n                ref={this.ref}\r\n                type={this.inputType}\r\n                onFocus={this.onFocus}\r\n                onBlur={this.onBlur}\r\n                onChange={this.onChange}\r\n                placeholder={placeHolder}\r\n                readOnly={false}\r\n                maxLength={this.maxLength}\r\n                onKeyPress={this.onKeyPress}\r\n            />;\r\n            if (required === true || this.field.null === false) {\r\n                redDot = <RedMark />;\r\n            }\r\n        }\r\n\r\n        let inputGroup;\r\n        if (suffix === undefined)\r\n            inputGroup = input;\r\n        else\r\n            inputGroup = <div className=\"input-group\">\r\n                {input}\r\n                <div className=\"input-group-append\">\r\n                    <span className=\"input-group-text\">{suffix}</span>\r\n                </div>\r\n            </div>;\r\n\r\n        return <>\r\n            {redDot}\r\n            {inputGroup}\r\n            {this.renderError(errCN)}\r\n        </>\r\n    });\r\n}\r\n\r\nexport const RedMark = () => <b style={{color:'red', position:'absolute', left:'0.1em', top:'0.5em'}}>*</b>;\r\n\r\nexport class VStringField extends VInputControl {\r\n    protected fieldUI: FieldStringUI;\r\n    protected inputType:string = 'text';\r\n    protected get maxLength():number {return this.field.size}\r\n}\r\n\r\nconst KeyCode_Neg = 45;\r\nconst KeyCode_Dot = 46;\r\n\r\nexport abstract class VNumberControl extends VInputControl {\r\n    protected fieldUI: FieldNumberUI;\r\n    protected extraChars: number[];\r\n\r\n    protected init() {\r\n        super.init();\r\n        this.extraChars = [];\r\n        if (this.fieldUI !== undefined) {\r\n            let {min, max} = this.fieldUI;\r\n            if (min !== undefined) {\r\n                //this.rules.push((v:number) => {if (v === undefined) return; if (v<min) return ErrMin + min; return true;});\r\n                if (min < 0) this.extraChars.push(KeyCode_Neg);\r\n            }\r\n            else {\r\n                this.extraChars.push(KeyCode_Neg);\r\n            }\r\n    \r\n            if (max !== undefined) {\r\n                //this.rules.push((v:number) => {if (v === undefined) return; if (v>max) return ErrMax + max; return true});\r\n            }\r\n        }\r\n        switch (this.field.type) {\r\n            case 'dec':\r\n            case 'bigint':\r\n            case 'int':\r\n            case 'smallint':\r\n            case 'tinyint':\r\n                this.extraChars.push(KeyCode_Dot); break;\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        this.rules.push(new RuleNum);\r\n        let {min, max} = this.fieldUI;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n    }\r\n\r\n    inputType:string = 'number';\r\n\r\n    protected parse(text:string):any {\r\n        try {\r\n            if (text.trim().length === 0) return undefined;\r\n            let ret = Number(text);\r\n            return (ret === NaN)? null : ret;\r\n        }\r\n        catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    protected setInputValue() {\r\n        if (!this.input) return;\r\n        let v = this.value;\r\n        if (this.parse(this.input.value) == v) return;\r\n        this.input.value = v === null || v === undefined? '' : v;\r\n    }\r\n\r\n    protected onKeyPress = (event:React.KeyboardEvent<HTMLInputElement>) => {\r\n        let ch = event.charCode;\r\n        if (ch === 8 || ch === 0 || ch === 13 || ch >= 48 && ch <= 57) return;\r\n        if (this.extraChars !== undefined) {\r\n            if (this.extraChars.indexOf(ch) >= 0) {\r\n                switch (ch) {\r\n                    case KeyCode_Dot: this.onKeyDot(); break;\r\n                    case KeyCode_Neg: this.onKeyNeg(); event.preventDefault(); break;\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n    }\r\n\r\n    private onKeyDot() {\r\n        let v = this.input.value;\r\n        let p = v.indexOf('.');\r\n        if (p >= 0) this.input.value = v.replace('.', '');\r\n    }\r\n    private onKeyNeg() {\r\n        let v = this.input.value;\r\n        let p = v.indexOf('-');\r\n        if (p >= 0) v = v.replace('-', '');\r\n        else v = '-'+v;\r\n        this.input.value = v;\r\n    }\r\n}\r\n\r\nexport class VIntField extends VNumberControl {\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        this.rules.push(new RuleInt);\r\n    }\r\n}\r\n\r\nexport class VDecField extends VNumberControl {\r\n}\r\n\r\nexport class VTextField extends VStringField {\r\n\r\n}\r\n\r\nexport class VDateTimeField extends VStringField {\r\n\r\n}\r\n","import React from 'react';\r\nimport { VField } from './vField';\r\nimport { Field } from '../../../entities';\r\nimport { VForm } from '../vForm';\r\nimport { observer } from 'mobx-react';\r\nimport { FieldRes } from '../vBand';\r\n\r\nexport class VComputeField extends VField {\r\n    constructor(form:VForm, field: Field, fieldRes: FieldRes) {\r\n        super(form, field, undefined, fieldRes);\r\n    }\r\n    protected view = observer(() => {\r\n        let value = this.form.values[this.field.name];\r\n        let {placeHolder, suffix} = this.fieldRes;\r\n        let ctrlCN = 'form-control form-control-input bg-light';\r\n        if (value === null) value = '';\r\n        let input = <input className={ctrlCN}\r\n            type=\"text\"\r\n            placeholder={placeHolder}\r\n            readOnly={true}\r\n            value={value}/>\r\n        let inputGroup;\r\n        if (suffix === undefined)\r\n            inputGroup = input;\r\n        else\r\n            inputGroup = <div className=\"input-group\">\r\n                {input}\r\n                <div className=\"input-group-append\">\r\n                    <span className=\"input-group-text\">{suffix}</span>\r\n                </div>\r\n            </div>;\r\n        return inputGroup;\r\n        /*\r\n            return <div \r\n            className=\"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer\">\r\n            {value} &nbsp;\r\n        </div>;\r\n        */\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { List, FA, Muted } from 'tonva-react-form';\r\nimport { Page, nav } from 'tonva-tools';\r\nimport { ViewModel, RowContent, TypeContent, JSONContent } from './viewModel';\r\nimport { ArrFields, Field } from '../../entities';\r\nimport { VForm, FieldInputs, FormMode } from './vForm';\r\nimport { FormArr } from '../formUI';\r\n\r\nexport type ArrEditRow = (initValues:any, onRowChanged:(rowValues:any)=>void) => Promise<void>;\r\n\r\nexport class VArr extends ViewModel {\r\n    protected mode: FormMode;\r\n    protected label: any;\r\n    protected header: any;\r\n    protected footer: any;\r\n    protected rowValues: any;                 // 仅仅用来判断是不是新增，undefined则是新增\r\n    protected onEditRow: ArrEditRow;\r\n    protected ownerForm:VForm;\r\n    protected vForm:VForm;\r\n    protected rowContent:TypeContent;\r\n    protected none: string;\r\n    protected newSubmitCaption: string;\r\n    protected editSubmitCaption: string;\r\n    protected addRow: ()=>Promise<void>;\r\n\r\n    name:string;\r\n    list: IObservableArray<any>;\r\n\r\n    constructor(ownerForm:VForm, arr:ArrFields, onEditRow?:ArrEditRow) {\r\n        super();\r\n        this.ownerForm = ownerForm;\r\n        let {name, fields} = arr;\r\n        this.name = name;\r\n        let {ui, res, mode, inputs, values} = ownerForm;\r\n        let arrsRes = res.arrs;\r\n        let arrRes = arrsRes !== undefined? arrsRes[name] : {};\r\n        let {label, none, newSubmit, editSubmit} = arrRes;\r\n        this.none = none || ownerForm.none;\r\n        this.newSubmitCaption = newSubmit || ownerForm.arrNewCaption;\r\n        this.editSubmitCaption = editSubmit || ownerForm.arrEditCaption;\r\n        this.label = label || name;\r\n        let arrUI = ((ui && ui.items[name]) || {}) as FormArr;\r\n        this.rowContent = arrUI.rowContent;// || JSONContent;\r\n        this.mode = mode;\r\n        if (this.onEditRow === undefined) {\r\n            this.vForm = new VForm({\r\n                fields: fields,\r\n                arrs: undefined,\r\n                ui: arrUI,\r\n                res: arrRes,\r\n                inputs: inputs[name] as FieldInputs,\r\n                none: ownerForm.none,\r\n                submitCaption: 'submit',\r\n                arrNewCaption: undefined,\r\n                arrEditCaption: undefined,\r\n                arrTitleNewButton: undefined,\r\n                mode: mode,\r\n            }, \r\n            mode===FormMode.readonly? undefined: this.onSubmit);\r\n        }\r\n        else {\r\n            this.onEditRow = onEditRow;\r\n        }\r\n        this.list = values[name];\r\n    }\r\n\r\n    reset() {\r\n        this.vForm.reset();\r\n        this.list.clear();\r\n    }\r\n\r\n    setAddRow(addRow:()=>Promise<void>) {\r\n        this.addRow = addRow;\r\n    }\r\n\r\n    protected rowPage = () => {\r\n        return <Page header={this.label} back=\"close\">\r\n            {this.vForm.render('py-3')}\r\n        </Page>\r\n    }\r\n    private onSubmit = async () => {\r\n        let {valueBoxs} = this.vForm;\r\n        await this.onRowChanged(valueBoxs);\r\n    }\r\n\r\n    private onRowChanged = async (rowValues:any) => {\r\n        if (this.rowValues === undefined) {\r\n            rowValues.$owner = this.ownerForm.values;\r\n            this.list.push(rowValues);\r\n            if (this.onEditRow === undefined)\r\n                this.vForm.reset();\r\n            else\r\n                await this.onEditRow(undefined, this.onRowChanged);\r\n        }\r\n        else {\r\n            _.merge(this.rowValues, rowValues);\r\n            if (this.onEditRow === undefined) nav.pop();\r\n        }\r\n    }\r\n\r\n    private renderItem = (item:any, index:number) => {\r\n        if (this.rowContent === undefined)\r\n            return <div className=\"px-3 py-2\"><JSONContent {...item} /></div>\r\n        return <this.rowContent {...item} />;\r\n    }\r\n    private showRow = async (rowValues:any):Promise<any> => {\r\n        if (this.onEditRow !== undefined) {\r\n            await this.onEditRow(rowValues, this.onRowChanged);\r\n            return;\r\n        }\r\n        this.vForm.reset();\r\n        if (rowValues !== undefined) this.vForm.setValues(rowValues);\r\n        nav.push(<this.rowPage />);\r\n    }\r\n    private editRow = async (rowValues:any): Promise<void> => {\r\n        this.rowValues = rowValues;\r\n        let {vSubmit} = this.vForm;\r\n        if (vSubmit !== undefined) {\r\n            vSubmit.caption = this.editSubmitCaption;\r\n            vSubmit.className = 'btn btn-outline-success';\r\n        }\r\n        this.vForm.mode = this.ownerForm.mode;\r\n        await this.showRow(rowValues);\r\n    }\r\n    private internalAddRow = async () => {\r\n        this.rowValues = undefined;\r\n        let {vSubmit} = this.vForm;\r\n        vSubmit.caption = this.newSubmitCaption;\r\n        vSubmit.className = 'btn btn-outline-success';\r\n        this.vForm.reset();\r\n        this.vForm.mode = FormMode.new;\r\n        await this.showRow(undefined);\r\n    }\r\n\r\n    protected view = () => {\r\n        let button;\r\n        if (this.addRow !== undefined || this.mode !== FormMode.readonly) {\r\n            button = <button onClick={this.addRow || this.internalAddRow}\r\n                type=\"button\" \r\n                className=\"btn btn-link p-0\">\r\n                {this.ownerForm.arrTitleNewButton}\r\n            </button>;\r\n        }\r\n        let header = this.header || <div className=\"px-3 bg-light small\" style={{paddingTop:'1px', paddingBottom:'1px'}}>\r\n            <div className=\"flex-fill align-self-center\">{this.label}</div>\r\n            {button}\r\n        </div>;\r\n        return <List className=\"pb-3\"\r\n            header={header}\r\n            none={<Muted className=\"px-3 py-2\">{this.none}</Muted>}\r\n            items={this.list}\r\n            item={{render: this.renderItem, onClick: this.editRow}} />;\r\n    };\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { tv } from '../../../tools';\r\nimport { Field, Tuid } from '../../../entities';\r\nimport { VField, RedMark } from \"./vField\";\r\nimport { FieldUI } from '../../formUI';\r\nimport { VForm, FieldInput, FormMode } from '../vForm';\r\nimport { FieldRes } from '../vBand';\r\n\r\nconst buttonStyle:React.CSSProperties = {\r\n    textAlign:'left', \r\n    paddingLeft:'0.75rem', \r\n    paddingRight:'0.75rem', \r\n    overflow: 'hidden'\r\n};\r\n\r\nexport class VTuidField extends VField {\r\n    protected vForm: VForm;\r\n    protected input: FieldInput;\r\n    protected tuid: Tuid;\r\n\r\n    constructor(vForm: VForm, field:Field, fieldUI: FieldUI, fieldRes:FieldRes) {\r\n        super(vForm, field, fieldUI, fieldRes);\r\n        this.tuid = field._tuid;\r\n        this.vForm = vForm;\r\n        this.input = vForm.inputs[field.name] as FieldInput;\r\n    }\r\n\r\n    onClick = async () => {\r\n        if (this.readonly === true) {\r\n            if (!this.value) return;\r\n            await this.tuid.showInfo(this.value.id);\r\n            return;\r\n        }\r\n        let id:number;\r\n        if (this.input !== undefined) {\r\n            id = await this.input.select(this.vForm, this.field, this.vForm.getValues());\r\n        }\r\n        else {\r\n            alert('call undefined');\r\n            id = 0;\r\n        }\r\n        this.setValue(this.tuid.boxId(id));\r\n    }\r\n    protected view = observer(() => {\r\n        let {placeHolder} = this.fieldRes;\r\n        let disabled:boolean = false;\r\n        let {_ownerField} = this.field;\r\n        if (_ownerField !== undefined) {\r\n            let {name, arr} = _ownerField;\r\n            disabled = this.vForm.getValue(name) === null;\r\n        }\r\n        let content;\r\n        if (this.value === null)\r\n            content = <>{placeHolder || this.input.placeHolder}</>;\r\n        else if (typeof this.value === 'object') {\r\n            content = tv(this.value);\r\n        }\r\n        else {\r\n            let idBox = this.tuid.boxId(this.value);\r\n            content = tv(idBox); // idBox.content();\r\n        }\r\n        if (this.readonly === true)\r\n        {\r\n            return <div \r\n                className=\"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer\"\r\n                onClick={this.onClick}>\r\n                {content}\r\n            </div>;\r\n        }\r\n        let redDot;\r\n        let {required} = this.fieldUI;\r\n        if (required === true || this.field.null === false) {\r\n            redDot = <RedMark />;\r\n        }\r\n        return <>\r\n            {redDot}\r\n            <button className=\"form-control btn btn-outline-info\"\r\n                type=\"button\"\r\n                disabled={disabled}\r\n                style={buttonStyle}\r\n                onClick={this.onClick}>\r\n                {content}\r\n            </button>\r\n        </>;\r\n    })\r\n}\r\n","import { VBand, VFieldBand, VArrBand, VFieldsBand, VSubmitBand, FieldRes } from \"./vBand\";\r\nimport { Field, ArrFields } from \"../../entities\";\r\nimport { VForm, FormOptions } from \"./vForm\";\r\nimport { FormItems, FieldUI, FormItem } from \"../formUI\";\r\nimport { VSubmit } from \"./vSubmit\";\r\nimport { VField, buildVField, VComputeField } from \"./vField\";\r\nimport { VArr } from \"./vArr\";\r\nimport { VTuidField } from \"./vField/vTuidField\";\r\n\r\nexport class BandsBuilder {\r\n    private vForm: VForm;\r\n    private onSubmit: (values:any)=>Promise<void>;\r\n    private fields: Field[];\r\n    private arrs: ArrFields[];\r\n    private formItems: FormItems;\r\n    private layout: string[];\r\n    private res: any;\r\n    constructor(vForm:VForm, options: FormOptions, onSubmit: (values:any)=>Promise<void>) {\r\n        this.vForm = vForm;\r\n        this.onSubmit = onSubmit;\r\n        let {fields, arrs, ui, res} = options;\r\n        this.fields = fields;\r\n        this.arrs = arrs;\r\n        if (ui !== undefined) {\r\n            let {items, layout} = ui;\r\n            this.formItems = items;\r\n            this.layout = layout;\r\n        }\r\n        this.res = res;\r\n    }\r\n\r\n    build():VBand[] {\r\n        //return this.bandUIs === undefined? this.bandsOnFly() : this.bandsFromUI();\r\n        return this.layout === undefined? this.bandsOnFly() : this.bandsFromLayout();\r\n    }\r\n\r\n    private resFromName(name:string, res:any):string|FieldRes {\r\n        if (res === undefined) return;\r\n        let {fields} = res;\r\n        if (fields === undefined) return;\r\n        return fields[name] || name;\r\n    }\r\n\r\n    private bandsOnFly():VBand[] {\r\n        let bands:VBand[] = [];\r\n        this.bandsFromFields(bands, this.fields, this.res);\r\n        if (this.arrs !== undefined) {\r\n            for (let arr of this.arrs) bands.push(this.bandFromArr(arr));\r\n        }\r\n        if (this.onSubmit !== undefined) {\r\n            bands.push(new VSubmitBand(new VSubmit(this.vForm)));\r\n        }\r\n        return bands;\r\n    }\r\n\r\n    private bandsFromFields(bands:VBand[], fields:Field[], res:any) {\r\n        if (fields === undefined) return;\r\n        for (let field of fields) bands.push(this.bandFromField(field, res));\r\n    }\r\n\r\n    private bandsFromLayout():VBand[] {\r\n        let bands:VBand[] = [];\r\n        /*\r\n        for (let bandUI of this.bandUIs)  {\r\n            let band = this.bandFromUI(bandUI);\r\n            bands.push(band);\r\n        }\r\n        */\r\n        return bands;\r\n    }\r\n\r\n    /*\r\n    private bandFromUI(bandUI:BandUI):VBand {\r\n        let {band} = bandUI;\r\n        switch (band) {\r\n            default: return this.bandFromFieldUI(bandUI as FieldBandUI);\r\n            case 'arr': return this.bandFromArrUI(bandUI as ArrBandUI);\r\n            case 'fields': return this.bandFromFieldsUI(bandUI as FieldsBandUI);\r\n            case 'submit': return this.bandFromSubmitUI(bandUI as SubmitBandUI);\r\n        }\r\n    }\r\n    \r\n    private bandFromFieldUI(bandUI: FieldBandUI): VFieldBand {\r\n        let {label} = bandUI;\r\n        let vField = this.vFieldFromUI(bandUI);\r\n        return new VFieldBand(label, vField);\r\n    }\r\n    private bandFromArrUI(bandUI: ArrBandUI): VArrBand {\r\n        let {label, name} = bandUI;\r\n        let vArr = this.vArrFromUI(bandUI);\r\n        return new VArrBand(label, vArr);\r\n    }\r\n    private bandFromFieldsUI(bandUI: FieldsBandUI): VFieldsBand {\r\n        let {label, fieldUIs} = bandUI;\r\n        let vFields = fieldUIs.map(v => this.vFieldFromUI(v));\r\n        return new VFieldsBand(label, vFields);\r\n    }\r\n    private bandFromSubmitUI(bandUI: SubmitBandUI): VSubmitBand {\r\n        if (this.onSubmit === undefined) return;\r\n        let vSubmit = new VSubmit(this.vForm);\r\n        return new VSubmitBand(vSubmit);\r\n    }\r\n    */\r\n/*\r\n    private vFieldFromField(field:Field, fieldRes:FieldRes, formItem: FormItem): VField {\r\n        let fieldUI:FieldUI = undefined;\r\n        if (formItem !== undefined) {\r\n            if (typeof formItem === 'function') {\r\n                return new VComputeField(this.vForm, field, fieldRes);\r\n            }\r\n        }\r\n        let ret = buildVField(this.vForm, field, formItem, fieldRes);\r\n        if (ret !== undefined) return ret;\r\n        return new VTuidField(field, fieldUI, fieldRes, this.vForm);\r\n    }\r\n*/\r\n    private bandFromField(field:Field, res:any):VBand {\r\n        let {name} = field;\r\n        let fieldRes:FieldRes;\r\n        let rfn = this.resFromName(name, res);\r\n        let label:string;\r\n        if (typeof rfn === 'object') {\r\n            label = rfn.label;\r\n            fieldRes = rfn;\r\n        }\r\n        else {\r\n            label = rfn as string;\r\n            fieldRes = undefined;\r\n        }\r\n        let vField:VField;\r\n        let formItem:FormItem;\r\n        if (this.formItems !== undefined) formItem = this.formItems[name];\r\n        //let vField = this.vFieldFromField(field, fieldRes as FieldRes, formItem);\r\n        //let fieldUI:FieldUI = undefined;\r\n        if (typeof formItem === 'function') {\r\n            vField = new VComputeField(this.vForm, field, fieldRes);\r\n        }\r\n        else {\r\n            vField = buildVField(this.vForm, field, formItem as FieldUI, fieldRes);\r\n        }\r\n        if (vField === undefined) {\r\n            vField = new VTuidField(this.vForm, field, formItem as FieldUI, fieldRes);\r\n        }\r\n        return new VFieldBand(label || name, vField);\r\n    }\r\n\r\n    private bandFromArr(arr: ArrFields):VBand {\r\n        let {name, fields} = arr;\r\n        //let row = JSONContent;\r\n        //let bands:VBand[] = [];\r\n        //this.bandsFromFields(bands, fields, res);\r\n        let vArr = new VArr(this.vForm, arr); // name, res && res.label || name, row, bands);\r\n        return new VArrBand(name, vArr);\r\n    }\r\n\r\n    /*\r\n    private vFieldFromUI(fieldUI:FieldUI):VField {\r\n        return;\r\n    }\r\n\r\n    private vArrFromUI(arrBandUI:ArrBandUI):VArr {\r\n        return;\r\n    }\r\n    */\r\n}\r\n","import { VField, VIntField, VDecField, VStringField, VTextField, VDateTimeField } from './vField';\r\nimport { Field } from '../../../entities';\r\nimport { FieldRes } from '../vBand';\r\nimport { VForm } from '../vForm';\r\nimport { FieldUI } from '../../formUI';\r\n\r\nexport function buildVField(form:VForm, field: Field, fieldUI: FieldUI, fieldRes:FieldRes): VField {\r\n    let vField:new (form:VForm, field:Field, ui:FieldUI, fieldRes:FieldRes) => VField;\r\n    switch (field.type) {\r\n        default: return;\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n            vField = VIntField;\r\n            break;\r\n        case 'bigint':\r\n            let {_tuid} = field;\r\n            if (_tuid !== undefined) return;\r\n            vField = VIntField;\r\n            break;\r\n        case 'dec':\r\n            vField = VDecField;\r\n            break;\r\n        case 'char':\r\n            vField = VStringField;\r\n            break;\r\n        case 'text':\r\n            vField = VTextField;\r\n            break;\r\n        case 'datetime':\r\n            vField = VDateTimeField;\r\n            break;\r\n    }\r\n    return new vField(form, field, fieldUI, fieldRes);\r\n}\r\n\r\n","import * as React from 'react';\r\nimport * as _ from 'lodash';\r\nimport { observer } from \"mobx-react\";\r\nimport { VBand } from './vBand';\r\nimport { BandsBuilder } from './bandsBuilder';\r\nimport { Field, ArrFields } from '../../entities';\r\nimport { computed, observable, IObservableObject, IObservableValue } from 'mobx';\r\nimport { VArr } from './vArr';\r\nimport { FormUI, FormUIBase, FormItems } from '../formUI';\r\nimport { VField } from './vField';\r\nimport { VSubmit } from './vSubmit';\r\nimport { IObservableArray } from 'mobx';\r\nimport { FA } from 'tonva-react-form';\r\n\r\nexport type FieldCall = (form:VForm, field:Field, values:any) => Promise<any>;\r\nexport interface FieldInput {\r\n    select: FieldCall;\r\n    content: React.StatelessComponent<any>;\r\n    placeHolder: string;\r\n}\r\nexport interface FieldInputs {\r\n    [fieldOrArr:string]: FieldInput | {[field:string]: FieldInput};\r\n}\r\nexport enum FormMode {new, edit, readonly}\r\n\r\nexport interface FormOptions {\r\n    fields: Field[];\r\n    arrs?: ArrFields[];\r\n    ui: FormUIBase;\r\n    res: any;\r\n    inputs: FieldInputs;\r\n    submitCaption: string;\r\n    arrNewCaption: string;\r\n    arrEditCaption: string;\r\n    arrTitleNewButton: JSX.Element;\r\n    none: string;\r\n    mode: FormMode;\r\n}\r\n\r\nexport class VForm {\r\n    protected fields: Field[];\r\n    protected arrs: ArrFields[];\r\n    protected bands: VBand[];\r\n    protected bandColl: {[key:string]: VBand};\r\n    protected onSubmit: ()=>Promise<void>;\r\n\r\n    constructor(options: FormOptions, onSubmit: ()=>Promise<void>) {\r\n        let {fields, arrs, ui, res, inputs, none, submitCaption, arrNewCaption, arrEditCaption, arrTitleNewButton, mode} = options;\r\n        this.fields = fields;\r\n        this.arrs = arrs;\r\n        this.ui = ui;\r\n        if (this.ui !== undefined) this.formItems = this.ui.items; //.compute = this.ui.compute;\r\n        this.res = res;\r\n        this.inputs = inputs;\r\n        this.none = none;\r\n        this.submitCaption = submitCaption;\r\n        this.arrNewCaption = arrNewCaption;\r\n        this.arrEditCaption = arrEditCaption;\r\n        this.arrTitleNewButton = arrTitleNewButton || <small><FA name=\"plus\" /> 新增</small>;\r\n        if (onSubmit === undefined) this.mode = FormMode.readonly;\r\n        else this.mode = mode;\r\n        this.buildFormValues();\r\n        this.buildBands(options, onSubmit);\r\n        this.onSubmit = onSubmit;\r\n    }\r\n\r\n    ui: FormUI;\r\n    res: any;\r\n    values: any;\r\n    errors: any;\r\n    formItems: FormItems;\r\n    mode: FormMode;\r\n    vFields: {[name:string]:VField} = {};\r\n    vArrs: {[name:string]: VArr} = {};\r\n    vSubmit: VSubmit;\r\n    inputs: FieldInputs;\r\n    none: string;\r\n    submitCaption: string;\r\n    arrNewCaption: string;\r\n    arrEditCaption: string;\r\n    arrTitleNewButton: JSX.Element;\r\n\r\n    private buildBands(options: FormOptions, onSubmit: (values:any)=>Promise<void>) {\r\n        this.bandColl = {};\r\n        let bandsBuilder = new BandsBuilder(this, options, onSubmit);\r\n        this.bands = bandsBuilder.build();\r\n        for (let band of this.bands) {\r\n            this.bandColl[band.key] = band;\r\n            let vFields = band.getVFields();\r\n            if (vFields !== undefined) for (let f of vFields) this.vFields[f.name] = f;\r\n            let vArr = band.getVArr();\r\n            if (vArr !== undefined) this.vArrs[vArr.name] = vArr;\r\n            let vSubmit = band.getVSubmit();\r\n            if (vSubmit !== undefined) this.vSubmit = vSubmit;\r\n        }\r\n    }\r\n\r\n    private onFormSubmit = (event:React.FormEvent<any>) => {\r\n        event.preventDefault();\r\n        return false;\r\n    }\r\n\r\n    protected view = observer(({className}:{className:string}) => {\r\n        return <form className={className} onSubmit={this.onFormSubmit}>\r\n            {this.bands.map(v => v.render())}\r\n        </form>;\r\n    });\r\n\r\n    getBand(name:string) {\r\n        return this.bandColl[name];\r\n    }\r\n\r\n    computeFields() {\r\n        if (this.formItems === undefined) return;\r\n        let values = this.values;\r\n        for (let i in this.formItems) {\r\n            let item = this.formItems[i];\r\n            if (typeof item !== 'function') continue;\r\n            values[i] = item.call(values);\r\n        }\r\n    }\r\n\r\n    async submit() {\r\n        if (this.onSubmit === undefined) return;\r\n        await this.onSubmit();\r\n    }\r\n    \r\n    getValues() {\r\n        let ret:any = {};\r\n        let values = this.values;\r\n        for (let f of this.fields) {\r\n            let {name} = f;\r\n            let v = values[name]\r\n            ret[name] =  v !== null && typeof v === 'object' ? v.id : v;\r\n        }\r\n        if (this.arrs !== undefined) {\r\n            for (let arr of this.arrs) {\r\n                let {name, fields, id, order} = arr;\r\n                let list = ret[name] = [];\r\n                let rows = this.vArrs[name].list;\r\n                for (let row of rows) {\r\n                    let item = {} as any;\r\n                    if (id !== undefined) item[id] = row[id];\r\n                    if (order !== undefined) item[order] = row[order];\r\n                    for (let f of fields) {\r\n                        let {name:fn} = f;\r\n                        let v = row[fn]\r\n                        item[fn] =  v !== null && typeof v === 'object' ? v.id : v;\r\n                    }\r\n                    list.push(item);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    get valueBoxs() {\r\n        let ret:any = {};\r\n        let values = this.values;\r\n        for (let f of this.fields) {\r\n            let {name, _tuid} = f;\r\n            let v = values[name]\r\n            ret[name] =  _tuid === undefined || typeof v === 'object' ? v : _tuid.boxId(v);\r\n        }\r\n        if (this.arrs === undefined) return ret;\r\n        for (let arr of this.arrs) {\r\n            let {name, fields, id, order} = arr;\r\n            let list = ret[name] = this.vArrs[name].list.slice();\r\n            for (let row of list) {\r\n                for (let f of fields) {\r\n                    let {name:fn, _tuid} = f;\r\n                    let v = row[fn]\r\n                    row[fn] =  _tuid === undefined || typeof v === 'object' ? v : _tuid.boxId(v);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    setValues(initValues:any) {\r\n        if (initValues === undefined) {\r\n            this.reset();\r\n            return;\r\n        }\r\n        let values = this.values;\r\n        let errors = this.errors;\r\n        for (let f of this.fields) {\r\n            let fn = f.name;\r\n            errors[fn] = undefined;\r\n            let v =  initValues[fn];\r\n            values[fn] = v;\r\n        }\r\n        // 还要设置arrs的values\r\n        for (let i in this.vArrs) {\r\n            let list = initValues[i];\r\n            if (list === undefined) continue;\r\n            let arrList = values[i] as IObservableArray<any>;\r\n            arrList.clear();\r\n            arrList.push(...list);\r\n        }\r\n    }\r\n\r\n    @computed get isOk():boolean {\r\n        for (let i in this.vFields) {\r\n            if (this.vFields[i].isOk === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    reset() {\r\n        let values = this.values;\r\n        let errors = this.errors;\r\n        for (let f of this.fields) {\r\n            let fn = f.name;\r\n            //if (this.compute !== undefined && this.compute[fn] !== undefined) continue;\r\n            values[fn] = null;\r\n            errors[fn] = undefined;\r\n        }\r\n        for (let i in this.vFields) {\r\n            let ctrl = this.vFields[i];\r\n            let cn = ctrl.name;\r\n            if (cn === undefined) continue;\r\n            //if (this.compute !== undefined && this.compute[cn] !== undefined) continue;\r\n            ctrl.setValue(null);\r\n        }\r\n        for (let i in this.vArrs) {\r\n            let vArr = this.vArrs[i];\r\n            vArr.reset();\r\n        }\r\n    }\r\n\r\n    getValue(fieldName: string) {\r\n        return this.values[fieldName];\r\n    }\r\n    setValue(fieldName: string, value: any) { this.values[fieldName] = value }\r\n\r\n    setError(fieldName:string, error:string) {this.errors[fieldName] = error}\r\n\r\n    private buildFieldValues(fields: Field[]):any {\r\n        let v: {[p:string]: any} = {\r\n            valueFromFieldName: function(propName:string) {\r\n                return this[propName];\r\n            }\r\n        };\r\n        for (let f of fields) {\r\n            let fn = f.name;\r\n            v[fn] = null;\r\n        }\r\n        return v;\r\n    }\r\n    private buildObservableValues():IObservableObject {\r\n        let v: {[p:string]: any} = this.buildFieldValues(this.fields);\r\n        if (this.arrs !== undefined) {\r\n            for (let arr of this.arrs) {\r\n                v[arr.name] = observable.array([], {deep:true});\r\n            }\r\n        }\r\n        let ret = observable(v);\r\n        return ret;\r\n    }\r\n    private buildFormValues() {\r\n        this.values = this.buildObservableValues();\r\n        this.errors = observable(this.buildFieldValues(this.fields));\r\n    }\r\n\r\n    render(className:string = \"py-3\"):JSX.Element {\r\n        return <this.view className={className} />\r\n    }\r\n}\r\n","export * from './vForm';\r\n","import { Entities, Field, ArrFields, FieldMap } from './entities';\r\nimport { TuidMain, Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\n\r\nexport abstract class Entity {\r\n    protected entities: Entities;\r\n    protected schema: any;\r\n    private jName: string;\r\n    sys?: boolean;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(entities:Entities, name:string, typeId:number) {\r\n        this.entities = entities;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    protected get tvApi() {return this.entities.usqApi;}\r\n    protected async getApiFrom() {return this.entities.usqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = await this.entities.usqApi.schema(this.name);\r\n        this.setSchema(schema);\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        if (this.schema !== undefined) return;\r\n        this.schema = schema;\r\n        let {name, fields, arrs, returns} = schema;\r\n        if (name !== this.name) this.jName = name;\r\n        this.entities.buildFieldTuid(this.fields = fields);\r\n        this.entities.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.entities.buildArrFieldsTuid(this.returns = returns, fields);\r\n        //this.newMain = this.buildCreater(fields);\r\n        //this.newArr = this.buildArrCreater(arrs);\r\n        //this.newRet = this.buildArrCreater(returns);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromField(field:Field):Tuid {\r\n        let {_tuid, tuid} = field;\r\n        if (tuid === undefined) return;\r\n        if (_tuid !== undefined) return _tuid;\r\n        return field._tuid = this.entities.getTuid(tuid, undefined);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.entities;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid, undefined);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                this.packArr(ret, arr.fields, data[arr.name]);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n    \r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (typeof d) {\r\n            default: return d;\r\n            case 'object':\r\n                let tuid = field._tuid;\r\n                if (tuid === undefined) return d.id;\r\n                return tuid.getIdFromObj(d);\r\n            case 'string':\r\n                let len = d.length;\r\n                let r = '', p = 0;\r\n                for (let i=0;i<len;i++) {\r\n                    let c = d.charCodeAt(i);\r\n                    switch(c) {\r\n                        case 9: r += d.substring(p, i) + '\\\\t'; p = i+1; break;\r\n                        case 10: r += d.substring(p, i) + '\\\\n'; p = i+1; break;\r\n                    }\r\n                }\r\n                return r + d.substring(p);\r\n            case 'undefined': return '';\r\n        }\r\n    }\r\n    \r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n    \r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n            for (let row of data) {\r\n                this.packRow(result, fields, row);\r\n            }\r\n        }\r\n        result.push(ln);\r\n    }\r\n    \r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    \r\n    unpackReturns(data:string):any {\r\n        let ret = {} as any;\r\n        //if (schema === undefined || data === undefined) return;\r\n        //let fields = schema.fields;\r\n        let p = 0;\r\n        //if (fields !== undefined) p = unpackRow(ret, schema.fields, data, p);\r\n        let arrs = this.returns; //schema['returns'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                //let creater = this.newRet[arr.name];\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    \r\n    private unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[f.name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[f.name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) break;\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[f.name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[f.name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                break;\r\n            }\r\n        }\r\n        return p;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n            default: return v;\r\n            case 'datetime':\r\n            case 'date':\r\n            case 'time':\r\n                let date = new Date(Number(v));\r\n                return date;\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'dec': return Number(v);\r\n            case 'bigint':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                _tuid.useId(id, true);\r\n                //let val = _tuid.valueFromId(id);\r\n                //return val.obj || val;\r\n                return _tuid.boxId(id);\r\n                /*\r\n                if (tuidKey !== undefined) {\r\n                    let tuid = f._tuid;\r\n                    if (tuid === undefined) {\r\n                        // 在jsonStringify中间不会出现\r\n                        Object.defineProperty(f, '_tuid', {value:'_tuid', writable: true});\r\n                        f._tuid = tuid = this.getTuid(tuidKey, tuidUrl);\r\n                    }\r\n                    tuid.useId(Number(v), true);\r\n                }*/\r\n                //return Number(v);\r\n        }\r\n    }\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport { Entity } from './entity';\r\nimport { Entities, Field, ArrFields } from './entities';\r\nimport { isNumber } from 'util';\r\nimport { CUsq, CTuidMain, CTuidEdit, CTuidInfo, CTuidSelect } from '../controllers';\r\n\r\nexport class BoxId {\r\n    id: number;\r\n    obj?: any;\r\n    content: (templet?:(values?:any, x?:any)=>JSX.Element, x?:any)=>JSX.Element;\r\n    valueFromFieldName: (fieldName:string)=>BoxId|any;\r\n}\r\n\r\nconst maxCacheSize = 1000;\r\nexport abstract class Tuid extends Entity {\r\n    private BoxId: ()=>void;\r\n    get typeName(): string { return 'tuid';}\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n    private waitingIds: number[] = [];          // 等待loading的\r\n    private cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n    idName: string;\r\n    owner: TuidMain;                    // 用这个值来区分是不是TuidArr\r\n    unique: string[];\r\n    schemaFrom: {owner:string; usq:string};\r\n\r\n    constructor(entities:Entities, name:string, typeId:number) {\r\n        super(entities, name, typeId);\r\n        this.buildIdBoxer();\r\n    }\r\n\r\n    abstract get Main();\r\n\r\n    private buildIdBoxer() {\r\n        this.BoxId = function():void {};\r\n        let prototype = this.BoxId.prototype;\r\n        Object.defineProperty(prototype, '_$tuid', {\r\n            value: this,\r\n            writable: false,\r\n            enumerable: false,\r\n        });\r\n        /*\r\n        prototype.content = function(templet?:(values?:any, x?:any)=>JSX.Element, x?:any) {\r\n            let t:Tuid = this._$tuid;\r\n            let com = templet || this._$com;\r\n            if (com === undefined) {\r\n                com = this._$com = t.entities.usq.getTuidContent(t);\r\n            }\r\n            let val = t.valueFromId(this.id);\r\n            if (typeof val === 'number') val = {id: val};\r\n            if (templet !== undefined) return templet(val, x);\r\n            //return com(val, x);\r\n            return React.createElement(com, val);\r\n        }\r\n        */\r\n        Object.defineProperty(prototype, 'obj', {\r\n            enumerable: false,\r\n            get: function() {\r\n                if (this.id === undefined || this.id<=0) return undefined;\r\n                return this._$tuid.valueFromId(this.id);\r\n            }\r\n        });\r\n        prototype.valueFromFieldName = function(fieldName:string):BoxId|any {\r\n            let t:Tuid = this._$tuid;\r\n            return t.valueFromFieldName(fieldName, this.obj);\r\n        };\r\n        prototype.toJSON = function() {return this.id}\r\n    }\r\n    boxId(id:number):BoxId {\r\n        this.useId(id);\r\n        let ret:BoxId = new this.BoxId();\r\n        ret.id = id;\r\n        return ret;\r\n    }\r\n    getTuidContent() {\r\n        return this.entities.cUsq.getTuidContent(this);\r\n    }\r\n    getIdFromObj(item:any):number {\r\n        return item[this.idName];\r\n    }\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id, unique} = schema;\r\n        this.idName = id;\r\n        this.unique = unique;\r\n        this.schemaFrom = this.schema.from;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        let tId = typeof id;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        let v = this.cache.get(_id);\r\n        if (this.owner !== undefined && typeof v === 'object') {\r\n            v.$owner = this.owner.boxId(v.owner); // this.owner.valueFromId(v.owner);\r\n        }\r\n        return v;\r\n    }\r\n    valueFromFieldName(fieldName:string, obj:any):BoxId|any {\r\n        if (obj === undefined) return;\r\n        let f = this.fields.find(v => v.name === fieldName);\r\n        if (f === undefined) return;\r\n        let v = obj[fieldName];\r\n        let {_tuid} = f;\r\n        if (_tuid === undefined) return v;\r\n        return _tuid.valueFromId(v);\r\n    }\r\n    resetCache(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.useId(id);\r\n    }\r\n    useId(id:number, defer?:boolean) {\r\n        if (id === undefined || id === 0) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.entities.cacheTuids(defer===true?70:20);\r\n        //let idVal = this.createID(id);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        // 如果没有缓冲, 或者没有waiting\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n    async proxied(name:string, id:number):Promise<any> {\r\n        let proxyTuid = this.entities.getTuid(name, undefined);\r\n        proxyTuid.useId(id);\r\n        let proxied = await this.tvApi.proxied(this.name, name, id);\r\n        this.cacheValue(proxied);\r\n        return proxied;\r\n    }\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        //let cacheVal = this.createID(id, val);\r\n        this.cache.set(id, val);\r\n        // 下面的代码应该是cache proxy id, 需要的时候再写吧\r\n        /*\r\n        let {tuids, fields} = this.schema;\r\n        if (tuids !== undefined && fields !== undefined) {\r\n            for (let f of fields) {\r\n                let {name, tuid} = f;\r\n                if (tuid === undefined) continue;\r\n                let t = this.entities.tuid(tuid);\r\n                if (t === undefined) continue;\r\n                t.useId(val[name]);\r\n            }\r\n        }*/\r\n        return true;\r\n    }\r\n    protected afterCacheId(tuidValue:any) {\r\n        for (let f of this.fields) {\r\n            let {_tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            _tuid.useId(tuidValue[f.name]);\r\n        }\r\n    }\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let name:string, arr:string;\r\n        if (this.owner === undefined) {\r\n            name = this.name;\r\n        }\r\n        else {\r\n            name = this.owner.name;\r\n            arr = this.name;\r\n        }\r\n        let api = await this.getApiFrom();\r\n        let tuids = await api.tuidIds(name, arr, this.waitingIds);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n            this.afterCacheId(tuidValue);\r\n        }\r\n    }\r\n    async load(id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        let api = await this.getApiFrom();\r\n        let values = await api.tuidGet(this.name, id);\r\n        if (values === undefined) return;\r\n        values._$tuid = this;\r\n        this.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n    protected getDiv(divName:string):TuidDiv {return;}\r\n    private cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.getDiv(name);\r\n                for (let row of arrValues) {\r\n                    row._$tuid = tuidDiv;\r\n                    row.$owner = this.boxId(row.owner); \r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n    async save(id:number, props:any) {\r\n        let params = _.clone(props);\r\n        params[\"$id\"] = id;\r\n        let ret = await this.tvApi.tuidSave(this.name, params);\r\n        let {id:retId, inId} = ret;\r\n        if (retId === undefined) {\r\n            params.id = id;\r\n            this.cacheValue(params);\r\n        }\r\n        else if (retId > 0) {\r\n            params.id = retId;\r\n            this.cacheValue(params);\r\n        }\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let {fields} = this.schema;\r\n        let name:string, arr:string;\r\n        if (this.owner !== undefined) {\r\n            name = this.owner.name;\r\n            arr = this.name;\r\n        }\r\n        else {\r\n            name = this.name;\r\n            arr = undefined;\r\n        }\r\n        let api = await this.getApiFrom();\r\n        let ret = await api.tuidSearch(name, arr, owner, key, pageStart, pageSize);\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n            if (this.owner !== undefined) row.$owner = this.owner.boxId(row.owner);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        let api = await this.getApiFrom();\r\n        return await api.tuidArrGet(this.name, arr, owner, id);\r\n    }\r\n    /*\r\n    async loadArrAll(owner:number):Promise<any[]> {\r\n        return this.all = await this.tvApi.tuidGetAll(this.name);\r\n    }*/\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        let params = _.clone(props);\r\n        params[\"$id\"] = id;\r\n        return await this.tvApi.tuidArrSave(this.name, arr, owner, params);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        return await this.tvApi.tuidArrPos(this.name, arr, owner, id, order);\r\n    }\r\n    \r\n    // cache放到Tuid里面之后，这个函数不再需要公开调用了\r\n    //private async ids(idArr:number[]) {\r\n    //    return await this.tvApi.tuidIds(this.name, idArr);\r\n    //}\r\n    async showInfo(id:number) {\r\n        await this.entities.cUsq.showTuid(this, id);\r\n    }\r\n}\r\n\r\nexport class TuidMain extends Tuid {\r\n    get Main() {return this}\r\n\r\n    divs: {[name:string]: TuidDiv};\r\n    proxies: {[name:string]: TuidMain};\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.entities, name, this.typeId);\r\n                tuidDiv.owner = this;\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n            }\r\n        }\r\n    }\r\n    protected getDiv(divName:string):TuidDiv {return this.divs[divName];}\r\n    async cacheIds():Promise<void> {\r\n        await super.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) {\r\n            await this.divs[i].cacheIds();\r\n        }\r\n    }\r\n\r\n    async cUsqFrom(): Promise<CUsq> {\r\n        if (this.schemaFrom === undefined) return this.entities.cUsq;\r\n        let {owner, usq} = this.schemaFrom;\r\n        let cUsq = await this.entities.cUsq\r\n        let cApp = cUsq.cApp;\r\n        if (cApp === undefined) return cUsq;\r\n        let cUsqFrm = await cApp.getImportUsq(owner, usq);\r\n        if (cUsqFrm === undefined) {\r\n            console.error(`${owner}/${usq} 不存在`);\r\n            debugger;\r\n            return cUsq;\r\n        }\r\n        let retErrors = await cUsqFrm.loadSchema();\r\n        if (retErrors !== undefined) {\r\n            console.error('cUsq.loadSchema: ' + retErrors);\r\n            debugger;\r\n            return cUsq;\r\n        }\r\n        return cUsqFrm;\r\n    }\r\n\r\n    protected async getApiFrom() {\r\n        let from = await this.from();\r\n        if (from !== undefined) return from.entities.usqApi;\r\n        return this.entities.usqApi;\r\n    }\r\n\r\n    async from(): Promise<TuidMain> {\r\n        let cUsq = await this.cUsqFrom();\r\n        return cUsq.tuid(this.name);\r\n    }\r\n\r\n    async cFrom(): Promise<CTuidMain> {\r\n        let cUsq = await this.cUsqFrom();\r\n        return cUsq.cTuidMainFromName(this.name);\r\n    }\r\n\r\n    async cEditFrom(): Promise<CTuidEdit> {\r\n        let cUsq = await this.cUsqFrom();\r\n        return cUsq.cTuidEditFromName(this.name);\r\n    }\r\n\r\n    async cInfoFrom(): Promise<CTuidInfo> {\r\n        let cUsq = await this.cUsqFrom();\r\n        return cUsq.cTuidInfoFromName(this.name);\r\n    }\r\n\r\n    async cSelectFrom(): Promise<CTuidSelect> {\r\n        let cUsq = await this.cUsqFrom();\r\n        if (cUsq === undefined) return;\r\n        return cUsq.cTuidSelectFromName(this.name);\r\n    }\r\n\r\n    protected afterCacheId(tuidValue:any) {\r\n        super.afterCacheId(tuidValue);\r\n        if (this.proxies === undefined) return;\r\n        let {type, $proxy} = tuidValue;\r\n        let pTuid = this.proxies[type];\r\n        pTuid.useId($proxy);\r\n    }\r\n}\r\n\r\nexport class TuidDiv extends Tuid {\r\n    get Main() {return this.owner}\r\n}\r\n","import {Entity} from './entity';\r\n\r\nexport class Action extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:object) {\r\n        await this.loadSchema();\r\n        let text = this.pack(data);\r\n        return await this.tvApi.action(this.name, {data:text});\r\n    }\r\n}\r\n\r\n","import {observable, IObservableArray} from 'mobx';\r\nimport {Entity} from './entity';\r\nimport { PageItems } from 'tonva-tools';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport class Sheet extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n    states: SheetState[];\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.states = schema.states;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    /*\r\n    private setStateAccess(s:SheetState, s1:SheetState) {\r\n        if (s === undefined) return;\r\n        for (let action of s1.actions) {\r\n            let acn = action.name;\r\n            let ac = s.actions.find(a=>a.name === acn);\r\n            if (ac === undefined) continue;\r\n            s.actions.push(action);\r\n        }\r\n    }*/\r\n    async save(discription:string, data:any):Promise<any> {\r\n        let {appId} = this.entities;\r\n        let text = this.pack(data);\r\n\r\n        let ret = await this.tvApi.sheetSave(this.name, {app: appId, discription: discription, data:text});\r\n        return ret;\r\n        /*\r\n        let {id, state} = ret;\r\n        if (id > 0) this.changeStateCount(state, 1);\r\n        return ret;\r\n        */\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await this.tvApi.sheetAction(this.name, {id:id, flow:flow, state:state, action:action});\r\n    }\r\n    private async unpack(data:any):Promise<any> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<any> {\r\n        let ret = await this.tvApi.getSheet(this.name, id);\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return await this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<any> {\r\n        let ret = await this.tvApi.sheetArchive(this.name, id)\r\n        return await this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        let ret = await this.tvApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let ret = await this.tvApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        let ret:StateCount[] = await this.tvApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n    }\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n    }\r\n}\r\n","import {observable, IObservableArray} from 'mobx';\r\nimport {Field, ArrFields} from './entities';\r\nimport {Entity} from './entity';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\nexport class Query extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    //@observable loaded: boolean;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw 'call resetPage(size:number, params:any) first';\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        this.list = observable.array([], {deep: false});\r\n        let page = data['$page'] as any[];\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    async page(params:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, pageSize+1, params);\r\n        let data = await this.unpackReturns(res);\r\n        return data.$page;// as any[];\r\n    }\r\n    async query(params:any):Promise<any> {\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.query(this.name, params);\r\n        let data = await this.unpackReturns(res);\r\n        return data;\r\n    }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './entities';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; usq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.entities.buildFieldTuid(this.keys = keys);\r\n        //let t = this.schemaStringify();\r\n        for (let i in actions) {\r\n            let schema = actions[i];\r\n            let {name} = schema;\r\n            let action = this.entities.newAction(name, undefined);\r\n            action.setSchema(schema);\r\n            this.actions[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let schema = queries[i];\r\n            let {name} = schema;\r\n            let query = this.entities.newQuery(name, undefined);\r\n            query.setSchema(schema);\r\n            this.queries[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        await this.loadSchema();\r\n        return await this.actions.add.submit(param);\r\n    }\r\n\r\n    async del(param:any) {\r\n        await this.loadSchema();\r\n        return await this.actions.del.submit(param);\r\n    }\r\n\r\n    async all() {\r\n        await this.loadSchema();\r\n        return await this.queries.all.query({});\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        await this.loadSchema();\r\n        return await this.queries.page.page(param, pageStart, pageSize);\r\n    }\r\n\r\n    async query(param:any) {\r\n        await this.loadSchema();\r\n        return await this.queries.query.query(param);\r\n    }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","//import {UsqlApi} from './usqlApi';\r\nimport {TuidMain, Tuid} from './tuid';\r\nimport {Action} from './action';\r\nimport {Sheet, SheetState, SheetAction} from './sheet';\r\nimport {Query} from './query';\r\nimport {Book} from './book';\r\nimport {History} from './history';\r\nimport { UsqApi } from 'tonva-tools';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CUsq } from '../controllers';\r\n\r\n/*\r\nexport interface Usq {\r\n    getTuidContent(tuid:Tuid): React.StatelessComponent<any>;\r\n    showTuid(tuid:Tuid, id:number):Promise<void>;\r\n}\r\n*/\r\n\r\nexport type FieldType = 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text' \r\n    | 'datetime' | 'date' | 'time';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text': \r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    url?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _ownerField: Field;\r\n    _tuid: Tuid;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\n\r\nexport class Entities {\r\n    private tuids: {[name:string]: TuidMain} = {};\r\n    private actions: {[name:string]: Action} = {};\r\n    private sheets: {[name:string]: Sheet} = {};\r\n    private queries: {[name:string]: Query} = {};\r\n    private books: {[name:string]: Book} = {};\r\n    private maps: {[name:string]: Map} = {};\r\n    private histories: {[name:string]: History} = {};\r\n    private pendings: {[name:string]: Pending} = {};\r\n    private cacheTimer: any;\r\n    cUsq: CUsq;\r\n    usqApi: UsqApi;\r\n    appId: number;\r\n    usqId: number;\r\n\r\n    constructor(cUsq: CUsq, usqApi:UsqApi, appId: number) {\r\n        this.cUsq = cUsq;\r\n        this.usqApi = usqApi;\r\n        this.appId = appId;\r\n    }\r\n\r\n    tuid(name:string):TuidMain {return this.tuids[name.toLowerCase()]}\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    tuidArr: TuidMain[] = [];\r\n    actionArr: Action[] = [];\r\n    sheetArr: Sheet[] = [];\r\n    queryArr: Query[] = [];\r\n    bookArr: Book[] = [];\r\n    mapArr: Map[] = [];\r\n    historyArr: History[] = [];\r\n    pendingArr: Pending[] = [];\r\n\r\n    async loadAccess() {\r\n        let accesses = await this.usqApi.loadAccess();\r\n        this.buildEntities(accesses);\r\n    }\r\n\r\n    async loadEntities() {\r\n        let accesses = await this.usqApi.loadEntities();\r\n        this.buildEntities(accesses);\r\n    }\r\n\r\n    private buildEntities(entities:any) {\r\n        let {access, tuids} = entities;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n    }\r\n\r\n    getTuid(name:string, div?:string, tuidUrl?:string): Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid === undefined) return;\r\n        if (div === undefined) return tuid;\r\n        return tuid.divs[div];\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = setTimeout(this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n\r\n    private buildTuids(tuids:any) {\r\n        let proxyColl = {} as any;\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {name, typeId, proxies} = schema;\r\n            let tuid = this.newTuid(i, typeId);\r\n            tuid.sys = true;\r\n            //tuid.setSchema(schema);\r\n            if (proxies !== undefined) proxyColl[i] = proxies;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {name} = schema;\r\n            let tuid = this.getTuid(i);\r\n            //tuid.sys = true;\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in proxyColl) {\r\n            let proxies:string[] = proxyColl[i];\r\n            let tuid = this.tuids[i];\r\n            tuid.proxies = {};\r\n            for (let p of proxies) {\r\n                tuid.proxies[p] = this.tuids[p];\r\n            }\r\n        }\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n        /*\r\n        for (let tuid of this.tuidArr) {\r\n            tuid.setProxies(this);\r\n        }*/\r\n    }\r\n\r\n    newAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    newTuid(name:string, id:number):TuidMain {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        tuid = this.tuids[name] = new TuidMain(this, name, id);\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            case 'usq': this.usqId = id; break;\r\n            case 'tuid': \r\n                let tuid = this.newTuid(name, id);\r\n                tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n            case 'pending': this.newPending(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n        /*\r\n        let states = sheet.states;\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    /*\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }*/\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid, arr, url} = f;\r\n            if (tuid === undefined) continue;\r\n            f._tuid = this.getTuid(tuid, arr, url);\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    throw `owner field ${owner} is undefined`;\r\n                }\r\n            }\r\n            f._ownerField = ownerField;\r\n            let {arr, url} = f;\r\n            f._tuid = this.getTuid(ownerField._tuid.name, arr, url);\r\n            if (f._tuid === undefined) throw 'owner field ${owner} is not tuid';\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n}\r\n","export * from './entities';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Controller } from 'tonva-tools';\r\n\r\nexport abstract class Link {\r\n    abstract onClick: () => void;\r\n    abstract render(className?:string):JSX.Element;\r\n}\r\n\r\nexport class CLink extends Link {\r\n    private controller: Controller;\r\n    protected icon:string|JSX.Element;\r\n    protected label:string|JSX.Element;\r\n\r\n    constructor(controller:Controller) {\r\n        super();\r\n        this.controller = controller;\r\n        this.icon = controller.icon;\r\n        this.label = controller.label;\r\n    }\r\n\r\n    onClick = async () => {\r\n        await this.controller.start();\r\n    }\r\n\r\n    render(className?:string) {\r\n        return React.createElement(this.view, className);\r\n    }\r\n\r\n    protected view = (className?:string) => {\r\n        return <div\r\n            className={classNames('px-3', 'py-2', 'align-items-center', 'cursor-pointer', className)}\r\n            onClick={this.onClick}>\r\n            {this.icon} &nbsp; {this.label}\r\n        </div>;\r\n    }\r\n}\r\n","export * from './cLink';\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { Page, loadAppUsqs, nav, meInFrame, Controller, TypeVPage, VPage, resLang} from 'tonva-tools';\r\nimport { List, LMR, FA } from 'tonva-react-form';\r\nimport { CUsq, EntityType, UsqUI } from './usq';\r\nimport { centerApi } from '../centerApi';\r\n\r\nexport interface AppUI {\r\n    CApp?: typeof CApp;\r\n    CUsq?: typeof CUsq;\r\n    main?: TypeVPage<CApp>;\r\n    usqs: {[usq:string]: UsqUI};\r\n    res?: any;\r\n}\r\n\r\nexport class CApp extends Controller {\r\n    private appOwner:string;\r\n    private appName:string;\r\n    private isProduction:boolean;\r\n    private cImportUsqs: {[usq:string]: CUsq} = {};\r\n    protected ui:AppUI;\r\n    id: number;\r\n    appUnits:any[];\r\n\r\n    constructor(tonvaApp:string, ui?:AppUI) {\r\n        super(resLang(ui && ui.res));\r\n        let parts = tonvaApp.split('/');\r\n        if (parts.length !== 2) {\r\n            throw 'tonvaApp name must be / separated, owner/app';\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.ui = ui || {usqs:{}};\r\n        this.caption = this.res.caption || 'Tonva';\r\n    }\r\n    \r\n    readonly caption: string; // = 'View Model 版的 Usql App';    \r\n    cUsqCollection: {[usq:string]: CUsq} = {};\r\n\r\n    async startDebug() {\r\n        let appName = this.appOwner + '/' + this.appName;\r\n        let cApp = new CApp(appName, {usqs:{}} );\r\n        let keepNavBackButton = true;\r\n        await cApp.start(keepNavBackButton);    \r\n    }\r\n\r\n    protected async loadUsqs(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let unit = meInFrame.unit;\r\n        let app = await loadAppUsqs(this.appOwner, this.appName);\r\n        let {id, usqs} = app;\r\n        this.id = id;\r\n        for (let appUsq of usqs) {\r\n            let {id:usqId, usqOwner, usqName, url, urlDebug, ws, access, token} = appUsq;\r\n            let usq = usqOwner + '/' + usqName;\r\n            let ui = this.ui && this.ui.usqs && this.ui.usqs[usq];\r\n            let cUsq = this.newCUsq(usq, usqId, access, ui || {});\r\n            let retError = await cUsq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n            this.cUsqCollection[usq] = cUsq;\r\n        }\r\n        if (retErrors.length === 0) return;\r\n        return retErrors;\r\n    }\r\n\r\n    async getImportUsq(usqOwner:string, usqName:string):Promise<CUsq> {\r\n        let usq = usqOwner + '/' + usqName;\r\n        let cUsq = this.cImportUsqs[usq];\r\n        if (cUsq !== undefined) return cUsq;\r\n        let ui = this.ui && this.ui.usqs && this.ui.usqs[usq];\r\n        let usqId = -1; // unknown\r\n        this.cImportUsqs[usq] = cUsq = this.newCUsq(usq, usqId, undefined, ui || {});\r\n        let retError = await cUsq.loadSchema();\r\n        if (retError !== undefined) {\r\n            console.error(retError);\r\n            debugger;\r\n            return;\r\n        }\r\n        return cUsq;\r\n    }\r\n\r\n    protected newCUsq(usq:string, usqId:number, access:string, ui:any) {\r\n        let cUsq = new (this.ui.CUsq || CUsq)(this, usq, this.id, usqId, access, ui);        \r\n        Object.setPrototypeOf(cUsq.x, this.x);\r\n        return cUsq;\r\n    }\r\n\r\n    get cUsqArr():CUsq[] {\r\n        let ret:CUsq[] = [];\r\n        for (let i in this.cUsqCollection) {\r\n            ret.push(this.cUsqCollection[i]);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    getCUsq(apiName:string):CUsq {\r\n        return this.cUsqCollection[apiName];\r\n    }\r\n\r\n    protected get VAppMain():TypeVPage<CApp> {return (this.ui&&this.ui.main) || VAppMain}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        console.log('if (await super.beforeStart() === false) return false;');\r\n        if (await super.beforeStart() === false) return false;\r\n        return await this.loadUnits();\r\n    }\r\n\r\n    protected async loadUnits() {\r\n        let date = new Date().getTime();\r\n        try {\r\n            let hash = document.location.hash;\r\n            if (hash.startsWith('#tvdebug')) {\r\n                this.isProduction = false;\r\n            }\r\n            else {\r\n                this.isProduction = hash.startsWith('#tv');\r\n            }\r\n            let {unit} = meInFrame;\r\n            if (this.isProduction === false && (unit===undefined || unit<=0)) {\r\n                let app = await loadAppUsqs(this.appOwner, this.appName);\r\n                nav.logs.push('after loadAppUsqs: ' + (new Date().getTime() - date));\r\n                let {id} = app;\r\n                this.id = id;\r\n                await this.loadAppUnits();\r\n                nav.logs.push('after loadAppUnits: ' + (new Date().getTime() - date));\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport();\r\n                        return false;\r\n                    case 1:\r\n                        unit = this.appUnits[0].id;\r\n                        if (unit === undefined || unit < 0) {\r\n                            this.showUnsupport();\r\n                            return false;\r\n                        }\r\n                        meInFrame.unit = unit;\r\n                        break;\r\n                    default: \r\n                        //nav.clear();\r\n                        nav.push(<this.selectUnitPage />)\r\n                        return false;\r\n                }\r\n            }\r\n\r\n            let retErrors = await this.loadUsqs();\r\n            if (retErrors !== undefined) {\r\n                this.openPage(<Page header=\"ERROR\">\r\n                    <div className=\"m-3\">\r\n                        <div>Load Usqs 发生错误：</div>\r\n                        {retErrors.map((r, i) => <div key={i}>{r}</div>)}\r\n                    </div>\r\n                </Page>);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            nav.push(<Page header=\"App start error!\">\r\n                <pre>\r\n                    {typeof err === 'string'? err : err.message}\r\n                </pre>\r\n            </Page>);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    protected async internalStart(param:any) {\r\n        if (param !== true) {\r\n            this.clearPrevPages();\r\n        }\r\n        await this.showMainPage();\r\n    }\r\n\r\n    private loaded: boolean;\r\n    async load() {\r\n        if (this.loaded === true) return;\r\n        //console.log('await this.beforeStart();');\r\n        //await this.beforeStart();\r\n        //if (await this.beforeStart() === false) return false;\r\n        this.registerReceiveHandler();\r\n        let ret = await this.loadUnits();\r\n        this.loaded = true;\r\n        return ret;\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        return this.renderView(this.VAppMain);\r\n    }\r\n\r\n    // 如果是独立app，删去显示app之前的页面。\r\n    // 如果非独立app，则不删\r\n    protected clearPrevPages() {\r\n        nav.clear();\r\n    }\r\n\r\n    private showUnsupport() {\r\n        this.clearPrevPages();\r\n        this.openPage(<Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-2\">\r\n                        <FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col\">\r\n                        用户不支持APP\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-2\">用户: </div>\r\n                    <div className=\"col\">{`${nav.user.name}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-2\">App:</div>\r\n                    <div className=\"col\">{`${this.appOwner}/${this.appName}`}</div>\r\n                </div>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    private async showMainPage() {\r\n        // #tvRwPBwMef-23-sheet-api-108\r\n        let parts = document.location.hash.split('-');\r\n        if (parts.length > 2) {\r\n            let action = parts[2];\r\n            // sheet_debug 表示centerUrl是debug方式的\r\n            if (action === 'sheet' || action === 'sheet_debug') {\r\n                let usqId = Number(parts[3]);\r\n                let sheetTypeId = Number(parts[4]);\r\n                let sheetId = Number(parts[5]);\r\n                let cUsq = this.getCUsqFromId(usqId);\r\n                if (cUsq === undefined) {\r\n                    alert('unknown usqId: ' + usqId);\r\n                    return;\r\n                }\r\n                this.clearPrevPages();\r\n                await cUsq.navSheet(sheetTypeId, sheetId);\r\n                return;\r\n            }\r\n        }\r\n        this.showVPage(this.VAppMain);\r\n    }\r\n\r\n    private getCUsqFromId(usqId:number): CUsq {\r\n        for (let i in this.cUsqCollection) {\r\n            let cUsq = this.cUsqCollection[i];\r\n            if (cUsq.id === usqId) return cUsq;\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async loadAppUnits() {\r\n        let ret = await centerApi.userAppUnits(this.id);\r\n        this.appUnits = ret;\r\n        if (ret.length === 1) {\r\n            meInFrame.unit = ret[0].id;\r\n        }\r\n    }\r\n\r\n    renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    onRowClick = async (item: any) => {\r\n        meInFrame.unit = item.id; // 25;\r\n        await this.start();\r\n    }\r\n\r\n    /*\r\n    protected appPage = () => {\r\n        return <Page header={this.caption} logout={()=>{meInFrame.unit = undefined}}>\r\n            {this.cUsqArr.map((v,i) => <div key={i}>{v.render()}</div>)}\r\n        </Page>;\r\n    };\r\n    */\r\n    //<LMR className=\"px-3 py-2 my-2 bg-light\"\r\n    //left={<FA name='cog' fixWidth={true} className=\"text-info mr-2 pt-1\" />}\r\n    //onClick={this.opClick}>设置操作权限</LMR>\r\n\r\n    protected selectUnitPage = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <List items={this.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nclass VAppMain extends VPage<CApp> {\r\n    async showEntry(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage() {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={()=>{meInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUsqArr} = this.controller;\r\n        let content:any;\r\n        if (cUsqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的USQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUsqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n","import React from 'react';\r\nimport { FA } from \"tonva-react-form\";\r\n\r\nfunction icon(className:string, name:string) {\r\n    return <FA className={className} name={name} fixWidth={true} />;\r\n}\r\n/*\r\nexport interface EntityRes {\r\n    caption: string;\r\n    icon: JSX.Element;\r\n}\r\n*/\r\n\r\nexport const entityIcons:{[type:string]:JSX.Element} = {\r\n    tuid: icon('text-info', 'list-alt'),\r\n    action: icon('text-info', 'hand-o-right'),\r\n    map: icon('text-muted', 'list-ul'),\r\n    book: icon('text-muted', 'book'),\r\n    query: icon('text-warning', 'search'),\r\n    history: icon('text-info', 'hand-o-right'),\r\n    pending: icon('text-info', 'forward'),\r\n    sheet: icon('text-primary', 'wpforms'),\r\n};\r\n","import { Controller } from \"tonva-tools\";\r\nimport { CUsq } from \"./usq\";\r\n\r\nexport abstract class ControllerUsq extends Controller {\r\n    constructor(cUsq: CUsq, res:any) {\r\n        super(res);\r\n        this.cUsq = cUsq;\r\n    }\r\n    cUsq: CUsq;\r\n}\r\n","import {CenterApi as CenterApiBase} from 'tonva-tools';\r\n\r\n//\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Button, ButtonProps, Badge } from 'reactstrap';\r\nimport { Page } from 'tonva-tools';\r\nimport { List, Muted, LMR } from 'tonva-react-form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { Sheet } from '../../entities';\r\nimport { CSheet, SheetUI } from './cSheet';\r\n\r\nexport class VSheetMain extends VEntity<Sheet, SheetUI, CSheet> {\r\n    async showEntry() {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    newClick = () => this.event('new');\r\n    schemaClick = () => this.event('schema'); \r\n    archivesClick = () => this.event('archives');\r\n    sheetStateClick = (state) => this.event('state', state);\r\n\r\n    renderState = (item:any, index:number) => {\r\n        let {state, count} = item;\r\n        if (count === 0) return null;\r\n        let badge = <Badge className=\"ml-5 align-self-end\" color=\"success\">{count}</Badge>;\r\n        return <LMR className=\"px-3 py-2\" left={this.controller.getStateLabel(state)} right={badge} />;\r\n    }\r\n\r\n    protected view = observer(() => {\r\n        let list = this.controller.statesCount.filter(row=>row.count);\r\n        let right = <button className=\"btn btn-outline-primary\" onClick={this.archivesClick}>已归档</button>;\r\n        let templet;\r\n        if (this.isDev === true) {\r\n            templet = <button className=\"btn btn-primary mr-2\" color=\"primary\" onClick={this.schemaClick}>模板</button>;\r\n        }\r\n        return <Page header={this.label}>\r\n            <LMR\r\n                className=\"mx-3 my-2\"\r\n                right={right}>\r\n                <button className=\"btn btn-primary mr-2\" color=\"primary\" onClick={this.newClick}>新建</button>\r\n                {templet}\r\n            </LMR>\r\n            <List className=\"my-2\"\r\n                header={<Muted className=\"mx-3 my-1\">待处理{this.label}</Muted>}\r\n                none=\"[ 无 ]\"\r\n                items={list}\r\n                item={{render:this.renderState, onClick:this.sheetStateClick}} />\r\n        </Page>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva-tools';\r\nimport { FA } from 'tonva-react-form';\r\nimport { Sheet } from '../../entities';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { SheetUI, CSheet } from './cSheet';\r\n\r\nexport class VSheetNew extends VEntity<Sheet, SheetUI, CSheet> {\r\n    vForm: VForm;\r\n\r\n    async showEntry(param?:any) {\r\n        this.vForm = this.createForm(this.onSubmit, param);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    private onSubmit = async ():Promise<void> => {\r\n        let values = this.vForm.getValues();\r\n        let valuesWithBox = this.vForm.values;\r\n        //let ret = \r\n        await this.controller.onSave(values, valuesWithBox);\r\n        /*\r\n        this.ceasePage();\r\n        //this.openPage(this.finishedPage);\r\n        await this.controller.showSaved(ret);\r\n        */\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        {this.vForm.render()}\r\n    </Page>;\r\n}\r\n","import * as React from 'react';\r\nimport {List, Muted, LMR, EasyDate, FA} from 'tonva-react-form';\r\nimport { Sheet } from '../../entities';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CSheet, SheetUI, SheetData } from './cSheet';\r\n\r\nconst leftFlowStyle = {width: '8rem'};\r\n\r\nexport abstract class VSheetView extends VEntity<Sheet, SheetUI, CSheet> {\r\n    protected vForm: VForm;\r\n    protected sheetData: SheetData;\r\n    //data: any;\r\n    //state: string;\r\n    //flows:any[];\r\n\r\n    flowRow = (item:any, index:number):JSX.Element => {\r\n        let {date, user, preState, state, action} = item;\r\n        if (action === undefined) action = <><FA className=\"text-primary\" name=\"pencil-square-o\" /> 制单</>;\r\n        let to;\r\n        switch (state) {\r\n            case '$': break;\r\n            case '#': to = <><FA className=\"text-success\" name=\"file-archive-o\" /></>; break;\r\n            default: to = <><FA className=\"text-muted\" name=\"arrow-right\" /> &nbsp; {state}</>; break;\r\n        }\r\n        /*\r\n        return <div className=\"row\">\r\n            <div className=\"col-sm\"></div>\r\n            <div className=\"col-sm\"><div className=\"p-2\">{to}</div></div>\r\n            <div className=\"col-sm text-right\"><div className=\"p-2\"><Muted><EasyDate date={date} /></Muted></div></div>\r\n        </div>;\r\n        */\r\n        return <LMR \r\n            left={<div className=\"pl-3 py-2\" style={leftFlowStyle}>{action}</div>}\r\n            right={<div className=\"p-2\"><Muted><EasyDate date={date} /></Muted></div>}>\r\n            <div className=\"p-2\">{to}</div>\r\n        </LMR>;\r\n    }\r\n\r\n    protected sheetView = () => {\r\n        let {brief, flows} = this.sheetData;\r\n        let removed;\r\n        if (brief.state === '-')\r\n            removed = <div className=\"mx-3 my-2\" style={{color:'red'}}>本单据作废</div>;\r\n        return <div>\r\n            {removed}\r\n            {this.vForm.render()}\r\n    \r\n            <List header={<Muted className=\"mx-3 my-1\">流程</Muted>}\r\n                items={flows}\r\n                item={{render:this.flowRow}}/>\r\n        </div>;\r\n    };\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva-tools';\r\nimport { VForm, FormMode } from '../form';\r\nimport { VSheetView } from './vSheetView';\r\nimport { SheetData } from './cSheet';\r\n\r\nexport class VSheetEdit extends VSheetView { //VEntity<Sheet, SheetUI, CSheet> {\r\n    protected sheetData: SheetData;\r\n    async showEntry(param: SheetData) {\r\n        this.sheetData = param;\r\n        this.vForm = this.createForm(this.onSubmit, param.data, FormMode.edit);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    onSubmit = async ():Promise<void> => {\r\n        let values = this.vForm.getValues();\r\n        await this.controller.saveSheet(values, this.vForm.values);\r\n        this.closePage();\r\n        this.returnCall(this.vForm.values);\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        {this.vForm.render()}\r\n    </Page>;\r\n}\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Button } from 'reactstrap';\r\nimport { nav, Page } from 'tonva-tools';\r\nimport { VSheetView } from './vSheetView';\r\nimport { SheetData } from './cSheet';\r\nimport { FA } from 'tonva-react-form';\r\n\r\nexport class VSheetAction extends VSheetView { \r\n    async showEntry(sheetData:SheetData) {\r\n        this.sheetData = sheetData;\r\n        //let {brief, data, flows} = await this.controller.getSheetData(sheetId);\r\n        //this.brief = brief;\r\n        //this.flows = flows;\r\n        //this.data = data;\r\n        //this.state = this.brief.state;\r\n        this.vForm = this.createForm(undefined, sheetData.data);\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    actionClick = async (action:any) => {\r\n        let {id, flow, state} = this.sheetData.brief;\r\n        let res = await this.controller.action(id, flow, state, action.name);\r\n        this.ceasePage();\r\n        this.openPage(this.acted);\r\n        //alert(jsonStringify(res));\r\n        //await this.backPage();\r\n    }\r\n\r\n    deleteClick = async () => {\r\n        alert('单据作废：程序正在设计中');\r\n    }\r\n\r\n    editClick = async () => {\r\n        //alert('修改单据：程序正在设计中');\r\n        let values = await this.controller.editSheet(this.sheetData);\r\n        this.vForm.setValues(values);\r\n    }\r\n\r\n    protected page = () => {\r\n        let {brief} = this.sheetData;\r\n        let {state, no} = brief;\r\n        let stateLabel = this.controller.getStateLabel(state);\r\n        let {states} = this.entity;\r\n        let s = states.find(v => v.name === state);\r\n        let actionButtons, startButtons;\r\n        if (s === undefined) {\r\n            let text:string, cn:string;\r\n            switch (state) {\r\n                default:\r\n                    text = '不认识的单据状态\\'' + state + '\\'';\r\n                    cn = 'text-info';\r\n                    break;\r\n                case '-': \r\n                    text = '已作废';\r\n                    cn = 'text-danger';\r\n                    break;\r\n                case '#':\r\n                    text = '已归档';\r\n                    cn = 'text-success';\r\n                    break;\r\n            }\r\n            actionButtons = <div className={classNames(cn)}>[{text}]</div>;\r\n        }\r\n        else {\r\n            actionButtons = <div className=\"flex-grow-1\">{s.actions.map((v,index) => \r\n                <Button\r\n                    key={index}\r\n                    className=\"mr-2\"\r\n                    color=\"primary\"\r\n                    onClick={()=>this.actionClick(v)}\r\n                >\r\n                    {this.controller.getActionLabel(state, v.name)}\r\n                </Button>)}\r\n            </div>;\r\n            if (state === '$') {\r\n                startButtons = <div>\r\n                    <Button outline={true} className=\"ml-2\" color=\"info\" onClick={this.editClick}>修改</Button>\r\n                    <Button outline={true} className=\"ml-2\" color=\"danger\" onClick={this.deleteClick}>作废</Button>\r\n                </div>\r\n            }\r\n        };\r\n        return <Page header={this.label + ':' + stateLabel + '-' + no}>\r\n            <div className=\"mb-2\">\r\n                <div className=\"d-flex px-3 py-2 border-bottom bg-light\">\r\n                    {actionButtons}\r\n                    {startButtons}\r\n                </div>\r\n                <this.sheetView />\r\n            </div>\r\n        </Page>;\r\n    }\r\n\r\n    private acted = () => {\r\n        let {discription} = this.sheetData.brief;\r\n        return <Page header=\"已处理\" back=\"close\">\r\n            <div className=\"p-3 d-flex flex-column align-items-center\">\r\n                <div className=\"p-3\">{discription}</div>\r\n                <div className=\"text-success\"><FA name=\"check-circle-o\" /> 单据已处理！</div>\r\n                <div className=\"p-3\">\r\n                    <button className=\"btn btn-outline-info\" onClick={()=>this.backPage()}>返回</button>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva-tools';\r\nimport { VEntity } from '../CVEntity';\r\nimport { Sheet } from '../../entities';\r\nimport { SheetUI, CSheet } from './cSheet';\r\n\r\nexport class VSheetSchema extends VEntity<Sheet, SheetUI, CSheet> {\r\n    async showEntry(param?:any) {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected view = () => <Page header={this.label + \"模板\"}>\r\n        <pre className=\"mx-3 my-2\">{this.entity.schemaStringify()}</pre>\r\n    </Page>;\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva-tools';\r\nimport {List, LMR, FA, EasyDate, Muted} from 'tonva-react-form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { Sheet } from '../../entities';\r\nimport { SheetUI, CSheet } from './cSheet';\r\n\r\nexport class VArchives extends VEntity<Sheet, SheetUI, CSheet> {\r\n    list: any[];\r\n\r\n    async showEntry() {\r\n        this.list = await this.entity.getArchives(undefined, 10);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    archiveClick = async (brief:any) => {\r\n        if (brief.processing===1) return;\r\n        this.event('archived', brief);\r\n    }\r\n    archiveRow = (row:any, index:number) => {\r\n        let {id, no, discription, date} = row;\r\n        let left = <>\r\n            {row.processing===1? '... ' : ''}\r\n            {row.no} &nbsp; {row.discription}\r\n        </>;\r\n        let right = <Muted><EasyDate date={date} /></Muted>;\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right} />\r\n    }\r\n\r\n    protected view = () => {\r\n        return <Page header={'已归档' + this.label}>\r\n            <List items={this.list} item={{render:this.archiveRow, onClick:this.archiveClick}} />\r\n        </Page>;\r\n    };\r\n}\r\n","import * as React from 'react';\r\nimport { Page, nav } from 'tonva-tools';\r\nimport { List, Muted, FA, LMR, EasyDate } from 'tonva-react-form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { Sheet } from '../../entities';\r\nimport { CSheet, SheetUI } from './cSheet';\r\n\r\nexport class VSheetList extends VEntity<Sheet, SheetUI, CSheet> {\r\n    protected row: (values) => JSX.Element;\r\n    stateName: string;\r\n    stateLabel: string;\r\n\r\n    async showEntry(item:any) {\r\n        this.row = this.ui.listRow || this.rowContent;\r\n        this.stateName = item.state;\r\n        this.stateLabel = this.controller.getStateLabel(this.stateName);\r\n        //await this.controller.getStateSheets(this.stateName, 0, 10);\r\n        await this.controller.pageStateItems.first(this.stateName);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    rowClick = async (brief:any) => {\r\n        if (brief.processing===1) {\r\n            this.event('processing', brief.id);\r\n            return;\r\n        }\r\n        this.event('action', brief.id);\r\n    }\r\n\r\n    private onScrollBottom = () => {\r\n        console.log('onScrollBottom');\r\n        this.controller.pageStateItems.more();\r\n    }\r\n\r\n    protected rowContent = (row:any):JSX.Element => {\r\n        let {id, no, discription, date, processing} = row;\r\n        let left = <>            \r\n            {no} &nbsp; <Muted>{discription}</Muted> {processing===1? '...' : ''}\r\n        </>;\r\n        let right = <Muted><EasyDate date={date} /></Muted>;\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right} />;\r\n    }\r\n\r\n    private renderRow = (row:any, index:number) => <this.row {...row} />\r\n\r\n    protected view = () => {\r\n        //let sheets = this.controller.stateSheets;\r\n        let {pageStateItems} = this.controller;\r\n        return <Page header={this.label + ' - ' + this.stateLabel} onScrollBottom={this.onScrollBottom}>\r\n            <List items={pageStateItems} item={{render:this.renderRow, onClick:this.rowClick}} />\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {Page} from 'tonva-tools';\r\nimport { VSheetView } from './vSheetView';\r\nimport { CSheet, SheetUI, SheetData } from './cSheet';\r\n\r\nexport interface State {\r\n    flows: any;\r\n    data: any;\r\n}\r\nexport class VArchived extends VSheetView {\r\n    //protected controller: CSheet;\r\n    //brief: any;\r\n\r\n    async showEntry(sheetData:SheetData) {\r\n        this.sheetData = sheetData;\r\n        /*\r\n        let {brief, data, flows} = await this.controller.getArchived(inBrief.id);\r\n        this.brief = brief;\r\n        this.data = data;\r\n        this.flows = flows;\r\n        */\r\n        this.vForm = this.createForm(undefined, this.sheetData.data);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected view = () => {\r\n        let {brief} = this.sheetData;\r\n        return <Page header={this.label + ':' + '-' + brief.no}>\r\n            <this.sheetView />\r\n        </Page>;\r\n    };\r\n}\r\n","import { Sheet } from \"../../entities\";\r\nimport { SheetUI, CSheet } from \"./cSheet\";\r\nimport { VEntity } from \"../CVEntity\";\r\n\r\nexport abstract class VSheet extends VEntity<Sheet, SheetUI, CSheet> {\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva-tools';\r\nimport { FA } from 'tonva-react-form';\r\nimport { VSheet } from \"./vSheet\";\r\n\r\nexport class VSheetSaved extends VSheet {\r\n    private brief: any;\r\n    async showEntry(brief?:any) {\r\n        this.brief = brief;\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    private restart = async () => {\r\n        this.ceasePage();\r\n        await this.event('new');\r\n    }\r\n\r\n    actionClick = async (action:any) => {\r\n        this.ceasePage();\r\n        let {id, flow, state} = this.brief;\r\n        let res = await this.controller.action(id, flow, state, action.name);\r\n        this.openPage(this.acted);\r\n    }\r\n\r\n    private buttons = <>\r\n        <button className=\"btn btn-outline-primary mr-3\" onClick={this.restart}>继续开单</button>\r\n        <button className=\"btn btn-outline-info\" onClick={()=>this.backPage()}>返回</button>\r\n    </>;\r\n\r\n    private view = () => {\r\n        let {states} = this.entity;\r\n        const state = '$';\r\n        let s = states.find(v => v.name === state);\r\n        let actionButtons = <>{s.actions.map((v,index) => \r\n            <button\r\n                key={index}\r\n                className=\"btn btn-primary mr-3\"\r\n                onClick={()=>this.actionClick(v)}\r\n            >\r\n                {this.controller.getActionLabel(state, v.name)}\r\n            </button>)}\r\n        </>;\r\n        return <Page header=\"已保存\" back=\"close\">\r\n            <div className=\"p-3 d-flex flex-column align-items-center\">\r\n                <div className=\"text-success\"><FA name=\"check-circle-o\" /> 单据已保存！系统尚未处理</div>\r\n                <div className=\"p-3\">\r\n                    {actionButtons}\r\n                    {this.buttons}\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n\r\n    private acted = () => {\r\n        return <Page>\r\n            <div className=\"p-3 d-flex flex-column align-items-center\">\r\n                <div className=\"text-success\"><FA name=\"check-circle-o\" /> 单据已处理！</div>\r\n                <div className=\"p-3\">\r\n                    {this.buttons}\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Button } from 'reactstrap';\r\nimport { nav, Page } from 'tonva-tools';\r\nimport { VSheetView } from './vSheetView';\r\nimport { SheetData } from './cSheet';\r\nimport { FA } from 'tonva-react-form';\r\n\r\nexport class VSheetProcessing extends VSheetView { \r\n    async showEntry(sheetData:SheetData) {\r\n        this.sheetData = sheetData;\r\n        //let {brief, data, flows} = await this.controller.getSheetData(sheetId);\r\n        //this.brief = brief;\r\n        //this.flows = flows;\r\n        //this.data = data;\r\n        //this.state = this.brief.state;\r\n        this.vForm = this.createForm(undefined, sheetData.data);\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    protected page = () => {\r\n        let {brief} = this.sheetData;\r\n        let {state, no} = brief;\r\n        let stateLabel = this.controller.getStateLabel(state);\r\n        return <Page header={this.label + ':' + stateLabel + '-' + no}>\r\n            <div className=\"mb-2\">\r\n                <div className=\"d-flex px-3 py-2 border-bottom bg-light\">\r\n                    正在处理中...\r\n                </div>\r\n                <this.sheetView />\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n","import { IObservableArray, observable } from \"mobx\";\r\nimport { TypeVPage, VPage, PageItems, postWsToTop } from 'tonva-tools';\r\nimport { Sheet, StateCount } from \"../../entities\";\r\nimport { CEntity, EntityUI, VEntity } from \"../CVEntity\";\r\nimport { VSheetMain } from \"./vMain\";\r\nimport { VSheetNew } from \"./vNew\";\r\nimport { VSheetEdit } from \"./vEdit\";\r\nimport { VSheetAction } from \"./vSheetAction\";\r\nimport { VSheetSchema } from \"./vSchema\";\r\nimport { VArchives } from \"./vArchives\";\r\nimport { VSheetList } from \"./vList\";\r\nimport { VArchived } from \"./vArchived\";\r\nimport { VSheetSaved } from \"./vSaved\";\r\nimport { VSheetProcessing } from \"./vSheetProcessing\";\r\n\r\nexport interface SheetActionUI {\r\n    label: string;\r\n}\r\n\r\nexport interface StateUI {\r\n    label: string;\r\n    actions: {[name:string]: SheetActionUI}\r\n}\r\n\r\nexport interface SheetUI extends EntityUI {\r\n    CSheet?: typeof CSheet;\r\n    states?: {[name:string]: StateUI};\r\n    main?: TypeVPage<CSheet>;\r\n    sheetNew?: TypeVPage<CSheet>;\r\n    sheetSaved?: TypeVPage<CSheet>;\r\n    sheetEdit?: TypeVPage<CSheet>;\r\n    sheetAction?: TypeVPage<CSheet>;\r\n    listRow?: (row:any) => JSX.Element;\r\n    sheetTitle?: (sheetValues:any, x:any) => string;      // 返回单据的描述\r\n}\r\n\r\nexport interface SheetData {\r\n    brief: any;\r\n    data: any;\r\n    flows: any[];\r\n}\r\n\r\nexport class CSheet extends CEntity<Sheet, SheetUI> {\r\n    statesCount:IObservableArray<StateCount> = observable.array<StateCount>([], {deep:true});\r\n    curState:string;\r\n    pageStateItems: PageItems<any>;\r\n\r\n    protected async internalStart() {\r\n        await this.loadStateSheetCount();\r\n        this.pageStateItems = this.entity.createPageStateItems();\r\n        await this.showVPage(this.VSheetMain);\r\n    }\r\n\r\n    protected async onMessage(msg: any):Promise<void> {\r\n        let {type, body, from, to, push} = msg;\r\n        if (type === 'sheet') this.onSheet(from, to, body);\r\n    }\r\n    private onSheet(from:number, to:number[], sheetData:any) {\r\n        let me = this.user.id;\r\n        let {id, preState, state} = sheetData;\r\n        console.log({$:'onMessage sheet', from:from, to:to.join(','), id:id, preState:preState, state:state, me:me, sheetData:sheetData})\r\n        if (from === me) {\r\n            this.sheetActPreState(id, preState);\r\n        }\r\n        if (to.find(v=>v===me) !== undefined) {\r\n            this.sheetActState(id, state, sheetData);\r\n        }\r\n    }\r\n    private sheetActPreState(id:number, preState:string) {\r\n        this.changeStateCount(preState, -1);\r\n        if (this.curState === undefined || this.curState !== preState) return;\r\n        /*\r\n        let index = this.stateSheets.findIndex(v => v.id === id);\r\n        if (index>=0) {\r\n            this.stateSheets.splice(index, 1);\r\n        }*/\r\n        let index = this.pageStateItems.items.findIndex(v => v.id === id);\r\n        if (index>=0) {\r\n            this.pageStateItems.items.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    private sheetActState(id:number, state:string, msg:any) {\r\n        this.changeStateCount(state, 1);\r\n        if (this.curState === undefined || this.curState !== state) return;\r\n        /*\r\n        if (this.stateSheets.findIndex(v => v.id === id) < 0) {\r\n            this.stateSheets.push(msg);\r\n        }\r\n        */\r\n        if (this.pageStateItems.items.findIndex(v => v.id === id) < 0) {\r\n            this.pageStateItems.items.push(msg);\r\n        }\r\n    }\r\n\r\n    private changeStateCount(state:string, delta:number) {\r\n        if (state === undefined) return;\r\n        let index = this.statesCount.findIndex(v => v.state === state);\r\n        console.log({$:'changeState', state: state, delta: delta, index: index});\r\n        if (index < 0) return;\r\n        let stateCount = this.statesCount[index];\r\n        stateCount.count += delta;\r\n        if (stateCount.count < 0) stateCount.count = 0;\r\n    }\r\n\r\n    protected get VSheetMain():TypeVPage<CSheet> {return (this.ui&&this.ui.main) || VSheetMain}\r\n    protected get VSheetNew(): TypeVPage<CSheet> {return this.ui.sheetNew || VSheetNew}\r\n    protected get VSheetSaved(): TypeVPage<CSheet> {return this.ui.sheetSaved || VSheetSaved}\r\n    protected get VSheetEdit(): TypeVPage<CSheet> {return this.ui.sheetEdit || VSheetEdit}\r\n    protected get VSheetSchema(): TypeVPage<CSheet> {return VSheetSchema}\r\n    protected get VArchives(): TypeVPage<CSheet> {return VArchives}\r\n    protected get VArchived(): TypeVPage<CSheet> {return VArchived}\r\n    protected get VSheetList(): TypeVPage<CSheet> {return VSheetList}\r\n    protected get VSheetAction(): TypeVPage<CSheet> {return this.ui.sheetAction || VSheetAction}\r\n    protected get VSheetProcessing(): TypeVPage<CSheet> {return VSheetProcessing}\r\n    protected async onEvent(type:string, value:any) {\r\n        let c: TypeVPage<CSheet>;\r\n        switch (type) {\r\n            default: return;\r\n            case 'new': c = this.VSheetNew; break;\r\n            case 'schema': c = this.VSheetSchema; break;\r\n            case 'archives': c = this.VArchives; break;\r\n            case 'state':\r\n                this.curState = value.state;\r\n                c = this.VSheetList;\r\n                break;\r\n            case 'archived':\r\n                await this.showArchived(value); return;\r\n            case 'action':\r\n                await this.showAction(value); return;\r\n            case 'processing':\r\n                await this.showProcessing(value); return;\r\n        }\r\n        await this.showVPage(c, value);\r\n    }\r\n\r\n    async startSheet(sheetId:number) {\r\n        if (await this.beforeStart() === false) return;\r\n        await this.onEvent('action', sheetId);\r\n    }\r\n\r\n    async showAction(sheetId:number) {\r\n        let sheetData:SheetData = await this.getSheetData(sheetId);\r\n        postWsToTop({\r\n            body: {\r\n                $type: 'msg',\r\n                action: '$sheet',\r\n                msg: {\r\n                    id: sheetId,\r\n                    usq: this.cUsq.id,\r\n                    state: sheetData.brief.state\r\n                }\r\n            }\r\n        });\r\n        await this.showVPage(this.VSheetAction, sheetData);\r\n    }\r\n\r\n    async showProcessing(sheetId:number) {\r\n        let sheetData:SheetData = await this.getSheetData(sheetId);\r\n        await this.showVPage(this.VSheetProcessing, sheetData);\r\n    }\r\n\r\n    async editSheet(sheetData:SheetData):Promise<any> {\r\n        //alert('修改单据：程序正在设计中');\r\n        let values = await this.vCall(this.VSheetEdit, sheetData);\r\n        return values;\r\n    }\r\n\r\n    async showArchived(inBrief:any) {\r\n        let sheetData = await this.getArchived(inBrief.id);\r\n        await this.showVPage(this.VArchived, sheetData);\r\n    }\r\n\r\n    onSave = async (values:any, valuesWithBox:any):Promise<void> => {\r\n        //let values = this.vForm.getValues();\r\n        //let ret = await this.controller.saveSheet(values, this.vForm.values);\r\n        let ret = await this.saveSheet(values, valuesWithBox);\r\n        this.ceasePage();\r\n        //this.openPage(this.finishedPage);\r\n        await this.showSaved(ret);\r\n    }\r\n\r\n    async showSaved(sheetData:any) {\r\n        await this.showVPage(this.VSheetSaved, sheetData);\r\n    }\r\n\r\n    private getStateUI(stateName:string) {\r\n        let {states} = this.res;\r\n        if (states === undefined) return;\r\n        return states[stateName];\r\n    }\r\n    getStateLabel(stateName:string) {\r\n        let state = this.getStateUI(stateName);\r\n        let ret = (state && state.label) || stateName;\r\n        switch (ret) {\r\n            default: return ret;\r\n            case '$': return '新单';\r\n        }\r\n    }\r\n    getActionLabel(stateName:string, actionName:string) {\r\n        let state = this.getStateUI(stateName);\r\n        if (state === undefined) return actionName;\r\n        let actions = state.actions;\r\n        if (actions === undefined) return actionName;\r\n        let action = actions[actionName];\r\n        return (action && action.label) || actionName;\r\n    }\r\n\r\n    private async loadStateSheetCount():Promise<void> {\r\n        this.statesCount.clear();\r\n        let statesCount = await this.entity.stateSheetCount();\r\n        this.statesCount.splice(0, 0, ...statesCount);\r\n    }\r\n\r\n    async getSheetData(sheetId:number):Promise<SheetData> {\r\n        return await this.entity.getSheet(sheetId);\r\n    }\r\n\r\n    async getArchived(sheetId:number):Promise<SheetData> {\r\n        return await this.entity.getArchive(sheetId);\r\n    }\r\n\r\n    async saveSheet(values:any, valuesWithBox:any):Promise<any> {\r\n        let {sheetTitle} = this.ui;\r\n        let disc = sheetTitle === undefined? this.label : sheetTitle(valuesWithBox, this.x);\r\n        let ret = await this.entity.save(disc, values);\r\n        //let {id, state} = ret;\r\n        //if (id > 0) this.changeStateCount(state, 1);\r\n        return ret;\r\n    }\r\n\r\n    async action(id:number, flow:number, state:string, actionName:string):Promise<any> {\r\n        return await this.entity.action(id, flow, state, actionName);\r\n    }\r\n}\r\n","export * from './cSheet';\r\nexport * from './vSheet';\r\nexport * from './vMain';\r\nexport * from './vNew';\r\nexport * from './vEdit';\r\nexport * from './vList';\r\nexport * from './vSheetAction';\r\nexport * from './vSchema';\r\nexport * from './vArchived';\r\nexport * from './vSheetView';\r\n","import * as React from 'react';\r\nimport { SearchBox, List, Muted } from 'tonva-react-form';\r\nimport { Button } from 'reactstrap';\r\nimport { TuidMain, Entity } from '../../entities';\r\nimport { Page } from 'tonva-tools';\r\nimport { CLink } from '../link';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CTuidMain, TuidUI } from './cTuid';\r\n\r\nexport class VTuidMain extends VEntity<TuidMain, TuidUI, CTuidMain> {\r\n    protected controller: CTuidMain;\r\n    onNew = () => this.event('new');\r\n    onList = () => this.event('list');\r\n    onSearch = async (key:string) => this.event('list', key);\r\n\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected entityRender(link: CLink, index: number): JSX.Element {\r\n        return link.render();\r\n    }\r\n\r\n    protected async entityClick(link: CLink) {\r\n        await link.onClick();\r\n    }\r\n\r\n    protected get view() {\r\n        let {label, proxyLinks, isFrom} = this.controller;\r\n        let newButton;\r\n        if (isFrom === false) newButton = <Button className=\"ml-3\" color=\"primary\" onClick={this.onNew}>新增</Button>;\r\n        return () => <Page header={label}>\r\n            {proxyLinks === undefined ?\r\n            <>\r\n                <SearchBox className=\"w-100\" onSearch={this.onSearch} placeholder={'搜索'+label} />\r\n                <div className='my-3'>\r\n                    {newButton}\r\n                    <Button className=\"ml-3\" color=\"primary\" onClick={this.onList}>列表</Button>\r\n                </div>\r\n            </> :\r\n            <List className=\"my-2\"\r\n                header={<Muted>{label} 代理下列Tuid</Muted>}\r\n                items={proxyLinks}\r\n                item={{render: this.entityRender, onClick:this.entityClick}} />\r\n            }\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { FA } from 'tonva-react-form';\r\nimport { Button } from 'reactstrap';\r\nimport { Page } from 'tonva-tools';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CTuidMain, TuidUI } from './cTuid';\r\nimport { TuidMain, Tuid } from '../../entities';\r\n\r\nexport type TypeVTuidEdit = typeof VTuidEdit;\r\n\r\nexport class VTuidEdit extends VEntity<Tuid, TuidUI, CTuidMain> {\r\n    private vForm: VForm;\r\n    private id: number;\r\n\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.vForm = this.createForm(this.onSubmit, param);\r\n        if (param !== undefined) {\r\n            this.id = param.id;\r\n        }\r\n        this.openPage(this.editView);\r\n    }\r\n\r\n    protected get editView() {\r\n        return () => <Page header={(this.id===undefined? '新增':'编辑') + ' - ' + this.label}>\r\n            {this.vForm.render('py-3')}\r\n        </Page>;\r\n    }\r\n\r\n    protected next = async () => {\r\n        this.vForm.reset();\r\n        this.closePage();\r\n    }\r\n\r\n    protected finish = () => {\r\n        this.closePage(2);\r\n        this.event('edit-end');\r\n    }\r\n\r\n    protected resetForm() {\r\n        this.vForm.reset();\r\n    }\r\n\r\n    protected onSubmit = async () => {\r\n        let values = this.vForm.getValues();\r\n        let ret = await this.controller.entity.save(this.id, values);\r\n        let {id} = ret;\r\n        if (id < 0) {\r\n            let {unique} = this.controller.entity;\r\n            if (unique !== undefined) {\r\n                for (let u of unique) {\r\n                    this.vForm.setError(u, '不能重复');\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        if (this.controller.isCalling) {\r\n            this.returnCall(id);\r\n            this.closePage();\r\n            return;\r\n        }\r\n        this.openPageElement(<Page header={this.label + '提交成功'} back=\"none\">\r\n            <div className='m-3'>\r\n                <span className=\"text-success\">\r\n                    <FA name='check-circle' size='lg' /> 成功提交！\r\n                </span>\r\n                <div className='mt-5'>\r\n                    <Button className=\"mr-3\" color=\"primary\" onClick={this.next}>继续录入</Button>\r\n                    <Button color=\"primary\" outline={true} onClick={this.finish}>不继续</Button>\r\n                </div>\r\n            </div>\r\n        </Page>);\r\n\r\n        this.event('item-changed', {id: this.id, values: values});\r\n        return;\r\n    }\r\n\r\n    //protected view = TuidNewPage;\r\n}\r\n/*\r\nconst TuidNewPage = observer(({vm}:{vm:VmTuidEdit}) => {\r\n    let {label, id, vmForm} = vm;\r\n    return <Page header={(id===undefined? '新增':'编辑') + ' - ' + label}>\r\n        {vmForm.render('mx-3 my-2')}\r\n    </Page>;\r\n});\r\n*/","import { nav, Page } from 'tonva-tools';\r\nimport { VTuidMainListBase, VTuidDivListBase } from './vTuidList';\r\nimport { VEntity } from '../CVEntity';\r\nimport { Tuid } from '../../entities';\r\nimport { CTuid, TuidUI } from './cTuid';\r\nimport { SearchBox, List } from 'tonva-react-form';\r\nimport React from 'react';\r\nimport { RowContent } from '../form/viewModel';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VTuidSelect extends VEntity<Tuid, TuidUI, CTuid<Tuid>> {\r\n    protected mainRowContent: (row:any) => JSX.Element;\r\n    protected divRowContent: (row:any) => JSX.Element;\r\n\r\n    async showEntry(param?:any): Promise<void> {\r\n        if (param === undefined)\r\n            await this.showMain(param);\r\n        else\r\n            await this.showDiv(param);\r\n    }\r\n\r\n    private async showMain(param) {\r\n        this.mainRowContent = this.ui.rowContent || RowContent;\r\n        await this.controller.searchMain(param);\r\n        this.openPage(this.mainView);\r\n    }\r\n\r\n    private async showDiv(ownerValue: any) {\r\n        let {divs} = this.ui;\r\n        if (divs !== undefined) {\r\n            this.divRowContent = divs[this.entity.name].rowContent;\r\n        }\r\n        if (this.divRowContent === undefined) {\r\n            this.divRowContent = RowContent;\r\n        }\r\n        let divItems = await this.controller.getDivItems(ownerValue);\r\n        this.openPage(this.divView, {items: divItems});\r\n    }\r\n\r\n    protected mainView = observer(() => {\r\n        let header = <SearchBox className=\"mx-1 w-100\"\r\n            initKey={''}\r\n            onSearch={this.onSearchMain} placeholder={'搜索'+this.label} />;\r\n        return <Page header={header} back=\"close\">\r\n            <List\r\n                items={this.controller.PageItems.items}\r\n                item={{render: this.renderMainRow, onClick: this.clickMainRow}}\r\n                before={'搜索'+this.label+'资料'} />\r\n        </Page>;\r\n    });\r\n\r\n    onSearchMain = async (key:string) => {\r\n        await this.controller.searchMain(key);\r\n        //await this.PageItems.first(key);\r\n    }\r\n    renderMainRow = (item:any, index:number):JSX.Element => <this.mainRowContent {...item} />;\r\n    clickMainRow = async (item:any) => {\r\n        this.ceasePage();\r\n        if (this.controller.entity.owner === undefined) {\r\n            this.returnCall(item);\r\n            return;\r\n        }\r\n        await this.showDiv(this.entity.getIdFromObj(item));\r\n    }\r\n\r\n    protected divView = (param:any) => {\r\n        return <Page header=\"选择Div\">\r\n            <List\r\n                items={param.items}\r\n                item={{render: this.renderDivRow, onClick: this.clickDivRow}} />\r\n        </Page>;\r\n    }\r\n    renderDivRow = (item:any, index:number):JSX.Element => <this.divRowContent {...item} />;\r\n    clickDivRow = (item:any) => {\r\n        this.ceasePage();\r\n        this.returnCall(item);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { FA } from 'tonva-react-form';\r\nimport { Button } from 'reactstrap';\r\nimport { Page } from 'tonva-tools';\r\nimport { jsonStringify } from '../../tools';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { TuidMain } from '../../entities';\r\nimport { TuidUI, CTuidMain } from './cTuid';\r\n\r\nexport type TypeVTuidView = typeof VTuidView;\r\n\r\nexport class VTuidView extends VEntity<TuidMain, TuidUI, CTuidMain> {\r\n    vForm: VForm;\r\n    id: number;\r\n\r\n    protected buildForm(param:any) {\r\n        this.vForm = this.createForm(undefined, param);\r\n    }\r\n\r\n    async showEntry(param:any) {\r\n        this.buildForm(param);\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    render(param:any) {\r\n        this.buildForm(param);\r\n        return this.vForm.render();\r\n    }\r\n\r\n    async loadId(id: number) {\r\n        this.id = id;\r\n    }\r\n\r\n    protected next = async () => {\r\n        this.vForm.reset();\r\n        this.closePage();\r\n    }\r\n\r\n    protected finish = () => {\r\n        this.closePage(2);\r\n    }\r\n\r\n    protected resetForm() {\r\n        this.vForm.reset();\r\n    }\r\n\r\n    protected onSubmit = async () => {\r\n        let values = this.vForm.getValues();\r\n        let ret = await this.entity.save(this.id, values);\r\n        if (ret) {\r\n            alert('这里还要判断返回值，先不处理了 \\n' + jsonStringify(ret));\r\n        }\r\n        this.openPage(() => <Page header={this.label + '提交成功'} back=\"none\">\r\n            <div className='m-3'>\r\n                <span className=\"text-success\">\r\n                    <FA name='check-circle' size='lg' /> 成功提交！\r\n                </span>\r\n                <div className='mt-5'>\r\n                    <Button className=\"mr-3\" color=\"primary\" onClick={this.next}>继续录入</Button>\r\n                    <Button color=\"primary\" outline={true} onClick={this.finish}>不继续</Button>\r\n                </div>\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n            {this.vForm.render('py-3')}\r\n    </Page>;\r\n}\r\n","import React from 'react';\r\nimport { VTuidView } from './vTuidView';\r\n\r\nexport class VTuidInfo  extends VTuidView {\r\n/*\r\n    async showEntry(param?:any) {\r\n        this.open(this.view);\r\n    }\r\n*/\r\n/*\r\n    private view = () => {\r\n        return <Page>\r\n            TuidInfo\r\n        </Page>\r\n    }\r\n*/\r\n}\r\n","import { PageItems } from 'tonva-tools';\r\nimport { Tuid } from \"../../entities\";\r\n\r\nexport class TuidPageItems<T> extends PageItems<T> {\r\n    private tuid: Tuid;\r\n    constructor(tuid: Tuid) {\r\n        super(true);\r\n        this.tuid = tuid;\r\n    }\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.tuid.search(param, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { FA, SearchBox, List } from 'tonva-react-form';\r\nimport { Page, PageItems } from 'tonva-tools';\r\nimport { jsonStringify } from '../../tools';\r\nimport { TuidMain, Entity, Tuid, TuidDiv } from '../../entities';\r\nimport { VEntity } from '../CVEntity';\r\nimport { TuidUI, CTuidMain, CTuidDiv } from './cTuid';\r\nimport { JSONContent, RowContent } from '../form/viewModel';\r\n\r\nexport abstract class VTuidMainListBase  extends VEntity<TuidMain, TuidUI, CTuidMain> {\r\n    protected rowContent: (row:any) => JSX.Element;\r\n    protected ownerId: number;\r\n\r\n    async showEntry(param?:any) {\r\n        this.rowContent = this.ui.rowContent || RowContent;\r\n        if (this.entity.owner !== undefined) this.ownerId = Number(param);\r\n        // 初始查询, key是空的\r\n        //await this.onSearch('');\r\n        await this.controller.searchMain('');\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    onSearch = async (key:string) => {\r\n        await this.controller.searchMain(key);\r\n        //await this.PageItems.first(key);\r\n    }\r\n    renderRow = (item:any, index:number):JSX.Element => <this.rowContent {...item} />;\r\n\r\n    protected abstract onSelected(item:any): Promise<void>;\r\n    private callOnSelected(item:any) {\r\n        if (this.onSelected === undefined) {\r\n            alert('onSelect is undefined');\r\n            return;\r\n        }\r\n        this.onSelected(item);\r\n    }\r\n    clickRow = (item:any) => {\r\n        this.callOnSelected(item);\r\n    }\r\n    private rowKey = (item:any) => {\r\n        let {id} = item;\r\n        return id;\r\n    }\r\n    protected view = observer(() => {\r\n        let header = <SearchBox className=\"mx-1 w-100\"\r\n            initKey={''}\r\n            onSearch={this.onSearch} placeholder={'搜索'+this.label} />;\r\n        let {owner} = this.entity;\r\n        let ownerTop;\r\n        if (owner !== undefined) {\r\n            let ownerObj = owner.valueFromId(this.ownerId);\r\n            ownerTop = <div>owner: {jsonStringify(ownerObj)}</div>;\r\n        }\r\n        return <Page header={header}>\r\n            {ownerTop}\r\n            <List\r\n                items={this.controller.PageItems.items}\r\n                item={{render: this.renderRow, onClick: this.clickRow, key:this.rowKey}}\r\n                before={'搜索'+this.label+'资料'} />\r\n        </Page>;\r\n    });\r\n}\r\n\r\nexport class VTuidMainList extends VTuidMainListBase {\r\n    protected async onSelected(item:any) {\r\n        if (this.controller.isFrom === false)\r\n            this.event('edit', item.id);\r\n        else\r\n            this.event('info', item.id);\r\n    }\r\n}\r\n\r\nexport abstract class VTuidDivListBase  extends VEntity<TuidDiv, TuidUI, CTuidDiv> {\r\n    protected ownerId: number;\r\n\r\n    async showEntry(param?:any) {\r\n        //this.PageItems = new TuidPageItems(this.entity);\r\n        if (this.entity.owner !== undefined) this.ownerId = Number(param);\r\n        // 初始查询, key是空的\r\n        //await this.onSearch('');\r\n        await this.controller.searchMain('');\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    onSearch = async (key:string) => {\r\n        await this.controller.searchMain(key);\r\n        //await this.PageItems.first(key);\r\n    }\r\n    renderRow = (item:any, index:number):JSX.Element => {\r\n        return <div className=\"px-3 py-2\">{jsonStringify(item)}</div>;\r\n    }\r\n\r\n    protected abstract onSelected(item:any): Promise<void>;\r\n    private callOnSelected(item:any) {\r\n        if (this.onSelected === undefined) {\r\n            alert('onSelect is undefined');\r\n            return;\r\n        }\r\n        this.onSelected(item);\r\n    }\r\n    clickRow = (item:any) => {\r\n        this.callOnSelected(item);\r\n    }\r\n\r\n    protected view = observer(() => {\r\n        let header = <SearchBox className=\"mx-1 w-100\"\r\n            initKey={''}\r\n            onSearch={this.onSearch} placeholder={'搜索'+this.label} />;\r\n        let {owner} = this.entity;\r\n        let ownerTop;\r\n        if (owner !== undefined) {\r\n            let ownerObj = owner.valueFromId(this.ownerId);\r\n            ownerTop = <div>owner: {jsonStringify(ownerObj)}</div>;\r\n        }\r\n        return <Page header={header}>\r\n            {ownerTop}\r\n            <List\r\n                items={this.controller.PageItems.items}\r\n                item={{render: this.renderRow, onClick: this.clickRow}}\r\n                before={'搜索'+this.label+'资料'} />\r\n        </Page>;\r\n    });\r\n}\r\n\r\nexport class VTuidDivList extends VTuidDivListBase {\r\n    protected async onSelected(item:any) {\r\n        this.event('edit', item.id);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { TypeVPage, PageItems } from 'tonva-tools';\r\nimport { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { TuidMain, Tuid, TuidDiv } from \"../../entities\";\r\nimport { VTuidMain } from './vTuidMain';\r\nimport { VTuidEdit } from './vTuidEdit';\r\nimport { VTuidSelect } from './vTuidSelect';\r\nimport { CUsq } from \"../usq/cUsq\";\r\nimport { CLink } from \"../link\";\r\nimport { VTuidInfo } from \"./vTuidInfo\";\r\nimport { TuidPageItems } from \"./pageItems\";\r\nimport { VTuidMainList } from './vTuidList';\r\n\r\nexport interface TuidUI extends EntityUI {\r\n    CTuidMain?: typeof CTuidMain;\r\n    CTuidEdit?: typeof CTuidEdit;\r\n    CTuidList?: typeof CTuidList;\r\n\r\n    CTuidSelect?: typeof CTuidSelect;\r\n    CTuidInfo?: typeof CTuidInfo;\r\n    inputContent?: React.StatelessComponent<any>;\r\n    rowContent?: React.StatelessComponent<any>;\r\n    divs?: {\r\n        [div:string]: {\r\n            CTuidSelect?: typeof CTuidSelect;\r\n            inputContent?: React.StatelessComponent<any>;\r\n            rowContent?: React.StatelessComponent<any>;\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class CTuid<T extends Tuid> extends CEntity<T, TuidUI> {\r\n    /*\r\n    constructor(cUsq: CUsq, entity: T, ui: TuidUI, res) {\r\n        super(cUsq, entity, ui, res);\r\n    }*/\r\n\r\n    PageItems:PageItems<any>;\r\n\r\n    protected buildPageItems():PageItems<any> {\r\n        return new TuidPageItems(this.entity.owner || this.entity);\r\n    }\r\n\r\n    async searchMain(key:string) {\r\n        if (this.PageItems === undefined) {\r\n            this.PageItems = this.buildPageItems();\r\n        }\r\n        if (key !== undefined) await this.PageItems.first(key);\r\n    }\r\n\r\n    async getDivItems(ownerId:number):Promise<any[]> {\r\n        let ret = await this.entity.searchArr(ownerId, undefined, 0, 1000);\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class CTuidMain extends CTuid<TuidMain> {\r\n    constructor(cUsq: CUsq, entity: TuidMain, ui: TuidUI, res:any) {\r\n        super(cUsq, entity, ui, res);\r\n        let tuid = this.entity;\r\n        this.proxies = tuid.proxies;\r\n        if (this.proxies !== undefined) {\r\n            this.proxyLinks = [];\r\n            for (let i in this.proxies) {\r\n                let link = this.cUsq.linkFromName('tuid', i);\r\n                this.proxyLinks.push(link);\r\n            }\r\n        }\r\n    }\r\n\r\n    async from():Promise<CTuidMain> {\r\n        let ret = await this.entity.cFrom();\r\n        if (ret === undefined) return this;\r\n        return ret;\r\n    }\r\n\r\n    async cUsqFrom():Promise<CUsq> {\r\n        return await this.entity.cUsqFrom();\r\n    }\r\n    async cEditFrom(): Promise<CTuidEdit> {\r\n        let cUsq = await this.entity.cUsqFrom();\r\n        return await cUsq.cTuidEditFromName(this.entity.name);\r\n    }\r\n    async cInfoFrom(): Promise<CTuidInfo> {\r\n        let cUsq = await this.entity.cUsqFrom();\r\n        return await cUsq.cTuidInfoFromName(this.entity.name);\r\n    }\r\n    async cSelectFrom(): Promise<CTuidSelect> {\r\n        let cUsq = await this.entity.cUsqFrom();\r\n        return await cUsq.cTuidSelectFromName(this.entity.name);\r\n    }\r\n\r\n    getLable(tuid:Tuid):string {\r\n        if (tuid === this.entity) return this.label;\r\n        let {name} = tuid;\r\n        let {arrs} = this.res;\r\n        if (arrs !== undefined) {\r\n            let arr = arrs[name];\r\n            if (arr !== undefined) {\r\n                let label = arr.label;\r\n                if (label !== undefined) return label;\r\n            }\r\n        }\r\n        return name;\r\n    }\r\n\r\n    proxies: {[name:string]: TuidMain};\r\n    proxyLinks: CLink[];\r\n    isFrom: boolean;\r\n\r\n    protected get VTuidMain():typeof VTuidMain {return VTuidMain}\r\n    protected get VTuidEdit():typeof VTuidEdit {return VTuidEdit}\r\n    protected get VTuidList():typeof VTuidMainList {return VTuidMainList}\r\n\r\n    protected async internalStart(param?:any):Promise<void> {\r\n        this.isFrom = this.entity.schemaFrom !== undefined;\r\n        await this.showVPage(this.VTuidMain);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n        let v: TypeVPage<CTuidMain>;\r\n        switch (type) {\r\n            default: return;\r\n            case 'new': v = this.VTuidEdit; break;\r\n            case 'list': v = this.VTuidList; break;\r\n            case 'edit': await this.edit(value); return;\r\n            case 'item-changed': this.itemChanged(value); return;\r\n            case 'info': \r\n                let cTuidInfo = new CTuidInfo(this.cUsq, this.entity, this.ui, this.res);\r\n                await cTuidInfo.start(value);\r\n                return;\r\n        }\r\n        await this.showVPage(v, value);\r\n    }\r\n\r\n    protected async edit(id:number) {\r\n        let values:any = undefined;\r\n        if (id !== undefined) {\r\n            values = await this.entity.load(id);\r\n        }\r\n        let v = this.VTuidEdit;\r\n        await this.showVPage(v, values);\r\n    }\r\n\r\n    private itemChanged({id, values}:{id:number, values: any}) {\r\n        if (this.PageItems === undefined) return;\r\n        let items = this.PageItems.items;\r\n        let item = items.find(v => v.id === id);\r\n        if (item !== undefined) {\r\n            _.merge(item, values);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CTuidEdit extends CTuidMain {\r\n    protected async internalStart(id:number):Promise<void> {\r\n        await this.edit(id);\r\n    }\r\n}\r\n\r\nexport class CTuidList extends CTuidMain {\r\n    protected async internalStart(id:number):Promise<void> {\r\n        await this.showVPage(this.VTuidList);\r\n    }\r\n}\r\n\r\nexport class CTuidDiv extends CTuid<TuidDiv> {\r\n    protected async internalStart():Promise<void> {\r\n        alert('tuid div: ' + this.entity.name);\r\n    }\r\n}\r\n\r\nexport class CTuidSelect extends CTuid<Tuid> {\r\n    protected async internalStart(param?: any):Promise<void> {\r\n        await this.showVPage(this.VTuidSelect, param);\r\n    }\r\n    protected async beforeStart():Promise<boolean> {\r\n        if (await super.beforeStart() === false) return false;\r\n        if (this.PageItems !== undefined) this.PageItems.reset();\r\n        return true;\r\n    }\r\n    protected get VTuidSelect():typeof VTuidSelect {return VTuidSelect}\r\n    idFromItem(item:any) {\r\n        return item.id;\r\n    }\r\n}\r\n\r\nexport class CTuidInfo extends CTuid<Tuid> {\r\n    protected async internalStart(id: any):Promise<void> {\r\n        let data = await this.entity.load(id)\r\n        await this.showVPage(this.VTuidInfo, data);\r\n    }\r\n    protected get VTuidInfo():typeof VTuidInfo {return VTuidInfo}\r\n}\r\n","export * from './cTuid';\r\nexport * from './vTuidMain';\r\nexport * from './vTuidEdit';\r\nexport * from './vTuidInfo';\r\nexport * from './vTuidView';\r\n","import * as React from 'react';\r\nimport { TuidMain, Book, Entity } from '../../entities';\r\nimport { Page } from 'tonva-tools';\r\nimport { VEntity } from '../CVEntity';\r\nimport { CBook, BookUI } from './cBook';\r\n\r\nexport class VBookMain extends VEntity<Book, BookUI, CBook> {\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        Book\r\n    </Page>;\r\n}\r\n","import { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { Book } from \"../../entities\";\r\nimport { VBookMain } from \"./vBookMain\";\r\n\r\nexport interface BookUI extends EntityUI {\r\n    CBook?: typeof CBook;\r\n    main: typeof VBookMain,\r\n}\r\n\r\nexport class CBook extends CEntity<Book, BookUI> {\r\n    protected async internalStart() {\r\n        await this.showVPage(this.VBookMain);\r\n    }\r\n\r\n    protected get VBookMain():typeof VBookMain {return VBookMain}\r\n}\r\n","import React from \"react\";\r\nimport { View } from \"tonva-tools\";\r\nimport { List, Muted } from \"tonva-react-form\";\r\nimport { Entity } from \"../../entities\";\r\nimport { CLink } from \"../link\";\r\nimport { CUsq } from \"./cUsq\";\r\n\r\nexport class VUsq extends View<CUsq> {\r\n    protected isSysVisible = false;\r\n    protected tuidLinks: CLink[];\r\n    protected mapLinks: CLink[];\r\n    protected sheetLinks: CLink[];\r\n    protected actionLinks: CLink[];\r\n    protected queryLinks: CLink[];\r\n    protected bookLinks: CLink[];\r\n    protected historyLinks: CLink[];\r\n    protected pendingLinks: CLink[];\r\n\r\n    constructor(cUsq: CUsq) {\r\n        super(cUsq);\r\n        let {tuidArr, mapArr, sheetArr, actionArr, queryArr, bookArr, historyArr, pendingArr} = cUsq.entities;\r\n        this.tuidLinks = tuidArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cTuidMain(v)));\r\n        this.mapLinks = mapArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cMap(v)));\r\n        this.sheetLinks = sheetArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cSheet(v)));\r\n        this.actionLinks = actionArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cAction(v)));\r\n        this.queryLinks = queryArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cQuery(v)));\r\n        this.bookLinks = bookArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cBook(v)));\r\n        this.historyLinks = historyArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cHistory(v)));\r\n        this.pendingLinks = pendingArr.filter(v => this.isVisible(v)).map(v => new CLink(this.controller.cPending(v)));\r\n    }\r\n    protected isVisible(entity: Entity):boolean {\r\n        return entity.sys !== true || this.isSysVisible;\r\n    }\r\n    render(param?:any) {\r\n        if (this.view === undefined) return <div>??? viewModel 必须定义 view ???</div>\r\n        return React.createElement(this.view);\r\n    }\r\n\r\n    protected view = () => {\r\n        let {res, usq, error} = this.controller;\r\n        let linkItem = {\r\n            render: (cLink:CLink, index:number):JSX.Element => cLink.render(), \r\n            onClick: undefined, \r\n        };\r\n        let lists = [\r\n            {\r\n                header: res.tuid || 'TUID',\r\n                items: this.tuidLinks,\r\n            },\r\n            {\r\n                cn: 'my-2',\r\n                header: res.map || 'MAP',\r\n                items: this.mapLinks,\r\n            },\r\n            {\r\n                cn: 'my-2',\r\n                header: res.sheet || 'SHEET',\r\n                items: this.sheetLinks\r\n            },\r\n            {\r\n                cn: 'my-2',\r\n                header: res.action || 'ACTION',\r\n                items: this.actionLinks\r\n            },\r\n            {\r\n                cn: 'my-2',\r\n                header: res.query || 'QUERY',\r\n                items: this.queryLinks\r\n            },\r\n            {\r\n                cn: 'mt-2 mb-4',\r\n                header: res.book || 'BOOK',\r\n                items: this.bookLinks\r\n            },\r\n            {\r\n                cn: 'mt-2 mb-4',\r\n                header: res.history || 'HISTORY',\r\n                items: this.historyLinks\r\n            },\r\n            {\r\n                cn: 'mt-2 mb-4',\r\n                header: res.pending || 'PENDING',\r\n                items: this.pendingLinks\r\n            }\r\n        ];\r\n        let content;\r\n        if (error !== undefined) {\r\n            content = <div className=\"p-3 text-danger\">连接错误: {error}</div>;\r\n        }\r\n        else {\r\n            content = lists.map(({cn, header, items},index) => items.length > 0 && <List\r\n                key={index}\r\n                className={cn}\r\n                header={<div className=\"px-3 py-1 bg-light\"><Muted>{header}</Muted></div>}\r\n                items={items}\r\n                item={linkItem} />\r\n            );\r\n        }\r\n        return <>\r\n            <div className=\"px-3 py-1 small\">{res.usq || usq}</div>\r\n            {content}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { UsqApi, Controller, UnitxApi, meInFrame, resLang, nav } from 'tonva-tools';\r\nimport { Entities, TuidMain, Action, Sheet, Query, Book, Map, Entity, Tuid, /*Usq, */History, Pending } from '../../entities';\r\nimport { CLink } from '../link';\r\nimport { CBook, BookUI } from '../book';\r\nimport { CSheet, SheetUI } from '../sheet';\r\nimport { ActionUI, CAction } from '../action';\r\nimport { QueryUI, CQuery, CQuerySelect } from '../query';\r\nimport { CTuidMain, TuidUI, CTuid, CTuidInfo, CTuidSelect, CTuidEdit, CTuidList } from '../tuid';\r\nimport { MapUI, CMap } from '../map';\r\nimport { CEntity, EntityUI } from '../CVEntity';\r\nimport { PureJSONContent } from '../form/viewModel';\r\nimport { VUsq } from './vUsq';\r\nimport { CHistory, HistoryUI } from '../history';\r\nimport { CPending, PendingUI } from '../pending';\r\nimport { CApp } from '../CApp';\r\n\r\nexport type EntityType = 'sheet' | 'action' | 'tuid' | 'query' | 'book' | 'map' | 'history' | 'pending';\r\n\r\nexport interface UsqUI {\r\n    CTuidMain?: typeof CTuidMain;\r\n    CTuidEdit?: typeof CTuidEdit;\r\n    CTuidList?: typeof CTuidList;\r\n    CTuidSelect?: typeof CTuidSelect;\r\n    CTuidInfo?: typeof CTuidInfo;\r\n    CQuery?: typeof CQuery;\r\n    CQuerySelect?: typeof CQuerySelect;\r\n    CMap?: typeof CMap;\r\n    CAction?: typeof CAction;\r\n    CSheet?: typeof CSheet;\r\n    CBook?: typeof CBook;\r\n    CHistory?: typeof CHistory;\r\n    CPending?: typeof CPending;\r\n    tuid?: {[name:string]: TuidUI};\r\n    sheet?: {[name:string]: SheetUI};\r\n    action?: {[name:string]: ActionUI};\r\n    map?: {[name:string]: MapUI};\r\n    query?: {[name:string]: QueryUI};\r\n    book?: {[name:string]: BookUI};    \r\n    history?: {[name:string]: HistoryUI};\r\n    pending?: {[name:string]: PendingUI};\r\n    res?: any;\r\n}\r\n\r\nfunction lowerPropertyName(entities: {[name:string]: EntityUI}) {\r\n    if (entities === undefined) return;\r\n    for (let i in entities) entities[i.toLowerCase()] = entities[i];\r\n}\r\n\r\nexport class CUsq extends Controller /* implements Usq*/ {\r\n    private ui:any;\r\n    private CTuidMain: typeof CTuidMain;\r\n    private CTuidEdit: typeof CTuidEdit;\r\n    private CTuidList: typeof CTuidList;\r\n    private CTuidSelect: typeof CTuidSelect;\r\n    private CTuidInfo: typeof CTuidInfo;\r\n    private CQuery: typeof CQuery;\r\n    private CQuerySelect: typeof CQuerySelect;\r\n    private CMap: typeof CMap;\r\n    private CAction: typeof CAction;\r\n    private CSheet: typeof CSheet;\r\n    private CBook: typeof CBook;\r\n    private CHistory: typeof CHistory;\r\n    private CPending: typeof CPending;\r\n\r\n    constructor(cApp:CApp, usq:string, appId:number, usqId:number, access:string, ui:UsqUI) {\r\n        super(resLang(ui.res));\r\n        this.cApp = cApp;\r\n        this.usq = usq;\r\n        this.id = usqId;\r\n        // 每一个ui都转换成小写的key的版本\r\n        lowerPropertyName(ui.tuid);\r\n        lowerPropertyName(ui.sheet);\r\n        lowerPropertyName(ui.map);\r\n        lowerPropertyName(ui.query);\r\n        lowerPropertyName(ui.action);\r\n        lowerPropertyName(ui.book);\r\n        lowerPropertyName(ui.history);\r\n        lowerPropertyName(ui.pending);\r\n        this.ui = ui;\r\n        this.CTuidMain = ui.CTuidMain || CTuidMain;\r\n        this.CTuidEdit = ui.CTuidEdit || CTuidEdit;\r\n        this.CTuidList = ui.CTuidList || CTuidList;\r\n        this.CTuidSelect = ui.CTuidSelect || CTuidSelect;\r\n        this.CTuidInfo = ui.CTuidInfo || CTuidInfo;\r\n        this.CQuery = ui.CQuery || CQuery;\r\n        this.CQuerySelect = ui.CQuerySelect || CQuerySelect;\r\n        this.CMap = ui.CMap || CMap;\r\n        this.CAction = ui.CAction || CAction;\r\n        this.CSheet = ui.CSheet || CSheet;\r\n        this.CBook = ui.CBook || CBook;\r\n        this.CHistory = ui.CHistory || CHistory;\r\n        this.CPending = ui.CPending || CPending;\r\n\r\n        let token = undefined;\r\n        let usqOwner:string, usqName:string;\r\n        let p = usq.split('/');\r\n        switch (p.length) {\r\n            case 1:\r\n                usqOwner = '$$$';\r\n                usqName = p[0];\r\n                break;\r\n            case 2:\r\n                usqOwner = p[0];\r\n                usqName = p[1];\r\n                break;\r\n            default:\r\n                console.log('usq must be usqOwner/usqName format');\r\n                return;\r\n        }\r\n\r\n        let hash = document.location.hash;\r\n        let baseUrl = hash===undefined || hash===''? \r\n            'debug/':'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        let usqApi:UsqApi;\r\n        if (usq === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            usqApi = new UnitxApi(meInFrame.unit);\r\n        }\r\n        else {\r\n            usqApi = new UsqApi(baseUrl, usqOwner, usqName, acc, true);\r\n        }\r\n        this.entities = new Entities(this, usqApi, appId);\r\n    }\r\n\r\n    protected async internalStart() {\r\n    }\r\n\r\n    cApp:CApp;\r\n    usq: string;\r\n    id: number;\r\n    res: any;\r\n    entities:Entities;\r\n    error: string;\r\n    private schemaLoaded:boolean = false;\r\n\r\n    protected async loadEntites() {\r\n        await this.entities.loadAccess();\r\n    }\r\n\r\n    async loadSchema():Promise<string> {\r\n        try {\r\n            if (this.schemaLoaded === true) return;\r\n            await this.loadEntites();\r\n            if (this.id === undefined) this.id = this.entities.usqId;\r\n\r\n            for (let i in this.ui) {\r\n                let g = this.ui[i];\r\n                if (g === undefined) continue;\r\n                let {caption, collection} = g;\r\n                if (collection === undefined) continue;\r\n                for (let j in collection) {\r\n                    if (this.entities[i](j) === undefined) {\r\n                        console.warn(i + ':' + '\\'' + j + '\\' is not usql entity');\r\n                    }\r\n                }\r\n            }\r\n            this.schemaLoaded = true;\r\n            return;\r\n        }\r\n        catch(err) {\r\n            console.error(err);\r\n            return this.error = err;\r\n            //debugger;\r\n            //return err.message;\r\n        }\r\n    }\r\n\r\n    async getQuerySearch(name:string):Promise<Query> {\r\n        let query = this.entities.query(name);\r\n        if (query === undefined) \r\n            alert(`QUERY ${name} 没有定义!`);\r\n        else {\r\n            await query.loadSchema();\r\n            let {returns} = query;\r\n            if (returns.length > 1) {\r\n                alert(`QUERY ${name} 返回多张表, 无法做QuerySearch`);\r\n            }\r\n        }\r\n        return query;\r\n    }\r\n    getTuidPlaceHolder(tuid:Tuid) {\r\n        let {tuidPlaceHolder, entity} = this.res;\r\n        let {name} = tuid;\r\n        let type:string;\r\n        if (entity !== undefined) {\r\n            let en = entity[name];\r\n            if (en !== undefined) {\r\n                type = en.label;\r\n            }\r\n        }\r\n        return (tuidPlaceHolder || 'Select');\r\n    }\r\n    getNone() {\r\n        let {none} = this.res;\r\n        return none || 'none';\r\n    }\r\n    protected isSysVisible = false;\r\n    protected isVisible(entity: Entity):boolean {\r\n        return entity.sys !== true || this.isSysVisible;\r\n    }\r\n\r\n    async navSheet(sheetTypeId:number, sheetId:number) {\r\n        let sheet = this.entities.sheetFromTypeId(sheetTypeId);\r\n        if (sheet === undefined) {\r\n            alert('sheetTypeId ' + sheetTypeId + ' is not exists!');\r\n            return;\r\n        }\r\n        let cSheet = this.cSheet(sheet);\r\n        await cSheet.startSheet(sheetId);\r\n    }\r\n\r\n    sheet(entityName:string) {return this.entities.sheet(entityName);}\r\n    action(entityName:string) {return this.entities.action(entityName);}\r\n    query(entityName:string) {return this.entities.query(entityName);}\r\n    book(entityName:string) {return this.entities.book(entityName);}\r\n    map(entityName:string) {return this.entities.map(entityName);}\r\n    history(entityName:string) {return this.entities.history(entityName);}\r\n    pending(entityName:string) {return this.entities.pending(entityName);}\r\n    tuid(entityName:string) {return this.entities.tuid(entityName)}\r\n    tuidDiv(entityName:string, divName:string) {\r\n        let tuid = this.entities.tuid(entityName);\r\n        if (tuid === undefined) return;\r\n        let {divs} = tuid;\r\n        if (divs === undefined) return;\r\n        return divs[divName];\r\n    }\r\n\r\n    cSheetFromName(entityName:string):CSheet {\r\n        let entity = this.entities.sheet(entityName);\r\n        if (entity !== undefined) return this.cSheet(entity);\r\n    }\r\n    cActionFromName(entityName:string) {\r\n        let entity = this.entities.action(entityName);\r\n        if (entity !== undefined) return this.cAction(entity);\r\n    }\r\n    cQueryFromName(entityName:string) {\r\n        let entity = this.entities.query(entityName);\r\n        if (entity !== undefined) return this.cQuery(entity);\r\n    }\r\n    cBookFromName(entityName:string) {\r\n        let entity = this.entities.book(entityName);\r\n        if (entity !== undefined) return this.cBook(entity);\r\n    }\r\n    cMapFromName(entityName:string) {\r\n        let entity = this.entities.map(entityName);\r\n        if (entity !== undefined) return this.cMap(entity);\r\n    }\r\n    cHistoryFromName(entityName:string) {\r\n        let entity = this.entities.history(entityName);\r\n        if (entity !== undefined) return this.cHistory(entity);\r\n    }\r\n    cPendingFromName(entityName:string) {\r\n        let entity = this.entities.pending(entityName);\r\n        if (entity !== undefined) return this.cPending(entity);\r\n    }\r\n    cTuidMainFromName(entityName:string) {\r\n        let entity = this.entities.tuid(entityName);\r\n        if (entity !== undefined) return this.cTuidMain(entity);\r\n    }\r\n    cTuidEditFromName(entityName:string) {\r\n        let entity = this.entities.tuid(entityName);\r\n        if (entity !== undefined) return this.cTuidEdit(entity);\r\n    }\r\n    cTuidInfoFromName(entityName:string) {\r\n        let entity = this.entities.tuid(entityName);\r\n        if (entity !== undefined) return this.cTuidInfo(entity);\r\n    }\r\n\r\n    cTuidSelectFromName(entityName:string) {\r\n        let entity = this.entities.tuid(entityName);\r\n        if (entity !== undefined) return this.cTuidSelect(entity);\r\n    }\r\n\r\n    cFromName(entityType:EntityType, entityName:string): CEntity<Entity, EntityUI> {\r\n        switch (entityType) {\r\n            case 'sheet':\r\n                let sheet = this.entities.sheet(entityName);\r\n                if (sheet === undefined) return;\r\n                return this.cSheet(sheet);\r\n            case 'action':\r\n                let action = this.entities.action(entityName);\r\n                if (action === undefined) return;\r\n                return this.cAction(action);\r\n            case 'tuid':\r\n                let tuid = this.entities.tuid(entityName);\r\n                if (tuid === undefined) return;\r\n                return this.cTuidMain(tuid);\r\n            case 'query':\r\n                let query = this.entities.query(entityName);\r\n                if (query === undefined) return;\r\n                return this.cQuery(query);\r\n            case 'book':\r\n                let book = this.entities.book(entityName);\r\n                if (book === undefined) return;\r\n                return this.cBook(book);\r\n            case 'map':\r\n                let map = this.entities.map(entityName);\r\n                if (map === undefined) return;\r\n                return this.cMap(map);\r\n            case 'history':\r\n                let history = this.entities.history(entityName);\r\n                if (history === undefined) return;\r\n                return this.cHistory(history);\r\n            case 'pending':\r\n                let pending = this.entities.pending(entityName);\r\n                if (pending === undefined) return;\r\n                return this.cPending(pending);\r\n        }\r\n    }\r\n\r\n    linkFromName(entityType:EntityType, entityName:string) {\r\n        return this.link(this.cFromName(entityType, entityName));\r\n    }\r\n\r\n    private getUI<T extends Entity, UI extends EntityUI>(t:T):{ui:UI, res:any} {\r\n        let ui, res;\r\n        let {name, typeName} = t;\r\n        if (this.ui !== undefined) {\r\n            let tUI = this.ui[typeName];\r\n            if (tUI !== undefined) {\r\n                ui = tUI[name];\r\n            }\r\n        }\r\n        let {entity} = this.res;\r\n        if (entity !== undefined) {\r\n            res = entity[name];\r\n        }\r\n        return {ui: ui || {}, res: res || {} };\r\n    }\r\n\r\n    link(cEntity:CEntity<Entity, EntityUI>) {\r\n        return new CLink(cEntity);\r\n    }\r\n\r\n    get tuidLinks() {\r\n        return this.entities.tuidArr.filter(v => this.isVisible(v)).map(v => this.link(this.cTuidMain(v)));\r\n    }\r\n    cTuidMain(tuid:TuidMain):CTuidMain {\r\n        let {ui, res} = this.getUI<TuidMain, TuidUI>(tuid);\r\n        return new (ui && ui.CTuidMain || this.CTuidMain)(this, tuid, ui, res);\r\n    }\r\n    cTuidEdit(tuid:TuidMain):CTuidEdit {\r\n        let {ui, res} = this.getUI<TuidMain, TuidUI>(tuid);\r\n        return new (ui && ui.CTuidEdit || this.CTuidEdit)(this, tuid, ui, res);\r\n    }\r\n    cTuidList(tuid:TuidMain):CTuidList {\r\n        let {ui, res} = this.getUI<TuidMain, TuidUI>(tuid);\r\n        return new (ui && ui.CTuidList || this.CTuidList)(this, tuid, ui, res);\r\n    }\r\n    cTuidSelect(tuid:Tuid):CTuidSelect {\r\n        let {ui, res} = this.getUI<Tuid, TuidUI>(tuid.owner || tuid);\r\n        return new (ui && ui.CTuidSelect || this.CTuidSelect)(this, tuid, ui, res);\r\n    }\r\n    cTuidInfo(tuid:TuidMain):CTuidInfo {\r\n        let {ui, res} = this.getUI<Tuid, TuidUI>(tuid);\r\n        return new (ui && ui.CTuidInfo || this.CTuidInfo)(this, tuid, ui, res);\r\n    }\r\n\r\n    cSheet(sheet:Sheet/*, sheetUI?:SheetUI, sheetRes?:any*/):CSheet {\r\n        let {ui, res} = this.getUI<Sheet, SheetUI>(sheet);\r\n        //if (sheetUI !== undefined) ui = sheetUI;\r\n        //if (sheetRes !== undefined) res = sheetRes;\r\n        //return new (ui && ui.CSheet || this.CSheet)(this, sheet, sheetUI, sheetRes);\r\n        return new (ui && ui.CSheet || this.CSheet)(this, sheet, ui, res);\r\n    }\r\n    get sheetLinks() { \r\n        return this.entities.sheetArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cSheet(v))\r\n        });\r\n    }\r\n\r\n    cAction(action:Action):CAction {\r\n        let {ui, res} = this.getUI<Action, ActionUI>(action);\r\n        return new (ui && ui.CAction || this.CAction)(this, action, ui, res);\r\n    }\r\n    get actionLinks() { \r\n        return this.entities.actionArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cAction(v))\r\n        });\r\n    }\r\n\r\n    cQuery(query:Query):CQuery {\r\n        let {ui, res} = this.getUI<Query, QueryUI>(query);\r\n        return new (ui && ui.CQuery || this.CQuery)(this, query, ui, res);\r\n    }\r\n    cQuerySelect(queryName:string):CQuerySelect {\r\n        let query = this.entities.query(queryName);\r\n        if (query === undefined) return;\r\n        let {ui, res} = this.getUI<Query, QueryUI>(query);\r\n        return new (ui && ui.CQuerySelect || this.CQuerySelect)(this, query, ui, res);\r\n    }\r\n    get queryLinks() {\r\n        return this.entities.queryArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cQuery(v))\r\n        });\r\n    }\r\n    \r\n    cBook(book:Book):CBook {\r\n        let {ui, res} = this.getUI<Book, BookUI>(book);\r\n        return new (ui && ui.CBook || this.CBook)(this, book, ui, res);\r\n    }\r\n    get bookLinks() { \r\n        return this.entities.bookArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cBook(v))\r\n        });\r\n    }\r\n    \r\n    cHistory(history:History):CHistory {\r\n        let {ui, res} = this.getUI<History, HistoryUI>(history);\r\n        return new (ui && ui.CHistory || this.CHistory)(this, history, ui, res);\r\n    }\r\n    get historyLinks() { \r\n        return this.entities.historyArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cHistory(v))\r\n        });\r\n    }\r\n    \r\n    cPending(pending:Pending):CPending {\r\n        let {ui, res} = this.getUI<Pending, PendingUI>(pending);\r\n        return new (ui && ui.CPending || this.CPending)(this, pending, ui, res);\r\n    }\r\n    get pendingLinks() { \r\n        return this.entities.pendingArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cPending(v))\r\n        });\r\n    }\r\n    \r\n    cMap(map:Map):CMap {\r\n        let {ui, res} = this.getUI<Map, MapUI>(map);\r\n        return new (ui && ui.CMap || this.CMap)(this, map, ui, res);\r\n    }\r\n    get mapLinks() { \r\n        return this.entities.mapArr.filter(v => this.isVisible(v)).map(v => {\r\n            return this.link(this.cMap(v));\r\n        });\r\n    }\r\n\r\n    getTuidContent(tuid:Tuid): React.StatelessComponent<any> {\r\n        let {owner} = tuid;\r\n        if (owner === undefined) {\r\n            let {ui} = this.getUI<Tuid, TuidUI>(tuid);\r\n            return (ui && ui.inputContent) || PureJSONContent;\r\n        }\r\n        else {\r\n            let {ui} = this.getUI<Tuid, TuidUI>(owner);\r\n            return (ui && ui.divs && ui.divs[tuid.name].inputContent) || PureJSONContent;\r\n        }\r\n    }\r\n\r\n    async showTuid(tuid:Tuid, id:number):Promise<void> {\r\n        let {owner} = tuid;\r\n        let c = this.cTuidInfo(owner || (tuid as TuidMain));\r\n        await c.start(id);\r\n    }\r\n\r\n    protected get VUsq():typeof VUsq {return VUsq}\r\n\r\n    render() {\r\n        let v = new (this.VUsq)(this);\r\n        return v.render();\r\n    }\r\n}\r\n\r\n","export * from './cUsq';\r\nexport * from './vUsq';","import React from 'react';\r\nimport { jsonStringify } from '../../tools';\r\n\r\nexport const DefaultRow = (values) => <div className=\"px-3 py-2\">{jsonStringify(values)}</div>;\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { List, FA } from 'tonva-react-form';\r\nimport { Page, nav } from 'tonva-tools';\r\nimport { TuidMain, Query, Entity } from '../../entities';\r\nimport { VForm } from '../form';\r\nimport { VEntity } from '../CVEntity';\r\nimport { QueryUI, CQuery } from './cQuery';\r\nimport { DefaultRow } from './defaultRow';\r\n\r\nexport class VQueryMain extends VEntity<Query, QueryUI, CQuery> {\r\n    protected vForm: VForm;\r\n    private row: React.StatelessComponent;\r\n\r\n    async showEntry(param?:any):Promise<void> {\r\n        this.vForm = this.createForm(this.onSubmit, param);\r\n        let {row, queryRow} = this.ui;\r\n        this.row = queryRow || row || DefaultRow;\r\n        this.openPage(this.view);\r\n    }\r\n\r\n    onSubmit = async () => {\r\n        let params = this.vForm.getValues();\r\n        if (this.entity.isPaged === true) {\r\n            await this.entity.resetPage(30, params);\r\n            await this.entity.loadPage();\r\n            this.replacePage(this.pageResult);\r\n        }\r\n        else {\r\n            let data = await this.entity.query(params);\r\n            this.replacePage(this.queryResult, data);\r\n        }\r\n    }\r\n\r\n    again = () => {\r\n        this.vForm.reset();\r\n        this.replacePage(this.view);\r\n    }\r\n\r\n    renderExtra() {\r\n        return;\r\n    }\r\n\r\n    renderRow = (item:any, index:number) => <this.row {...item} />;\r\n\r\n    protected view = () => <Page header={this.label}>\r\n        {this.vForm.render('mx-3 my-2')}\r\n        {this.renderExtra()}\r\n    </Page>;\r\n\r\n    protected pageResult = () => {\r\n        let {name, list} = this.entity;\r\n        let rightClose = <button\r\n            className=\"btn btn-outline-success\"\r\n            onClick={this.again}>\r\n            <FA name=\"search\" /> 再查询\r\n        </button>;\r\n        return <Page header={this.label} right={rightClose}>\r\n            <List items={list} item={{render: this.renderRow}} />\r\n        </Page>;\r\n    }\r\n\r\n    protected queryResult = observer((result:any) => {\r\n        let rightClose = <button\r\n            className=\"btn btn-outline-success\"\r\n            onClick={this.again}>\r\n            <FA name=\"search\" /> 再查询\r\n        </button>;\r\n        return <Page header={this.label} right={rightClose}>\r\n            <pre>{JSON.stringify(result, undefined, '\\t')}</pre>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { FA, SearchBox, List } from 'tonva-react-form';\r\nimport { Page, PageItems } from 'tonva-tools';\r\nimport { Query } from '../../entities';\r\nimport { VEntity } from '../CVEntity';\r\nimport { QueryUI, CQuerySelect } from './cQuery';\r\nimport { DefaultRow } from './defaultRow';\r\n\r\nexport class VQuerySelect extends VEntity<Query, QueryUI, CQuerySelect> {\r\n    private row: React.StatelessComponent;\r\n\r\n    PageItems:QueryPageItems;\r\n    ownerId: number;\r\n\r\n    async showEntry(param?:any) {\r\n        let {row, selectRow} = this.ui;\r\n        this.row = selectRow || row || DefaultRow;\r\n        //this.entity = this.controller.entity;\r\n        this.PageItems = new QueryPageItems(this.entity);\r\n        await this.onSearch(param);\r\n        this.openPage(this.view);\r\n    }\r\n    onSearch = async (key:string) => {\r\n        await this.PageItems.first(key);\r\n    }\r\n\r\n    renderRow = (item:any, index:number) => <this.row {...item} />;\r\n\r\n    private callOnSelected(item:any) {\r\n       this.closePage();\r\n       this.returnCall(item);\r\n    }\r\n    clickRow = (item:any) => {\r\n        this.callOnSelected(item);\r\n    }\r\n\r\n    view = () => {\r\n        let header = <SearchBox className=\"mx-1 w-100\"\r\n            initKey={''}\r\n            onSearch={this.onSearch} placeholder={'搜索'+this.label} />;\r\n        return <Page header={header}>\r\n            <List\r\n                items={this.PageItems.items}\r\n                item={{render: this.renderRow, onClick: this.clickRow}}\r\n                before={'搜索'+this.label+'资料'} />\r\n        </Page>;\r\n    };\r\n}\r\n\r\nexport class QueryPageItems extends PageItems<any> {\r\n    private query: Query;\r\n    constructor(query: Query) {\r\n        super();\r\n        this.query = query;\r\n    }\r\n    protected async load():Promise<any[]> {\r\n        await  this.query.loadSchema();\r\n        let ret:any[];\r\n        if (this.query.isPaged === true)\r\n            ret = await this.query.page(this.param, this.pageStart, this.pageSize);\r\n        else {\r\n            let data = await this.query.query(this.param);\r\n            //let data = await this.query.unpackReturns(res);\r\n            ret = data[this.query.returns[0].name];\r\n        }\r\n        return ret;\r\n    }\r\n    protected setPageStart(item:any) {\r\n        if (item === undefined) this.pageStart = 0;\r\n    }\r\n}\r\n","import { StatelessComponent } from \"react\";\r\nimport { CEntity, EntityUI } from \"../CVEntity\";\r\nimport { Query } from \"../../entities\";\r\nimport { VQueryMain } from \"./vQueryMain\";\r\nimport { VQuerySelect } from \"./vQuerySelect\";\r\n\r\nexport interface QueryUI extends EntityUI {\r\n    CQuery?: typeof CQuery;\r\n    CQuerySelect?: typeof CQuerySelect;\r\n    main?: typeof VQueryMain;\r\n    row?: StatelessComponent;\r\n    queryRow?: StatelessComponent;\r\n    selectRow?: StatelessComponent;\r\n}\r\n\r\nexport abstract class CQueryBase extends CEntity<Query, QueryUI> {\r\n}\r\n\r\nexport class CQuery extends CQueryBase {\r\n    protected async internalStart() {\r\n        await this.showVPage(this.VQueryMain);\r\n    }\r\n\r\n    protected get VQueryMain():typeof VQueryMain {return this.ui && this.ui.main || VQueryMain}\r\n}\r\n\r\nexport class CQuerySelect extends CQueryBase {\r\n    protected async internalStart(param?:any) {\r\n        await this.showVPage(this.VQuerySelect, param);\r\n    }\r\n\r\n    protected get VQuerySelect():typeof VQuerySelect {return VQuerySelect}\r\n}\r\n","export * from './cQuery';\r\nexport * from './vQueryMain';\r\nexport * from './vQuerySelect';"],"sourceRoot":""}